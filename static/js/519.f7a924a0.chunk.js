"use strict";(self.webpackChunkvendor_management_system=self.webpackChunkvendor_management_system||[]).push([[519],{7519:(e,t,s)=>{s.r(t),s.d(t,{default:()=>c});var a=s(5043),r=s(3216),l=s(5472),n=s(791),i=s(3505),d=s(5772),o=s(579);function c(){var e,t,s,c,m;const{id:x}=(0,r.g)(),g=(0,r.Zp)(),{showSuccess:u,showError:h}=(0,i.hN)(),[y,p]=(0,a.useState)(null),[v,j]=(0,a.useState)(!0),[b,f]=(0,a.useState)({}),[N,w]=(0,a.useState)([]),[k,P]=(0,a.useState)([]),[R,S]=(0,a.useState)([]),[A,O]=(0,a.useState)({category:"",rating:5,comment:"",ratedBy:""}),[z,C]=(0,a.useState)(!1),[D,J]=(0,a.useState)(null),[F,B]=(0,a.useState)("3months"),L=[{key:"quality",label:"Quality of Work",icon:d.A3x},{key:"timeliness",label:"Timeliness",icon:d.Ohp},{key:"communication",label:"Communication",icon:d.JXP},{key:"pricing",label:"Pricing Competitiveness",icon:d.z8N},{key:"reliability",label:"Reliability",icon:d.ARf},{key:"innovation",label:"Innovation",icon:d.vQY}];(0,a.useEffect)(()=>{x&&G()},[x]);const G=async()=>{try{j(!0);const e=await(0,l.x7)((0,l.H9)(n.db,"vendors",x));if(!e.exists())return h("Vendor not found"),void g("/admin/vendors");const t={id:e.id,...e.data()};p(t);const s=(0,l.P)((0,l.rJ)(n.db,"vendorRatings"),(0,l._M)("vendorId","==",x)),a=(await(0,l.GG)(s)).docs.map(e=>({id:e.id,...e.data()}));w(a);const r=(0,l.P)((0,l.rJ)(n.db,"purchaseOrders"),(0,l._M)("vendorId","==",x)),i=(await(0,l.GG)(r)).docs.map(e=>e.data()),d=(0,l.P)((0,l.rJ)(n.db,"jobAssignments"),(0,l._M)("vendorId","==",x)),o=(await(0,l.GG)(d)).docs.map(e=>e.data()),c=i.length,m=i.filter(e=>"completed"===e.status).length,u=i.filter(e=>"pending"===e.status).length,y=i.filter(e=>"cancelled"===e.status).length,v=i.filter(e=>!("completed"!==e.status||!e.deliveryDate||!e.completedAt)&&e.completedAt.toDate()<=e.deliveryDate.toDate()).length,b=i.reduce((e,t)=>e+(parseFloat(t.totalAmount)||0),0),N=c>0?b/c:0,k={};i.forEach(e=>{if(e.createdAt){const t=e.createdAt.toDate().toISOString().slice(0,7);k[t]||(k[t]={orders:0,spend:0,completed:0}),k[t].orders++,k[t].spend+=parseFloat(e.totalAmount)||0,"completed"===e.status&&k[t].completed++}});const R=Object.entries(k).sort((e,t)=>{let[s]=e,[a]=t;return s.localeCompare(a)}).slice(-6).map(e=>{let[t,s]=e;return{month:t,orders:s.orders,spend:s.spend,completionRate:s.orders>0?s.completed/s.orders*100:0}}),A=[...i.slice(-5).map(e=>{var t;return{type:"PO",title:`Purchase Order #${e.poNumber||"N/A"}`,status:e.status,date:null===(t=e.createdAt)||void 0===t?void 0:t.toDate(),amount:e.totalAmount}}),...o.slice(-5).map(e=>{var t;return{type:"Job",title:e.title||"Job Assignment",status:e.status,date:null===(t=e.createdAt)||void 0===t?void 0:t.toDate(),amount:e.budget}})].sort((e,t)=>(t.date||0)-(e.date||0)).slice(0,10),O={};L.forEach(e=>{const t=a.filter(t=>t.category===e.key),s=t.length>0?t.reduce((e,t)=>e+t.rating,0)/t.length:0;O[e.key]=s});const z=Object.values(O).reduce((e,t)=>e+t,0)/L.length;f({totalPOs:c,completedPOs:m,pendingPOs:u,cancelledPOs:y,onTimePOs:v,totalSpend:b,avgOrderValue:N,completionRate:c>0?m/c*100:0,onTimeRate:m>0?v/m*100:0,categoryAverages:O,overallRating:z,totalJobs:o.length,completedJobs:o.filter(e=>"completed"===e.status).length,pendingJobs:o.filter(e=>"pending"===e.status).length,avgJobValue:o.length>0?o.reduce((e,t)=>e+(parseFloat(t.budget)||0),0)/o.length:0}),P(R),S(A)}catch(e){console.error("Error fetching vendor performance:",e),h("Failed to load vendor performance data")}finally{j(!1)}},T=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;const s=[];for(let a=1;a<=5;a++)s.push((0,o.jsx)(d.usP,{size:t,className:a<=e?"text-yellow-400 fill-current":"text-gray-300"},a));return(0,o.jsx)("div",{className:"flex",children:s})},_=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:80;return e>=t?"text-green-600":e>=.7*t?"text-yellow-600":"text-red-600"};return v?(0,o.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,o.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-500"})}):y?(0,o.jsxs)("div",{className:"max-w-7xl mx-auto space-y-6",children:[(0,o.jsxs)("div",{className:"flex items-center justify-between",children:[(0,o.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,o.jsxs)("button",{onClick:()=>g("/admin/vendors"),className:"flex items-center text-gray-600 hover:text-gray-900",children:[(0,o.jsx)(d.kRp,{className:"mr-2",size:20}),"Back to Vendors"]}),(0,o.jsxs)("div",{children:[(0,o.jsxs)("h1",{className:"text-2xl font-bold text-gray-900",children:[y.name," - Performance"]}),(0,o.jsx)("p",{className:"text-gray-600",children:"Performance tracking and ratings"})]})]}),(0,o.jsxs)("button",{onClick:()=>C(!0),className:"inline-flex items-center px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:[(0,o.jsx)(d.GGD,{className:"mr-2",size:16}),"Add Rating"]})]}),(0,o.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6",children:[(0,o.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:(0,o.jsxs)("div",{className:"flex items-center justify-between",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Overall Rating"}),(0,o.jsx)("div",{className:"text-2xl font-bold text-gray-900 mt-1",children:(null===(e=b.overallRating)||void 0===e?void 0:e.toFixed(1))||"0.0"}),T(b.overallRating||0,20)]}),(0,o.jsx)("div",{className:"p-3 bg-yellow-100 rounded-full",children:(0,o.jsx)(d.usP,{className:"text-yellow-600",size:24})})]})}),(0,o.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:(0,o.jsxs)("div",{className:"flex items-center justify-between",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Completion Rate"}),(0,o.jsxs)("div",{className:`text-2xl font-bold mt-1 ${_(b.completionRate)}`,children:[(null===(t=b.completionRate)||void 0===t?void 0:t.toFixed(1))||"0.0","%"]}),(0,o.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[b.completedPOs||0," of ",b.totalPOs||0," POs"]})]}),(0,o.jsx)("div",{className:"p-3 bg-green-100 rounded-full",children:(0,o.jsx)(d.A3x,{className:"text-green-600",size:24})})]})}),(0,o.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:(0,o.jsxs)("div",{className:"flex items-center justify-between",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"On-Time Delivery"}),(0,o.jsxs)("div",{className:`text-2xl font-bold mt-1 ${_(b.onTimeRate)}`,children:[(null===(s=b.onTimeRate)||void 0===s?void 0:s.toFixed(1))||"0.0","%"]}),(0,o.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[b.onTimePOs||0," on time deliveries"]})]}),(0,o.jsx)("div",{className:"p-3 bg-blue-100 rounded-full",children:(0,o.jsx)(d.Ohp,{className:"text-blue-600",size:24})})]})}),(0,o.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:(0,o.jsxs)("div",{className:"flex items-center justify-between",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Spend"}),(0,o.jsxs)("div",{className:"text-2xl font-bold text-gray-900 mt-1",children:["\u20b9",(null===(c=b.totalSpend)||void 0===c?void 0:c.toLocaleString())||"0"]}),(0,o.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Avg: \u20b9",(null===(m=b.avgOrderValue)||void 0===m?void 0:m.toLocaleString())||"0"]})]}),(0,o.jsx)("div",{className:"p-3 bg-purple-100 rounded-full",children:(0,o.jsx)(d.z8N,{className:"text-purple-600",size:24})})]})})]}),(0,o.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[(0,o.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[(0,o.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,o.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Performance Trend"}),(0,o.jsxs)("select",{value:F,onChange:e=>B(e.target.value),className:"text-sm border border-gray-300 rounded px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,o.jsx)("option",{value:"3months",children:"Last 3 Months"}),(0,o.jsx)("option",{value:"6months",children:"Last 6 Months"}),(0,o.jsx)("option",{value:"1year",children:"Last Year"})]})]}),k.length>0?(0,o.jsx)("div",{className:"space-y-4",children:k.map((e,t)=>(0,o.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("p",{className:"font-medium text-gray-900",children:new Date(e.month+"-01").toLocaleDateString("en-US",{month:"short",year:"numeric"})}),(0,o.jsxs)("p",{className:"text-sm text-gray-500",children:[e.orders," orders"]})]}),(0,o.jsxs)("div",{className:"text-right",children:[(0,o.jsxs)("p",{className:"font-medium text-green-600",children:["\u20b9",e.spend.toLocaleString()]}),(0,o.jsxs)("p",{className:"text-sm text-gray-500",children:[e.completionRate.toFixed(1),"% completion"]})]})]},e.month))}):(0,o.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,o.jsx)(d.vQY,{size:32,className:"mx-auto mb-2 text-gray-400"}),(0,o.jsx)("p",{children:"No trend data available"})]})]}),(0,o.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[(0,o.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recent Activity"}),R.length>0?(0,o.jsx)("div",{className:"space-y-3",children:R.map((e,t)=>{var s;return(0,o.jsxs)("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded",children:[(0,o.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,o.jsx)("div",{className:"p-2 rounded-full "+("PO"===e.type?"bg-blue-100":"bg-green-100"),children:"PO"===e.type?(0,o.jsx)(d.jH2,{className:"PO"===e.type?"text-blue-600":"text-green-600",size:16}):(0,o.jsx)(d.x_j,{className:"text-green-600",size:16})}),(0,o.jsxs)("div",{children:[(0,o.jsx)("p",{className:"font-medium text-gray-900",children:e.title}),(0,o.jsx)("p",{className:"text-sm text-gray-500",children:(null===(s=e.date)||void 0===s?void 0:s.toLocaleDateString())||"N/A"})]})]}),(0,o.jsxs)("div",{className:"text-right",children:[(0,o.jsx)("span",{className:"px-2 py-1 text-xs rounded-full "+("completed"===e.status?"bg-green-100 text-green-800":"pending"===e.status?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:e.status}),e.amount&&(0,o.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:["\u20b9",parseFloat(e.amount).toLocaleString()]})]})]},t)})}):(0,o.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,o.jsx)(d.z1n,{size:32,className:"mx-auto mb-2 text-gray-400"}),(0,o.jsx)("p",{children:"No recent activity"})]})]})]}),(0,o.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[(0,o.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Performance by Category"}),(0,o.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:L.map(e=>{var t;const s=e.icon,a=(null===(t=b.categoryAverages)||void 0===t?void 0:t[e.key])||0;return(0,o.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4",children:[(0,o.jsxs)("div",{className:"flex items-center mb-3",children:[(0,o.jsx)(s,{className:"text-indigo-600 mr-2",size:20}),(0,o.jsx)("h3",{className:"font-medium text-gray-900",children:e.label})]}),(0,o.jsxs)("div",{className:"flex items-center justify-between",children:[T(a),(0,o.jsx)("span",{className:"text-lg font-semibold text-gray-900",children:a.toFixed(1)})]})]},e.key)})})]}),(0,o.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[(0,o.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,o.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Recent Ratings & Reviews"})}),(0,o.jsx)("div",{className:"divide-y divide-gray-200",children:0===N.length?(0,o.jsxs)("div",{className:"text-center py-8",children:[(0,o.jsx)(d.usP,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,o.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No ratings yet"}),(0,o.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Be the first to rate this vendor's performance."})]}):N.map(e=>{var t,s,a,r;return(0,o.jsx)("div",{className:"p-6",children:(0,o.jsxs)("div",{className:"flex items-start justify-between",children:[(0,o.jsxs)("div",{className:"flex-1",children:[(0,o.jsxs)("div",{className:"flex items-center mb-2",children:[(0,o.jsx)("span",{className:"font-medium text-gray-900 mr-3",children:(null===(t=L.find(t=>t.key===e.category))||void 0===t?void 0:t.label)||e.category}),T(e.rating),(0,o.jsxs)("span",{className:"ml-2 text-sm text-gray-500",children:["(",e.rating,"/5)"]})]}),e.comment&&(0,o.jsx)("p",{className:"text-gray-700 mb-2",children:e.comment}),(0,o.jsxs)("div",{className:"flex items-center text-sm text-gray-500",children:[(0,o.jsx)(d.JXP,{className:"mr-1",size:14}),(0,o.jsxs)("span",{className:"mr-4",children:["Rated by: ",e.ratedBy]}),(0,o.jsx)(d.wIk,{className:"mr-1",size:14}),(0,o.jsx)("span",{children:(null===(s=e.createdAt)||void 0===s||null===(a=s.toDate)||void 0===a||null===(r=a.call(s))||void 0===r?void 0:r.toLocaleDateString())||"N/A"})]})]}),(0,o.jsx)("button",{onClick:()=>J(e),className:"text-indigo-600 hover:text-indigo-800",children:(0,o.jsx)(d.WXf,{size:16})})]})},e.id)})})]}),z&&(0,o.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50",children:(0,o.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[(0,o.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,o.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Add Performance Rating"}),(0,o.jsx)("button",{onClick:()=>C(!1),className:"text-gray-400 hover:text-gray-600",children:(0,o.jsx)(d.yGN,{size:20})})]}),(0,o.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),A.category&&A.ratedBy.trim())try{await(0,l.gS)((0,l.rJ)(n.db,"vendorRatings"),{...A,vendorId:x,createdAt:new Date});const e=[...N,{...A,vendorId:x,createdAt:new Date}],t={};L.forEach(s=>{const a=e.filter(e=>e.category===s.key),r=a.length>0?a.reduce((e,t)=>e+t.rating,0)/a.length:0;t[s.key]=r});const s=Object.values(t).reduce((e,t)=>e+t,0)/L.length;await(0,l.mZ)((0,l.H9)(n.db,"vendors",x),{rating:s,updatedAt:new Date}),u("Rating added successfully"),O({category:"",rating:5,comment:"",ratedBy:""}),C(!1),G()}catch(t){console.error("Error adding rating:",t),h("Failed to add rating")}else h("Please fill in all required fields")},className:"space-y-4",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category *"}),(0,o.jsxs)("select",{value:A.category,onChange:e=>O(t=>({...t,category:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",required:!0,children:[(0,o.jsx)("option",{value:"",children:"Select a category"}),L.map(e=>(0,o.jsx)("option",{value:e.key,children:e.label},e.key))]})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Rating *"}),(0,o.jsxs)("div",{className:"flex items-center space-x-2",children:[[1,2,3,4,5].map(e=>(0,o.jsx)("button",{type:"button",onClick:()=>O(t=>({...t,rating:e})),className:"focus:outline-none",children:(0,o.jsx)(d.usP,{size:24,className:e<=A.rating?"text-yellow-400 fill-current":"text-gray-300"})},e)),(0,o.jsxs)("span",{className:"ml-2 text-sm text-gray-600",children:["(",A.rating,"/5)"]})]})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Comment"}),(0,o.jsx)("textarea",{value:A.comment,onChange:e=>O(t=>({...t,comment:e.target.value})),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"Optional feedback about the vendor's performance"})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Rated By *"}),(0,o.jsx)("input",{type:"text",value:A.ratedBy,onChange:e=>O(t=>({...t,ratedBy:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"Your name",required:!0})]}),(0,o.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,o.jsx)("button",{type:"button",onClick:()=>C(!1),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Cancel"}),(0,o.jsxs)("button",{type:"submit",className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700",children:[(0,o.jsx)(d.Bc_,{className:"inline mr-2",size:16}),"Save Rating"]})]})]})]})})]}):(0,o.jsx)("div",{className:"text-center py-8",children:(0,o.jsx)("p",{className:"text-gray-500",children:"Vendor not found"})})}}}]);
//# sourceMappingURL=519.f7a924a0.chunk.js.map