"use strict";(self.webpackChunkvendor_management_system=self.webpackChunkvendor_management_system||[]).push([[352],{613:(e,t,a)=>{a.d(t,{I$:()=>u,KS:()=>o,PX:()=>x,PY:()=>h,aR:()=>m,zH:()=>d});var n=a(5472),s=a(791);const l="deliveryChallans",r="dcActivity";function d(e){const t=(Array.isArray(e.items)?e.items:[]).map(e=>{const t=Number(e.quantity)||0,a=Number(e.price)||0;return{description:String(e.description||"").trim(),hsnCode:String(e.hsnCode||""),quantity:t,unit:String(e.unit||"Nos"),price:a,amount:Number((t*a).toFixed(2)),itemId:e.itemId||null}}),a=t.reduce((e,t)=>e+(Number(t.amount)||0),0),n=t.reduce((e,t)=>e+(Number(t.quantity)||0),0);return{challanNumber:String(e.challanNumber||"").trim(),date:e.date||(new Date).toISOString().split("T")[0],poId:e.poId?String(e.poId):null,poNumber:e.poNumber?String(e.poNumber):e.reference?String(e.reference):"",vendorId:String(e.vendorId||"").trim(),vendorName:String(e.vendorName||""),vendorAddress:String(e.vendorAddress||""),reference:String(e.reference||""),vehicleNo:String(e.vehicleNo||""),driverName:String(e.driverName||""),remarks:String(e.remarks||""),items:t,totalAmount:Number(a.toFixed(2)),totalQuantity:n,amountInWords:String(e.amountInWords||"")}}function i(e){return{id:e.id,...e.data()}}async function c(e,t,a){try{await(0,n.gS)((0,n.rJ)(s.db,r),{dcId:e,action:t,details:a||{},timestamp:(0,n.O5)()})}catch(l){}}async function o(e){const t=await(0,n.x7)((0,n.H9)(s.db,l,e));return t.exists()?i(t):null}async function m(e){const t=d(e),a=(0,n.O5)(),r=await(0,n.gS)((0,n.rJ)(s.db,l),{...t,createdAt:a,updatedAt:a});return await c(r.id,"create",{vendorId:t.vendorId,totalAmount:t.totalAmount}),{id:r.id,...t}}async function x(e,t){const a=d(t);await(0,n.mZ)((0,n.H9)(s.db,l,e),{...a,updatedAt:(0,n.O5)()}),await c(e,"update")}async function h(e){await(0,n.kd)((0,n.H9)(s.db,l,e)),await c(e,"delete")}async function u(e){const t=(0,n.wP)(s.db);e.forEach(e=>t.delete((0,n.H9)(s.db,l,e))),await t.commit();for(const a of e)c(a,"bulk_delete")}},7352:(e,t,a)=>{a.r(t),a.d(t,{default:()=>x});var n=a(5043),s=a(3216),l=a(5475),r=a(5472),d=a(791),i=a(613),c=a(3505),o=a(5772),m=a(579);function x(){const{showSuccess:e,showError:t}=(0,c.hN)(),a=(0,s.Zp)(),[x,g]=(0,n.useState)(!0),[j,p]=(0,n.useState)(!1),[N,v]=(0,n.useState)([]),[b,y]=(0,n.useState)([]),[f,w]=(0,n.useState)(""),[k,C]=(0,n.useState)({vendor:"all",dateRange:"all"}),[S,D]=(0,n.useState)("table"),[I,A]=(0,n.useState)(!1),[E,$]=(0,n.useState)({key:"date",direction:"desc"}),[P,R]=(0,n.useState)([]),[T,V]=(0,n.useState)({}),[F,M]=(0,n.useState)(!0);(0,n.useEffect)(()=>{_();const e=()=>A(window.innerWidth<768);return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const _=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{e?p(!0):g(!0);const[t,a]=await Promise.all([(0,r.GG)((0,r.rJ)(d.db,"vendors")),(0,r.GG)((0,r.P)((0,r.rJ)(d.db,"deliveryChallans"),(0,r.My)("createdAt","desc")))]),n=t.docs.map(e=>({id:e.id,...e.data()})),s=a.docs.map(e=>({id:e.id,...e.data()}));v(n),y(s)}catch(a){console.error("Error loading challans",a),t("Failed to load delivery challans")}finally{g(!1),p(!1)}},z=(0,n.useMemo)(()=>{const e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate()),a=new Date(t);a.setDate(a.getDate()-a.getDay());const n=new Date(e.getFullYear(),e.getMonth(),1);return b.filter(e=>{const s=`${e.challanNumber||""} ${e.vendorName||(e=>{var t,a;return(null===(t=N.find(t=>t.id===e))||void 0===t?void 0:t.name)||(null===(a=N.find(t=>t.id===e))||void 0===a?void 0:a.companyName)||""})(e.vendorId)||""} ${e.reference||""}`.toLowerCase();if(f&&!s.includes(f.toLowerCase()))return!1;if("all"!==k.vendor&&e.vendorId!==k.vendor)return!1;if("all"!==k.dateRange){const s=e.date?new Date(e.date):null;if(!s)return!1;if("today"===k.dateRange&&s<t)return!1;if("week"===k.dateRange&&s<a)return!1;if("month"===k.dateRange&&s<n)return!1}return!0})},[b,f,k,N]),G=(0,n.useMemo)(()=>{const e=[...z];return e.sort((e,t)=>{const a="asc"===E.direction?1:-1,n=E.key,s=(e[n]||"").toString(),l=(t[n]||"").toString();return"date"===n?(new Date(s)-new Date(l))*a:s.localeCompare(l)*a}),e},[z,E]),H=e=>{R(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},W=()=>R([]),X=async a=>{try{await(0,i.PY)(a),y(e=>e.filter(e=>e.id!==a)),e("Challan deleted")}catch(n){console.error("Delete failed",n),t("Failed to delete challan")}};return(0,m.jsxs)("div",{className:"p-4",children:[(0,m.jsx)("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-200 mb-4",children:(0,m.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[(0,m.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,m.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl flex items-center justify-center",children:(0,m.jsx)(o.jH2,{className:"text-white",size:20})}),(0,m.jsxs)("div",{children:[(0,m.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Delivery Challans"}),(0,m.jsx)("p",{className:"text-gray-600",children:"Manage and print delivery challans"})]})]}),(0,m.jsxs)("div",{className:"flex items-center gap-2",children:[(0,m.jsxs)("button",{onClick:()=>_(!0),className:"px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded flex items-center",children:[(0,m.jsx)(o.jTZ,{className:"mr-2"})," ",j?"Refreshing...":"Refresh"]}),(0,m.jsx)("button",{onClick:()=>D("table"===S?"cards":"table"),className:"px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded flex items-center",children:"table"===S?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(o.QPV,{className:"mr-2"})," Cards"]}):(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(o.Wm,{className:"mr-2"})," Table"]})}),(0,m.jsxs)(l.N_,{to:"/admin/create-challan",className:"px-3 py-2 bg-indigo-600 text-white rounded flex items-center",children:[(0,m.jsx)(o.GGD,{className:"mr-2"})," Create"]})]})]})}),(0,m.jsxs)("div",{className:"border rounded mb-4",children:[(0,m.jsxs)("button",{onClick:()=>M(!F),className:"w-full flex items-center justify-between px-3 py-2 bg-gray-50",children:[(0,m.jsxs)("div",{className:"flex items-center text-gray-700",children:[(0,m.jsx)(o.K7R,{className:"mr-2"})," Filters"]}),F?(0,m.jsx)(o.wAb,{}):(0,m.jsx)(o.fK4,{})]}),F&&(0,m.jsxs)("div",{className:"p-3 grid grid-cols-1 md:grid-cols-4 gap-3",children:[(0,m.jsxs)("div",{className:"relative md:col-span-2",children:[(0,m.jsx)(o.CKj,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),(0,m.jsx)("input",{value:f,onChange:e=>w(e.target.value),placeholder:"Search by challan no, vendor, reference",className:"pl-10 pr-3 py-2 border rounded w-full"})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-xs text-gray-500 mb-1",children:"Vendor"}),(0,m.jsxs)("select",{value:k.vendor,onChange:e=>C(t=>({...t,vendor:e.target.value})),className:"w-full border rounded px-3 py-2",children:[(0,m.jsx)("option",{value:"all",children:"All vendors"}),N.map(e=>(0,m.jsx)("option",{value:e.id,children:e.name||e.companyName||e.displayName||e.id},e.id))]})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-xs text-gray-500 mb-1",children:"Date range"}),(0,m.jsxs)("select",{value:k.dateRange,onChange:e=>C(t=>({...t,dateRange:e.target.value})),className:"w-full border rounded px-3 py-2",children:[(0,m.jsx)("option",{value:"all",children:"All"}),(0,m.jsx)("option",{value:"today",children:"Today"}),(0,m.jsx)("option",{value:"week",children:"This week"}),(0,m.jsx)("option",{value:"month",children:"This month"})]})]})]})]}),P.length>0&&(0,m.jsxs)("div",{className:"flex items-center justify-between bg-indigo-50 border border-indigo-200 rounded p-2 mb-3",children:[(0,m.jsxs)("div",{className:"text-sm",children:[P.length," selected"]}),(0,m.jsxs)("div",{className:"flex items-center gap-2",children:[(0,m.jsxs)("button",{onClick:()=>{G.filter(e=>P.includes(e.id)).forEach(e=>{const t=`/admin/challan-details/${e.id}?print=1`;window.open(t,"_blank")})},className:"px-3 py-1.5 bg-gray-100 hover:bg-gray-200 rounded flex items-center",children:[(0,m.jsx)(o.Mvz,{className:"mr-2"})," Print"]}),(0,m.jsxs)("button",{onClick:()=>{G.filter(e=>P.includes(e.id)).forEach(e=>{const t=`/admin/challan-details/${e.id}?download=1`;window.open(t,"_blank")})},className:"px-3 py-1.5 bg-gray-100 hover:bg-gray-200 rounded flex items-center",children:[(0,m.jsx)(o.a4x,{className:"mr-2"})," Download"]}),(0,m.jsxs)("button",{onClick:async()=>{try{await(0,i.I$)(P),y(e=>e.filter(e=>!P.includes(e.id))),W(),e("Selected challans deleted")}catch(a){console.error(a),t("Bulk delete failed")}},className:"px-3 py-1.5 bg-red-50 hover:bg-red-100 text-red-600 rounded flex items-center",children:[(0,m.jsx)(o.IXo,{className:"mr-2"})," Delete"]}),(0,m.jsx)("button",{onClick:W,className:"px-3 py-1.5 border rounded",children:"Clear"})]})]}),x?(0,m.jsx)("div",{className:"py-12 text-center text-gray-500",children:"Loading..."}):"cards"===S||I?(0,m.jsx)(u,{data:G,selectedItems:P,expandedCards:T,onToggleSelection:H,onToggleExpansion:e=>{V(t=>({...t,[e]:!t[e]}))},onView:e=>a(`/admin/challan-details/${e}`),onEdit:e=>a(`/admin/edit-challan/${e}`),onDelete:X,onPrint:e=>a(`/admin/challan-details/${e}?print=1`),onDownload:e=>a(`/admin/challan-details/${e}?download=1`)}):(0,m.jsx)(h,{data:G,selectedItems:P,onToggleSelection:H,onSelectAll:()=>R(G.map(e=>e.id)),onClearAll:W,onSort:e=>{$(t=>t.key===e?{key:e,direction:"asc"===t.direction?"desc":"asc"}:{key:e,direction:"asc"})},sortConfig:E,onView:e=>a(`/admin/challan-details/${e}`),onEdit:e=>a(`/admin/edit-challan/${e}`),onDelete:X,onPrint:e=>a(`/admin/challan-details/${e}?print=1`),onDownload:e=>a(`/admin/challan-details/${e}?download=1`)})]})}function h(e){let{data:t,selectedItems:a,onToggleSelection:n,onSelectAll:s,onClearAll:l,onSort:r,sortConfig:d,onView:i,onEdit:c,onDelete:x,onPrint:h,onDownload:u}=e;return(0,m.jsx)("div",{className:"overflow-x-auto border rounded",children:(0,m.jsxs)("table",{className:"min-w-full text-sm",children:[(0,m.jsx)("thead",{className:"bg-gray-50",children:(0,m.jsxs)("tr",{children:[(0,m.jsx)("th",{className:"p-3 w-10",children:(0,m.jsx)("input",{type:"checkbox",checked:a.length===t.length&&t.length>0,onChange:e=>e.target.checked?s():l()})}),(0,m.jsxs)("th",{className:"text-left p-3 cursor-pointer",onClick:()=>r("challanNumber"),children:["Challan No ","challanNumber"===d.key?"asc"===d.direction?"\u25b2":"\u25bc":""]}),(0,m.jsxs)("th",{className:"text-left p-3 cursor-pointer",onClick:()=>r("date"),children:["Date ","date"===d.key?"asc"===d.direction?"\u25b2":"\u25bc":""]}),(0,m.jsx)("th",{className:"text-left p-3",children:"Vendor"}),(0,m.jsx)("th",{className:"text-left p-3",children:"Reference"}),(0,m.jsx)("th",{className:"text-left p-3",children:"Items"}),(0,m.jsx)("th",{className:"text-right p-3",children:"Actions"})]})}),(0,m.jsxs)("tbody",{children:[t.map(e=>(0,m.jsxs)("tr",{className:"border-t hover:bg-gray-50",children:[(0,m.jsx)("td",{className:"p-3",children:(0,m.jsx)("input",{type:"checkbox",checked:a.includes(e.id),onChange:()=>n(e.id)})}),(0,m.jsx)("td",{className:"p-3 font-medium",children:e.challanNumber||"-"}),(0,m.jsx)("td",{className:"p-3",children:e.date||"-"}),(0,m.jsx)("td",{className:"p-3",children:e.vendorName||"-"}),(0,m.jsx)("td",{className:"p-3",children:e.reference||"-"}),(0,m.jsx)("td",{className:"p-3",children:(e.items||[]).length}),(0,m.jsx)("td",{className:"p-3 text-right",children:(0,m.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,m.jsx)("button",{onClick:()=>i(e.id),className:"p-2 hover:bg-gray-100 rounded",title:"View",children:(0,m.jsx)(o.Vap,{})}),(0,m.jsx)("button",{onClick:()=>c(e.id),className:"p-2 hover:bg-gray-100 rounded",title:"Edit",children:(0,m.jsx)(o.WXf,{})}),(0,m.jsx)("button",{onClick:()=>x(e.id),className:"p-2 hover:bg-gray-100 rounded",title:"Delete",children:(0,m.jsx)(o.IXo,{})}),(0,m.jsx)("button",{onClick:()=>h(e.id),className:"p-2 hover:bg-gray-100 rounded",title:"Print",children:(0,m.jsx)(o.Mvz,{})}),(0,m.jsx)("button",{onClick:()=>u(e.id),className:"p-2 hover:bg-gray-100 rounded",title:"Download",children:(0,m.jsx)(o.a4x,{})})]})})]},e.id)),0===t.length&&(0,m.jsx)("tr",{children:(0,m.jsx)("td",{className:"p-6 text-center text-gray-500",colSpan:7,children:"No delivery challans found"})})]})]})})}function u(e){let{data:t,selectedItems:a,expandedCards:n,onToggleSelection:s,onToggleExpansion:l,onView:r,onEdit:d,onDelete:i,onPrint:c,onDownload:x}=e;return(0,m.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:t.map(e=>(0,m.jsxs)("div",{className:"border rounded p-3 "+(a.includes(e.id)?"ring-2 ring-indigo-400":""),children:[(0,m.jsxs)("div",{className:"flex items-start justify-between",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("div",{className:"text-xs text-gray-500",children:"Challan No"}),(0,m.jsx)("div",{className:"font-medium",children:e.challanNumber||"-"})]}),(0,m.jsxs)("div",{className:"text-right",children:[(0,m.jsx)("div",{className:"text-xs text-gray-500",children:"Date"}),(0,m.jsx)("div",{className:"font-medium",children:e.date||"-"})]})]}),(0,m.jsxs)("div",{className:"mt-2 grid grid-cols-2 gap-3 text-sm",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("div",{className:"text-gray-500",children:"Vendor"}),(0,m.jsx)("div",{className:"font-medium",children:e.vendorName||"-"})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("div",{className:"text-gray-500",children:"Reference"}),(0,m.jsx)("div",{className:"font-medium",children:e.reference||"-"})]})]}),n[e.id]&&(0,m.jsxs)("div",{className:"mt-3 text-sm",children:[(0,m.jsxs)("div",{className:"text-gray-600 font-medium mb-1",children:["Items (",(e.items||[]).length,")"]}),(0,m.jsx)("ul",{className:"list-disc pl-4 space-y-1",children:(e.items||[]).map((e,t)=>(0,m.jsxs)("li",{className:"text-gray-700",children:[e.description," \u2014 ",e.quantity," ",e.unit]},t))}),e.remarks&&(0,m.jsxs)("div",{className:"mt-2",children:[(0,m.jsx)("div",{className:"text-gray-500",children:"Remarks"}),(0,m.jsx)("div",{className:"whitespace-pre-wrap",children:e.remarks})]})]}),(0,m.jsxs)("div",{className:"mt-3 flex items-center justify-between",children:[(0,m.jsxs)("div",{className:"flex items-center gap-2",children:[(0,m.jsx)("input",{type:"checkbox",checked:a.includes(e.id),onChange:()=>s(e.id)}),(0,m.jsx)("button",{onClick:()=>l(e.id),className:"text-indigo-700 text-sm",children:n[e.id]?"Show less":"Show details"})]}),(0,m.jsxs)("div",{className:"flex items-center gap-2",children:[(0,m.jsx)("button",{onClick:()=>r(e.id),className:"p-2 hover:bg-gray-100 rounded",title:"View",children:(0,m.jsx)(o.Vap,{})}),(0,m.jsx)("button",{onClick:()=>d(e.id),className:"p-2 hover:bg-gray-100 rounded",title:"Edit",children:(0,m.jsx)(o.WXf,{})}),(0,m.jsx)("button",{onClick:()=>i(e.id),className:"p-2 hover:bg-gray-100 rounded",title:"Delete",children:(0,m.jsx)(o.IXo,{})}),(0,m.jsx)("button",{onClick:()=>c(e.id),className:"p-2 hover:bg-gray-100 rounded",title:"Print",children:(0,m.jsx)(o.Mvz,{})}),(0,m.jsx)("button",{onClick:()=>x(e.id),className:"p-2 hover:bg-gray-100 rounded",title:"Download",children:(0,m.jsx)(o.a4x,{})})]})]})]},e.id))})}}}]);
//# sourceMappingURL=352.0e7761bd.chunk.js.map