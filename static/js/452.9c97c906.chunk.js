"use strict";(self.webpackChunkvendor_management_system=self.webpackChunkvendor_management_system||[]).push([[452],{8452:(e,t,s)=>{s.r(t),s.d(t,{default:()=>m});var a=s(5043),r=s(3216),i=s(5475),n=s(5472),l=s(791),d=s(9369),c=s(3505),o=s(5772),x=s(579);function m(){var e,t,s,m,u,p,h,g,y,N,j,v,f,b,w,A,S,D,P,O,k;const{id:z}=(0,r.g)(),F=(0,r.Zp)(),{showSuccess:I,showError:C}=(0,c.hN)(),[_,H]=(0,a.useState)(null),[L,q]=(0,a.useState)(null),[E,R]=(0,a.useState)(!0),[B,M]=(0,a.useState)(!1);(0,a.useEffect)(()=>{T()},[z]);const T=async()=>{try{R(!0);const e=await(0,d.KN)(z);if(!e)return C("Purchase order not found"),void F("/admin/purchase-orders");if(H(e),e.vendorId){const t=await(0,n.x7)((0,n.H9)(l.db,"vendors",e.vendorId));t.exists()&&q({id:t.id,...t.data()})}}catch(e){console.error("Error fetching PO details:",e),C("Failed to load purchase order details")}finally{R(!1)}},$=async e=>{try{M(!0),await(0,d.vb)(z,{..._,status:e}),H(t=>({...t,status:e})),I(`Purchase order ${e} successfully`)}catch(t){console.error("Error updating PO status:",t),C("Failed to update purchase order status")}finally{M(!1)}};return E?(0,x.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,x.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-500"})}):_?(0,x.jsxs)("div",{className:"max-w-6xl mx-auto space-y-6",children:[(0,x.jsxs)("div",{className:"flex items-center justify-between",children:[(0,x.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,x.jsxs)("button",{onClick:()=>F("/admin/purchase-orders"),className:"flex items-center text-gray-600 hover:text-gray-900",children:[(0,x.jsx)(o.kRp,{className:"mr-2",size:20}),"Back to POs"]}),(0,x.jsxs)("div",{children:[(0,x.jsxs)("h1",{className:"text-2xl font-bold text-gray-900",children:["Purchase Order #",_.poNumber]}),(0,x.jsx)("p",{className:"text-gray-600",children:"Detailed view and status management"})]})]}),(0,x.jsxs)("div",{className:"flex space-x-3",children:[(0,x.jsxs)("button",{onClick:()=>{window.print()},className:"inline-flex items-center px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:[(0,x.jsx)(o.Mvz,{className:"mr-2",size:16}),"Print"]}),(0,x.jsxs)("button",{onClick:()=>{I("PDF download started")},className:"inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[(0,x.jsx)(o.a4x,{className:"mr-2",size:16}),"Download PDF"]}),(0,x.jsxs)(i.N_,{to:`/admin/edit-po/${_.id}`,className:"inline-flex items-center px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:[(0,x.jsx)(o.WXf,{className:"mr-2",size:16}),"Edit PO"]})]})]}),(0,x.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:(0,x.jsxs)("div",{className:"flex items-center justify-between",children:[(0,x.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,x.jsxs)("div",{className:"flex items-center",children:[(e=>{switch(e){case"approved":return(0,x.jsx)(o.A3x,{className:"text-green-500"});case"pending":return(0,x.jsx)(o.Ohp,{className:"text-yellow-500"});case"rejected":return(0,x.jsx)(o.q_G,{className:"text-red-500"});case"completed":return(0,x.jsx)(o.A3x,{className:"text-blue-500"});default:return(0,x.jsx)(o.y3G,{className:"text-gray-500"})}})(_.status),(0,x.jsx)("span",{className:`ml-2 inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${(e=>{switch(e){case"approved":return"bg-green-100 text-green-800";case"pending":return"bg-yellow-100 text-yellow-800";case"rejected":return"bg-red-100 text-red-800";case"completed":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}})(_.status)}`,children:(null===(e=_.status)||void 0===e?void 0:e.charAt(0).toUpperCase())+(null===(t=_.status)||void 0===t?void 0:t.slice(1))})]}),(0,x.jsxs)("div",{className:"text-sm text-gray-500",children:["Last updated: ",(null===(s=_.updatedAt)||void 0===s||null===(m=s.toDate)||void 0===m||null===(u=m.call(s))||void 0===u?void 0:u.toLocaleString())||"N/A"]})]}),"pending"===_.status&&(0,x.jsxs)("div",{className:"flex space-x-2",children:[(0,x.jsxs)("button",{onClick:()=>$("approved"),disabled:B,className:"inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50",children:[(0,x.jsx)(o.A3x,{className:"mr-2",size:16}),"Approve"]}),(0,x.jsxs)("button",{onClick:()=>$("rejected"),disabled:B,className:"inline-flex items-center px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50",children:[(0,x.jsx)(o.q_G,{className:"mr-2",size:16}),"Reject"]})]}),"approved"===_.status&&(0,x.jsxs)("button",{onClick:()=>$("completed"),disabled:B,className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:[(0,x.jsx)(o.A3x,{className:"mr-2",size:16}),"Mark Completed"]})]})}),(0,x.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,x.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[(0,x.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Purchase Order Details"}),(0,x.jsxs)("div",{className:"space-y-4",children:[(0,x.jsxs)("div",{className:"flex items-center",children:[(0,x.jsx)(o.jH2,{className:"text-gray-400 mr-3",size:20}),(0,x.jsxs)("div",{children:[(0,x.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"PO Number"}),(0,x.jsx)("p",{className:"text-gray-900 font-mono",children:_.poNumber})]})]}),(0,x.jsxs)("div",{className:"flex items-center",children:[(0,x.jsx)(o.wIk,{className:"text-gray-400 mr-3",size:20}),(0,x.jsxs)("div",{children:[(0,x.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Created Date"}),(0,x.jsx)("p",{className:"text-gray-900",children:(null===(p=_.createdAt)||void 0===p||null===(h=p.toDate)||void 0===h||null===(g=h.call(p))||void 0===g?void 0:g.toLocaleDateString())||"N/A"})]})]}),(0,x.jsxs)("div",{className:"flex items-center",children:[(0,x.jsx)(o.wIk,{className:"text-gray-400 mr-3",size:20}),(0,x.jsxs)("div",{children:[(0,x.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Delivery Date"}),(0,x.jsx)("p",{className:"text-gray-900",children:(null===(y=_.deliveryDate)||void 0===y||null===(N=y.toDate)||void 0===N||null===(j=N.call(y))||void 0===j?void 0:j.toLocaleDateString())||"Not specified"})]})]}),(0,x.jsxs)("div",{className:"flex items-center",children:[(0,x.jsx)(o.jH2,{className:"text-gray-400 mr-3",size:20}),(0,x.jsxs)("div",{children:[(0,x.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Operation(s)"}),(0,x.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(Array.isArray(_.operations)?_.operations:_.operation?[_.operation]:[]).map((e,t)=>(0,x.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800",children:e},t)),!_.operations&&!_.operation&&(0,x.jsx)("span",{className:"text-xs text-gray-500",children:"-"})]})]})]}),(0,x.jsxs)("div",{className:"flex items-center",children:[(0,x.jsx)(o.z8N,{className:"text-gray-400 mr-3",size:20}),(0,x.jsxs)("div",{children:[(0,x.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Total Amount"}),(0,x.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:["\u20b9",parseFloat(_.totalAmount||0).toLocaleString()]})]})]})]})]}),(0,x.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[(0,x.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Vendor Information"}),L?(0,x.jsxs)("div",{className:"space-y-4",children:[(0,x.jsxs)("div",{className:"flex items-center",children:[(0,x.jsx)(o.JXP,{className:"text-gray-400 mr-3",size:20}),(0,x.jsxs)("div",{children:[(0,x.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Vendor Name"}),(0,x.jsx)(i.N_,{to:`/admin/vendor-preview/${L.id}`,className:"text-indigo-600 hover:text-indigo-800 font-medium",children:L.name})]})]}),(0,x.jsxs)("div",{className:"flex items-center",children:[(0,x.jsx)(o.pHD,{className:"text-gray-400 mr-3",size:20}),(0,x.jsxs)("div",{children:[(0,x.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Email"}),(0,x.jsx)("a",{href:`mailto:${L.email}`,className:"text-indigo-600 hover:text-indigo-800",children:L.email})]})]}),(0,x.jsxs)("div",{className:"flex items-center",children:[(0,x.jsx)(o.QFc,{className:"text-gray-400 mr-3",size:20}),(0,x.jsxs)("div",{children:[(0,x.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Phone"}),(0,x.jsx)("a",{href:`tel:${L.phone}`,className:"text-indigo-600 hover:text-indigo-800",children:L.phone})]})]}),(0,x.jsxs)("div",{className:"flex items-start",children:[(0,x.jsx)(o.JXP,{className:"text-gray-400 mr-3 mt-1",size:20}),(0,x.jsxs)("div",{children:[(0,x.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Address"}),(0,x.jsx)("p",{className:"text-gray-900",children:L.address||"N/A"})]})]})]}):(0,x.jsx)("p",{className:"text-gray-500",children:"Vendor information not available"})]})]}),(0,x.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[(0,x.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,x.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Items & Services"})}),(0,x.jsx)("div",{className:"overflow-x-auto",children:(0,x.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,x.jsx)("thead",{className:"bg-gray-50",children:(0,x.jsxs)("tr",{children:[(0,x.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Description"}),(0,x.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Operation"}),(0,x.jsx)("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Quantity"}),(0,x.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Unit Price"}),(0,x.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Amount"})]})}),(0,x.jsxs)("tbody",{className:"bg-white divide-y divide-gray-200",children:[null===(v=_.items)||void 0===v?void 0:v.map((e,t)=>(0,x.jsxs)("tr",{children:[(0,x.jsx)("td",{className:"px-6 py-4 text-sm text-gray-900",children:e.description}),(0,x.jsx)("td",{className:"px-6 py-4 text-sm text-gray-900",children:e.operation||"-"}),(0,x.jsx)("td",{className:"px-6 py-4 text-sm text-gray-900 text-center",children:e.quantity}),(0,x.jsxs)("td",{className:"px-6 py-4 text-sm text-gray-900 text-right",children:["\u20b9",parseFloat(e.unitPrice||0).toLocaleString()]}),(0,x.jsxs)("td",{className:"px-6 py-4 text-sm text-gray-900 text-right font-medium",children:["\u20b9",parseFloat(e.amount||0).toLocaleString()]})]},t)),(0,x.jsxs)("tr",{className:"bg-gray-50 font-semibold",children:[(0,x.jsx)("td",{colSpan:"3",className:"px-6 py-4 text-sm text-gray-900 text-right",children:"Total Amount:"}),(0,x.jsxs)("td",{className:"px-6 py-4 text-sm text-gray-900 text-right",children:["\u20b9",parseFloat(_.totalAmount||0).toLocaleString()]})]})]})]})})]}),(_.description||_.specifications||_.terms)&&(0,x.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[(0,x.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Additional Information"}),(0,x.jsxs)("div",{className:"space-y-6",children:[_.description&&(0,x.jsxs)("div",{children:[(0,x.jsx)("h3",{className:"text-sm font-medium text-gray-500 mb-2",children:"Description"}),(0,x.jsx)("p",{className:"text-gray-900",children:_.description})]}),_.specifications&&(0,x.jsxs)("div",{children:[(0,x.jsx)("h3",{className:"text-sm font-medium text-gray-500 mb-2",children:"Technical Specifications"}),(0,x.jsx)("p",{className:"text-gray-900 whitespace-pre-line",children:_.specifications})]}),_.terms&&(0,x.jsxs)("div",{children:[(0,x.jsx)("h3",{className:"text-sm font-medium text-gray-500 mb-2",children:"Terms & Conditions"}),(0,x.jsx)("p",{className:"text-gray-900 whitespace-pre-line",children:_.terms})]})]})]}),(0,x.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[(0,x.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Status History"}),(0,x.jsxs)("div",{className:"space-y-4",children:[(0,x.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,x.jsx)("div",{className:"flex-shrink-0",children:(0,x.jsx)("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:(0,x.jsx)(o.jH2,{className:"w-4 h-4 text-blue-600"})})}),(0,x.jsxs)("div",{className:"flex-1",children:[(0,x.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"Purchase Order Created"}),(0,x.jsx)("p",{className:"text-sm text-gray-500",children:(null===(f=_.createdAt)||void 0===f||null===(b=f.toDate)||void 0===b||null===(w=b.call(f))||void 0===w?void 0:w.toLocaleString())||"N/A"})]})]}),"pending"!==_.status&&(0,x.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,x.jsx)("div",{className:"flex-shrink-0",children:(0,x.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center "+("approved"===_.status?"bg-green-100":"bg-red-100"),children:"approved"===_.status?(0,x.jsx)(o.A3x,{className:"w-4 h-4 text-green-600"}):(0,x.jsx)(o.q_G,{className:"w-4 h-4 text-red-600"})})}),(0,x.jsxs)("div",{className:"flex-1",children:[(0,x.jsxs)("p",{className:"text-sm font-medium text-gray-900",children:["Purchase Order ","approved"===_.status?"Approved":"Rejected"]}),(0,x.jsx)("p",{className:"text-sm text-gray-500",children:(null===(A=_.updatedAt)||void 0===A||null===(S=A.toDate)||void 0===S||null===(D=S.call(A))||void 0===D?void 0:D.toLocaleString())||"N/A"})]})]}),"completed"===_.status&&(0,x.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,x.jsx)("div",{className:"flex-shrink-0",children:(0,x.jsx)("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:(0,x.jsx)(o.A3x,{className:"w-4 h-4 text-blue-600"})})}),(0,x.jsxs)("div",{className:"flex-1",children:[(0,x.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"Work Completed"}),(0,x.jsx)("p",{className:"text-sm text-gray-500",children:(null===(P=_.updatedAt)||void 0===P||null===(O=P.toDate)||void 0===O||null===(k=O.call(P))||void 0===k?void 0:k.toLocaleString())||"N/A"})]})]})]})]})]}):(0,x.jsxs)("div",{className:"text-center py-8",children:[(0,x.jsx)("p",{className:"text-gray-500",children:"Purchase order not found"}),(0,x.jsxs)(i.N_,{to:"/admin/purchase-orders",className:"mt-4 inline-flex items-center px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700",children:[(0,x.jsx)(o.kRp,{className:"mr-2",size:16}),"Back to Purchase Orders"]})]})}},9369:(e,t,s)=>{s.d(t,{B8:()=>l,G8:()=>x,KN:()=>o,Oh:()=>p,Zz:()=>u,uM:()=>h,vb:()=>m});var a=s(5472),r=s(791);const i="purchaseOrders",n="poActivity";function l(e){var t;const s=Array.isArray(e.items)?e.items:[],a=Array.isArray(e.operations)?e.operations.filter(Boolean):e.operation?[String(e.operation)]:[],r=s.map(e=>{var t,s;const a=Number(e.quantity)||0,r=Number(null!==(t=e.unitPrice)&&void 0!==t?t:e.rate)||0;return{description:String(e.description||"").trim(),quantity:a,unitPrice:r,amount:Number(null!==(s=e.amount)&&void 0!==s?s:a*r).toFixed?Number((a*r).toFixed(2)):a*r,unit:String(e.unit||"pcs"),specifications:String(e.specifications||""),deliveryDate:e.deliveryDate||"",itemId:e.itemId||null,operation:e.operation||null}}),i=r.reduce((e,t)=>e+(Number(t.amount)||0),0),n=Number(e.discountAmount||0),l=i-n,d=Number(e.taxRate||0),c=l*d/100;let o=l+c;const x=Boolean(e.roundOffEnabled);let m=Number(e.roundOffValue||0);if(x){const e=Math.round(o);m=Number((e-o).toFixed(2)),o=e}const u=a.reduce((t,s)=>(t[String(s)]=e.operationsStatus&&e.operationsStatus[s]||"pending",t),{}),p=a.reduce((t,s)=>{const a=e.operationsMeta&&e.operationsMeta[s]||{};return t[String(s)]={status:u[String(s)]||"pending",notes:a.notes||"",updatedAt:a.updatedAt||null,updatedBy:a.updatedBy||null,startedAt:a.startedAt||null,completedAt:a.completedAt||null},t},{});return{vendorId:String(e.vendorId||"").trim(),operation:a[0]?String(a[0]).trim():"",operations:a,operationsStatus:u,operationsMeta:p,description:String(e.description||""),deliveryDate:e.deliveryDate?e.deliveryDate instanceof Date?e.deliveryDate:new Date(e.deliveryDate):null,priority:e.priority||"medium",status:e.status||"pending",paymentTerms:String(null!==(t=e.paymentTerms)&&void 0!==t?t:"30"),shippingAddress:String(e.shippingAddress||""),billingAddress:String(e.billingAddress||""),currency:e.currency||"INR",invoiceDate:e.invoiceDate||null,dueDate:e.dueDate||null,stateOfSupply:String(e.stateOfSupply||""),taxRate:d,discountAmount:n,items:r,totalAmount:Number(i.toFixed(2)),taxAmount:Number(c.toFixed(2)),finalAmount:Number(o.toFixed(2)),roundOffEnabled:x,roundOffValue:m,specifications:String(e.specifications||""),qualityRequirements:String(e.qualityRequirements||""),expectedDeliveryDays:Number(e.expectedDeliveryDays||0)||0,warrantPeriod:String(e.warrantPeriod||""),terms:String(e.terms||""),poNumber:e.poNumber||null}}function d(e){const t=e.data()||{};return{id:e.id,...t}}async function c(e,t,s){try{await(0,a.gS)((0,a.rJ)(r.db,n),{poId:e,action:t,details:s||{},timestamp:(0,a.O5)()})}catch(i){}}async function o(e){const t=await(0,a.x7)((0,a.H9)(r.db,i,e));return t.exists()?d(t):null}async function x(e){const t=l(e),s=(0,a.O5)(),n=await(0,a.gS)((0,a.rJ)(r.db,i),{...t,createdAt:s,updatedAt:s});return await c(n.id,"create",{vendorId:t.vendorId,amount:t.finalAmount}),{id:n.id,...t}}async function m(e,t){const s=l(t);await(0,a.mZ)((0,a.H9)(r.db,i,e),{...s,updatedAt:(0,a.O5)()}),await c(e,"update",{status:s.status})}async function u(e){await(0,a.kd)((0,a.H9)(r.db,i,e)),await c(e,"delete")}async function p(e,t){const s=(0,a.wP)(r.db);e.forEach(e=>s.update((0,a.H9)(r.db,i,e),{...t,updatedAt:(0,a.O5)()})),await s.commit();for(const a of e)c(a,"bulk_update",{fields:t})}async function h(e){const t=(0,a.wP)(r.db);e.forEach(e=>t.delete((0,a.H9)(r.db,i,e))),await t.commit();for(const s of e)c(s,"bulk_delete")}}}]);
//# sourceMappingURL=452.9c97c906.chunk.js.map