"use strict";(self.webpackChunkvendor_management_system=self.webpackChunkvendor_management_system||[]).push([[442],{2442:(e,t,o)=>{o.r(t),o.d(t,{default:()=>v});var s=o(5043),r=o(5472),a=o(791),l=o(3505),n=o(5772),d=o(579);function i(e){let{item:t,onEdit:o,onDelete:s,onMarkGo:r,onMarkPickedUp:a,getVendorName:l,getStatusInfo:i,getPriorityInfo:c,getOperationInfo:m}=e;const u=i?i(t.status):{label:t.status},g=c?c(t.priority):{label:t.priority},x=m?m(t.operationType):{label:t.operationType};return(0,d.jsxs)("div",{className:"bg-white border border-gray-200 rounded-xl p-4 shadow-sm",children:[(0,d.jsxs)("div",{className:"flex items-start justify-between",children:[(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,d.jsx)("span",{className:`px-2 py-0.5 text-xs rounded-full ${x.color||"bg-gray-100 text-gray-800"}`,children:x.label||t.operationType}),(0,d.jsx)("span",{className:`px-2 py-0.5 text-xs rounded-full ${u.color||"bg-gray-100 text-gray-800"}`,children:u.label}),(0,d.jsx)("span",{className:`px-2 py-0.5 text-xs rounded-full ${g.color||"bg-gray-100 text-gray-800"}`,children:g.label})]}),(0,d.jsxs)("div",{className:"text-sm text-gray-800",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)(n.HzC,{className:"text-gray-400"})," ",(0,d.jsx)("span",{className:"font-medium",children:"Target:"})," ",t.targetLocation||"VMT Store"]}),(0,d.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,d.jsx)(n.cfS,{className:"text-gray-400"}),(0,d.jsx)("span",{className:"font-medium",children:"Vendors:"}),(t.vendors||[]).map((e,t)=>(0,d.jsxs)("span",{className:"ml-1 px-2 py-0.5 text-xs bg-gray-100 rounded",children:[l?l(e.vendorId):e.vendorId," (",e.bodiesCount||0,")"]},t))]}),t.notes&&(0,d.jsx)("div",{className:"mt-2 text-gray-600",children:t.notes}),t.poNumber&&(0,d.jsxs)("div",{className:"mt-1 text-xs text-gray-500",children:["PO: ",t.poNumber]}),t.itemDescription&&(0,d.jsxs)("div",{className:"mt-1 text-xs text-gray-500",children:["Item: ",t.itemDescription]})]})]}),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:["in-progress"!==t.status&&"completed"!==t.status&&(0,d.jsxs)("button",{onClick:()=>r&&r(t),className:"inline-flex items-center px-3 py-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200",title:"Mark Go",children:[(0,d.jsx)(n.aze,{className:"mr-1"})," Go"]}),"completed"!==t.status&&(0,d.jsxs)("button",{onClick:()=>a&&a(t),className:"inline-flex items-center px-3 py-2 bg-green-100 text-green-700 rounded-lg hover:bg-green-200",title:"Mark Picked Up",children:[(0,d.jsx)(n.A3x,{className:"mr-1"})," Picked Up"]}),(0,d.jsx)("button",{onClick:()=>o&&o(t),className:"inline-flex items-center px-3 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200",title:"Edit",children:(0,d.jsx)(n.WXf,{})}),(0,d.jsx)("button",{onClick:()=>s&&s(t.id),className:"inline-flex items-center px-3 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200",title:"Delete",children:(0,d.jsx)(n.IXo,{})})]})]}),(0,d.jsxs)("div",{className:"mt-3 text-xs text-gray-500 flex items-center gap-4",children:[(0,d.jsxs)("span",{className:"flex items-center gap-1",children:[(0,d.jsx)(n.Ohp,{})," Date: ",t.date]}),(0,d.jsxs)("span",{className:"flex items-center gap-1",children:[(0,d.jsx)(n.QsL,{})," Total Bodies: ",t.totalBodies||(t.vendors||[]).reduce((e,t)=>e+(parseInt(t.bodiesCount||0),0))]})]})]})}function c(e){let{formData:t,setFormData:o,vendors:s,operationTypes:r,priorities:a,statuses:l,onAdd:n,onClose:i,addVendorField:c,removeVendorField:m,updateVendorField:u}=e;return(0,d.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:(0,d.jsxs)("div",{className:"bg-white w-full max-w-2xl rounded-xl shadow-lg",children:[(0,d.jsx)("div",{className:"px-6 py-4 border-b",children:(0,d.jsx)("h2",{className:"text-lg font-semibold",children:"Add Manual Resource Plan"})}),(0,d.jsxs)("form",{onSubmit:n,className:"p-6 space-y-4",children:[(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date"}),(0,d.jsx)("input",{type:"date",value:t.date,onChange:e=>o({...t,date:e.target.value}),className:"w-full px-3 py-2 border rounded-lg",required:!0})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Operation"}),(0,d.jsx)("select",{value:t.operationType,onChange:e=>o({...t,operationType:e.target.value}),className:"w-full px-3 py-2 border rounded-lg",children:r.map(e=>(0,d.jsx)("option",{value:e.value,children:e.label},e.value))})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Target Location"}),(0,d.jsx)("input",{type:"text",value:t.targetLocation,onChange:e=>o({...t,targetLocation:e.target.value}),className:"w-full px-3 py-2 border rounded-lg"})]}),(0,d.jsxs)("div",{className:"space-y-3",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Vendors"}),(0,d.jsx)("button",{type:"button",onClick:c,className:"text-indigo-600 text-sm",children:"+ Add Vendor"})]}),t.vendors.map((e,o)=>(0,d.jsxs)("div",{className:"grid grid-cols-12 gap-2 items-center",children:[(0,d.jsx)("div",{className:"col-span-8",children:(0,d.jsxs)("select",{value:e.vendorId,onChange:e=>u(o,"vendorId",e.target.value),className:"w-full px-3 py-2 border rounded-lg",children:[(0,d.jsx)("option",{value:"",children:"Select vendor"}),s.map(e=>(0,d.jsx)("option",{value:e.id,children:e.name},e.id))]})}),(0,d.jsx)("div",{className:"col-span-3",children:(0,d.jsx)("input",{type:"number",min:1,value:e.bodiesCount,onChange:e=>u(o,"bodiesCount",e.target.value),className:"w-full px-3 py-2 border rounded-lg",placeholder:"Bodies"})}),(0,d.jsx)("div",{className:"col-span-1 text-right",children:t.vendors.length>1&&(0,d.jsx)("button",{type:"button",onClick:()=>m(o),className:"text-red-600 text-sm",children:"Remove"})})]},o))]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),(0,d.jsx)("select",{value:t.status,onChange:e=>o({...t,status:e.target.value}),className:"w-full px-3 py-2 border rounded-lg",children:l.map(e=>(0,d.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Priority"}),(0,d.jsx)("select",{value:t.priority,onChange:e=>o({...t,priority:e.target.value}),className:"w-full px-3 py-2 border rounded-lg",children:a.map(e=>(0,d.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),(0,d.jsx)("input",{type:"text",value:t.notes,onChange:e=>o({...t,notes:e.target.value}),className:"w-full px-3 py-2 border rounded-lg",placeholder:"Notes"})]})]}),(0,d.jsxs)("div",{className:"flex justify-end gap-3 pt-2",children:[(0,d.jsx)("button",{type:"button",onClick:i,className:"px-4 py-2 rounded-lg border",children:"Cancel"}),(0,d.jsx)("button",{type:"submit",className:"px-4 py-2 rounded-lg bg-indigo-600 text-white",children:"Add"})]})]})]})})}function m(e){let{item:t,vendors:o,operationTypes:r,priorities:a,statuses:l,onUpdate:n,onClose:i}=e;const[c,m]=(0,s.useState)({date:t.date||(new Date).toISOString().split("T")[0],operationType:t.operationType||"hbl",targetLocation:t.targetLocation||"VMT Store",notes:t.notes||"",status:t.status||"pending",priority:t.priority||"medium",vendors:t.vendors||[{vendorId:"",bodiesCount:1}]}),u=(e,t,o)=>{const s=[...c.vendors];s[e]={...s[e],[t]:o},m({...c,vendors:s})};return(0,d.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:(0,d.jsxs)("div",{className:"bg-white w-full max-w-2xl rounded-xl shadow-lg",children:[(0,d.jsx)("div",{className:"px-6 py-4 border-b",children:(0,d.jsx)("h2",{className:"text-lg font-semibold",children:"Edit Resource Plan"})}),(0,d.jsxs)("form",{onSubmit:e=>{e.preventDefault();const o=(c.vendors||[]).reduce((e,t)=>e+parseInt(t.bodiesCount||0),0);n(t.id,{...c,totalBodies:o,vendors:c.vendors.map(e=>({...e}))}),i()},className:"p-6 space-y-4",children:[(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date"}),(0,d.jsx)("input",{type:"date",value:c.date,onChange:e=>m({...c,date:e.target.value}),className:"w-full px-3 py-2 border rounded-lg"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Operation"}),(0,d.jsx)("select",{value:c.operationType,onChange:e=>m({...c,operationType:e.target.value}),className:"w-full px-3 py-2 border rounded-lg",children:r.map(e=>(0,d.jsx)("option",{value:e.value,children:e.label},e.value))})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Target Location"}),(0,d.jsx)("input",{type:"text",value:c.targetLocation,onChange:e=>m({...c,targetLocation:e.target.value}),className:"w-full px-3 py-2 border rounded-lg"})]}),(0,d.jsxs)("div",{className:"space-y-3",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Vendors"}),(0,d.jsx)("button",{type:"button",onClick:()=>m({...c,vendors:[...c.vendors,{vendorId:"",bodiesCount:1}]}),className:"text-indigo-600 text-sm",children:"+ Add Vendor"})]}),c.vendors.map((e,t)=>(0,d.jsxs)("div",{className:"grid grid-cols-12 gap-2 items-center",children:[(0,d.jsx)("div",{className:"col-span-8",children:(0,d.jsxs)("select",{value:e.vendorId,onChange:e=>u(t,"vendorId",e.target.value),className:"w-full px-3 py-2 border rounded-lg",children:[(0,d.jsx)("option",{value:"",children:"Select vendor"}),o.map(e=>(0,d.jsx)("option",{value:e.id,children:e.name},e.id))]})}),(0,d.jsx)("div",{className:"col-span-3",children:(0,d.jsx)("input",{type:"number",min:1,value:e.bodiesCount,onChange:e=>u(t,"bodiesCount",e.target.value),className:"w-full px-3 py-2 border rounded-lg",placeholder:"Bodies"})}),(0,d.jsx)("div",{className:"col-span-1 text-right",children:c.vendors.length>1&&(0,d.jsx)("button",{type:"button",onClick:()=>{return e=t,m({...c,vendors:c.vendors.filter((t,o)=>o!==e)});var e},className:"text-red-600 text-sm",children:"Remove"})})]},t))]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),(0,d.jsx)("select",{value:c.status,onChange:e=>m({...c,status:e.target.value}),className:"w-full px-3 py-2 border rounded-lg",children:l.map(e=>(0,d.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Priority"}),(0,d.jsx)("select",{value:c.priority,onChange:e=>m({...c,priority:e.target.value}),className:"w-full px-3 py-2 border rounded-lg",children:a.map(e=>(0,d.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),(0,d.jsx)("input",{type:"text",value:c.notes,onChange:e=>m({...c,notes:e.target.value}),className:"w-full px-3 py-2 border rounded-lg",placeholder:"Notes"})]})]}),(0,d.jsxs)("div",{className:"flex justify-end gap-3 pt-2",children:[(0,d.jsx)("button",{type:"button",onClick:i,className:"px-4 py-2 rounded-lg border",children:"Cancel"}),(0,d.jsx)("button",{type:"submit",className:"px-4 py-2 rounded-lg bg-indigo-600 text-white",children:"Save"})]})]})]})})}const u={HBL:{name:"Horizontal Boring",icon:n.i5c,color:"bg-blue-100 text-blue-800 border-blue-200"},VTL:{name:"Vertical Turning",icon:n.Ojn,color:"bg-purple-100 text-purple-800 border-purple-200"},Drilling:{name:"Drilling",icon:n.FrA,color:"bg-green-100 text-green-800 border-green-200"},VMC:{name:"Vertical Machining",icon:n.x_j,color:"bg-indigo-100 text-indigo-800 border-indigo-200"},Grinding:{name:"Grinding",icon:n.i5c,color:"bg-orange-100 text-orange-800 border-orange-200"},Assembly:{name:"Assembly",icon:n.i5c,color:"bg-indigo-100 text-indigo-800 border-indigo-200"},Painting:{name:"Painting",icon:n.i5c,color:"bg-pink-100 text-pink-800 border-pink-200"},Packing:{name:"Packing",icon:n.est,color:"bg-teal-100 text-teal-800 border-teal-200"}},g=(e,t)=>{const[o,r]=(0,s.useState)(e);return(0,s.useEffect)(()=>{const o=setTimeout(()=>{r(e)},t);return()=>{clearTimeout(o)}},[e,t]),o},x=e=>{let{message:t="Loading..."}=e;return(0,d.jsxs)("div",{className:"flex flex-col justify-center items-center h-64 space-y-4",children:[(0,d.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-500"}),(0,d.jsx)("p",{className:"text-gray-600",children:t})]})},p=e=>{let{error:t,onRetry:o}=e;return(0,d.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-xl p-6 text-center",children:[(0,d.jsx)(n.eHT,{className:"mx-auto text-red-500 mb-3",size:32}),(0,d.jsx)("h3",{className:"text-lg font-medium text-red-800 mb-2",children:"Something went wrong"}),(0,d.jsx)("p",{className:"text-red-600 mb-4",children:(null===t||void 0===t?void 0:t.message)||"An unexpected error occurred"}),(0,d.jsx)("button",{onClick:o,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Try Again"})]})},b=e=>{let{title:t,value:o,icon:s,color:r,subtitle:a}=e;return(0,d.jsx)("div",{className:`bg-gradient-to-br ${r} p-6 rounded-xl text-white shadow-sm`,children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"text-white/90 text-sm font-medium",children:t}),(0,d.jsx)("p",{className:"text-2xl font-bold mt-1",children:o}),a&&(0,d.jsx)("p",{className:"text-white/80 text-xs mt-1",children:a})]}),(0,d.jsx)("div",{className:"p-3 bg-white/20 rounded-lg",children:(0,d.jsx)(s,{size:24,className:"text-white/90"})})]})})},h=e=>{let{onSync:t,onRefresh:o,onAddManual:s,onExport:r,isLoading:a}=e;return(0,d.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,d.jsxs)("button",{onClick:t,disabled:a,className:"inline-flex items-center px-4 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white font-medium rounded-xl hover:from-green-600 hover:to-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 shadow-sm hover:shadow-md",children:[(0,d.jsx)(n.A3x,{className:"mr-2",size:16}),"Sync Completed Jobs"]}),(0,d.jsxs)("button",{onClick:o,disabled:a,className:"inline-flex items-center px-4 py-3 bg-gradient-to-r from-gray-500 to-slate-600 text-white font-medium rounded-xl hover:from-gray-600 hover:to-slate-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 shadow-sm hover:shadow-md",children:[(0,d.jsx)(n.jTZ,{className:"mr-2 "+(a?"animate-spin":""),size:16}),"Refresh"]}),(0,d.jsxs)("button",{onClick:s,className:"inline-flex items-center px-4 py-3 bg-gradient-to-r from-purple-500 to-indigo-600 text-white font-medium rounded-xl hover:from-purple-600 hover:to-indigo-700 transition-all duration-200 shadow-sm hover:shadow-md",children:[(0,d.jsx)(n.GGD,{className:"mr-2",size:16}),"Add Manual Plan"]}),(0,d.jsxs)("button",{onClick:r,className:"inline-flex items-center px-4 py-3 bg-gradient-to-r from-blue-500 to-cyan-600 text-white font-medium rounded-xl hover:from-blue-600 hover:to-cyan-700 transition-all duration-200 shadow-sm hover:shadow-md",children:[(0,d.jsx)(n.a4x,{className:"mr-2",size:16}),"Export"]})]})};function v(){const{showSuccess:e,showError:t,showWarning:o}=(0,l.hN)(),[v,y]=(0,s.useState)({vendors:[],todoItems:[],autoGeneratedTodos:[],completedOperations:[],loading:!0,error:null,syncing:!1,bulkActionIds:[]}),[f,j]=(0,s.useState)({showAddModal:!1,editingItem:null,selectedDate:(new Date).toISOString().split("T")[0],statusFilter:"all",operationFilter:"all",viewMode:"all",showCompleted:!0,searchQuery:"",showBulkActions:!1}),[N,w]=(0,s.useState)({filterOp:"all",vendorQuery:"",selectedKeys:[],visibleCount:9,creating:!1}),C=g(f.searchQuery,300),k=(0,s.useMemo)(()=>[{value:"hbl",label:"Horizontal Boring",color:"from-blue-500 to-blue-600",icon:n.i5c,bgColor:"bg-blue-100 text-blue-800 border-blue-200"},{value:"vtl",label:"Vertical Turning",color:"from-purple-500 to-purple-600",icon:n.Ojn,bgColor:"bg-purple-100 text-purple-800 border-purple-200"},{value:"drilling",label:"Drilling",color:"from-green-500 to-green-600",icon:n.FrA,bgColor:"bg-green-100 text-green-800 border-green-200"},{value:"vmc",label:"Vertical Machining",color:"from-indigo-500 to-indigo-600",icon:n.x_j,bgColor:"bg-indigo-100 text-indigo-800 border-indigo-200"},{value:"grinding",label:"Grinding",color:"from-orange-500 to-orange-600",icon:n.i5c,bgColor:"bg-orange-100 text-orange-800 border-orange-200"},{value:"assembly",label:"Assembly",color:"from-indigo-500 to-indigo-600",icon:n.i5c,bgColor:"bg-indigo-100 text-indigo-800 border-indigo-200"},{value:"painting",label:"Painting",color:"from-pink-500 to-pink-600",icon:n.i5c,bgColor:"bg-pink-100 text-pink-800 border-pink-200"},{value:"packing",label:"Packing",color:"from-teal-500 to-teal-600",icon:n.est,bgColor:"bg-teal-100 text-teal-800 border-teal-200"},{value:"other",label:"Other",color:"from-gray-500 to-gray-600",icon:n.i5c,bgColor:"bg-gray-100 text-gray-800 border-gray-200"}],[]),I=(0,s.useMemo)(()=>[{value:"high",label:"High Priority",color:"from-red-500 to-red-600",bgColor:"bg-red-100 text-red-800 border-red-200"},{value:"medium",label:"Medium Priority",color:"from-yellow-500 to-yellow-600",bgColor:"bg-yellow-100 text-yellow-800 border-yellow-200"},{value:"low",label:"Low Priority",color:"from-green-500 to-green-600",bgColor:"bg-green-100 text-green-800 border-green-200"}],[]),A=(0,s.useMemo)(()=>[{value:"pending",label:"Pending",color:"from-gray-500 to-gray-600",icon:n.Ohp,bgColor:"bg-gray-100 text-gray-800 border-gray-200"},{value:"in-progress",label:"In Progress",color:"from-blue-500 to-blue-600",icon:n.aze,bgColor:"bg-blue-100 text-blue-800 border-blue-200"},{value:"completed",label:"Completed",color:"from-green-500 to-green-600",icon:n.A3x,bgColor:"bg-green-100 text-green-800 border-green-200"},{value:"cancelled",label:"Cancelled",color:"from-red-500 to-red-600",icon:n.yGN,bgColor:"bg-red-100 text-red-800 border-red-200"}],[]),[T,M]=(0,s.useState)({date:(new Date).toISOString().split("T")[0],vendors:[{vendorId:"",bodiesCount:1}],operationType:"hbl",targetLocation:"VMT Store",notes:"",status:"pending",priority:"medium",source:"manual"}),S=e=>y(t=>({...t,...e})),O=e=>j(t=>({...t,...e})),D=(0,s.useCallback)(function(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Operation";console.error(`${o} error:`,e),S({error:{message:e.message,context:o}}),t(`${o} failed: ${e.message}`)},[t]),$=(0,s.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;for(let s=1;s<=t;s++)try{return await e()}catch(o){if(s===t)throw o;await new Promise(e=>setTimeout(e,1e3*s))}},[]),P=(0,s.useCallback)(async()=>{try{const e=(0,r.P)((0,r.rJ)(a.db,"purchaseOrders"),(0,r.AB)(1e3)),t=await $(()=>(0,r.GG)(e)),o=[];return t.forEach(e=>{const t={id:e.id,...e.data()},s=t.operationsStatus||{};Object.entries(s).forEach(e=>{let[s,r]=e;Object.entries(r).forEach(e=>{let[r,a]=e;if("completed"===a){var l,n,d,i,c,m,u;const e=(null===(l=t.items)||void 0===l?void 0:l[parseInt(s)])||{};o.push({poId:t.id,poNumber:t.poNumber,vendorId:t.vendorId,vendorName:t.vendorName||t.vendor||"Unknown Vendor",operation:r,itemIndex:parseInt(s),itemDescription:e.description||`Item ${parseInt(s)+1}`,quantity:e.quantity||1,unit:e.unit||"pcs",completedAt:(null===(n=t.operationsMeta)||void 0===n||null===(d=n[`${s}_${r}`])||void 0===d?void 0:d.completedAt)||t.updatedAt,createdAt:t.createdAt,vendorTodoCreated:(null===(i=t.operationsMeta)||void 0===i||null===(c=i[`${s}_${r}`])||void 0===c?void 0:c.vendorTodoCreated)||!1,vendorTodoId:(null===(m=t.operationsMeta)||void 0===m||null===(u=m[`${s}_${r}`])||void 0===u?void 0:u.vendorTodoId)||null})}})})}),S({completedOperations:o}),o}catch(e){return D(e,"Fetch completed operations"),[]}},[$,D]),L=(0,s.useCallback)(async t=>{if(!t.length)return[];try{const s=(0,r.wP)(a.db),l=[],n=[];for(const e of t){var o;if(e.vendorTodoCreated)continue;const t=(0,r.P)((0,r.rJ)(a.db,"vendorTodos"),(0,r._M)("poId","==",e.poId),(0,r._M)("operation","==",e.operation),(0,r._M)("itemIndex","==",e.itemIndex),(0,r._M)("source","==","statusManager"),(0,r.AB)(1)),d=await(0,r.GG)(t);if(!d.empty){n.push({...e,vendorTodoId:d.docs[0].id});continue}const i=(new Date).toISOString().slice(0,10),c=`todo_${e.poId}_${e.itemIndex}_${e.operation}_collect_${i}_${Math.random().toString(36).substr(2,9)}`,m=(0,r.H9)(a.db,"vendorTodos",c),g=(e.operation||"").toString().toLowerCase(),x=["hbl","vtl","drilling","vmc","grinding","assembly","painting","packing","other"].includes(g)?g:"other",p={id:c,date:i,vendors:e.vendorId?[{vendorId:e.vendorId,bodiesCount:e.quantity||1}]:[],totalBodies:e.quantity||1,operationType:x,targetLocation:"VMT Store",notes:`Collect material for ${(null===(o=u[e.operation])||void 0===o?void 0:o.name)||e.operation} - ${e.itemDescription} (PO ${e.poNumber})`,status:"pending",priority:"high",createdAt:(0,r.O5)(),updatedAt:(0,r.O5)(),vendorId:e.vendorId||null,vendorName:e.vendorName||null,poId:e.poId,poNumber:e.poNumber,operation:e.operation,itemIndex:e.itemIndex,itemDescription:e.itemDescription,source:"statusManager",autoGenerated:!0,syncVersion:1};s.set(m,p),l.push({id:c,...p}),n.push({...e,vendorTodoId:c})}for(const e of n){const t=(0,r.H9)(a.db,"purchaseOrders",e.poId),o=`${e.itemIndex}_${e.operation}`;s.update(t,{[`operationsMeta.${o}.vendorTodoCreated`]:!0,[`operationsMeta.${o}.vendorTodoId`]:e.vendorTodoId,[`operationsMeta.${o}.updatedAt`]:(0,r.O5)()})}return(l.length>0||n.length>0)&&(await $(()=>s.commit()),e(`Created ${l.length} new collection tasks`)),l}catch(s){throw D(s,"Auto-create vendor todos"),s}},[$,D,e]),V=(0,s.useCallback)(async()=>{try{S({loading:!0,error:null});const[e]=await Promise.all([$(()=>(0,r.GG)((0,r.rJ)(a.db,"vendors")))]),t=e.docs.map(e=>({id:e.id,...e.data()}));S({vendors:t});const o=await P();o.length>0&&(S({syncing:!0}),await L(o.filter(e=>!e.vendorTodoCreated)),S({syncing:!1})),await G()}catch(e){D(e,"Fetch data")}finally{S({loading:!1})}},[$,P,L,D]);(0,s.useEffect)(()=>{let e=null,t=null;return(async()=>{try{const o=(0,r.P)((0,r.rJ)(a.db,"purchaseOrders"));e=(0,r.aQ)(o,e=>{const t=[];e.docChanges().forEach(e=>{if("modified"===e.type||"added"===e.type){const o=e.doc.data(),s=o.operationsStatus||{};Object.entries(s).forEach(s=>{let[r,a]=s;Object.entries(a).forEach(s=>{let[a,l]=s;if("completed"===l){var n,d,i;const s=(null===(n=o.items)||void 0===n?void 0:n[parseInt(r)])||{};null!==(d=o.operationsMeta)&&void 0!==d&&null!==(i=d[`${r}_${a}`])&&void 0!==i&&i.vendorTodoCreated||t.push({poId:e.doc.id,poNumber:o.poNumber,vendorId:o.vendorId,vendorName:o.vendorName||o.vendor||"Unknown Vendor",operation:a,itemIndex:parseInt(r),itemDescription:s.description||`Item ${parseInt(r)+1}`,quantity:s.quantity||1,vendorTodoCreated:!1})}})})}}),t.length>0&&L(t)},e=>D(e,"Purchase orders listener"));const s=(0,r.P)((0,r.rJ)(a.db,"vendorTodos"),(0,r._M)("autoGenerated","==",!0),(0,r.AB)(500));t=(0,r.aQ)(s,e=>{const t=e.docs.map(e=>({id:e.id,...e.data()}));S(e=>({...e,autoGeneratedTodos:t}))},e=>D(e,"Auto-todos listener"))}catch(o){D(o,"Setup listeners")}})(),()=>{e&&e(),t&&t()}},[L,D]),(0,s.useEffect)(()=>{V()},[V,f.selectedDate]);const G=(0,s.useCallback)(async()=>{try{let t=[];try{const e=(0,r.P)((0,r.rJ)(a.db,"vendorTodos"),(0,r._M)("date","==",f.selectedDate),(0,r._M)("autoGenerated","==",!1),(0,r.My)("createdAt","desc"),(0,r.AB)(200)),o=await(0,r.GG)(e);t=o.docs.map(e=>({id:e.id,...e.data()}))}catch(e){if("failed-precondition"!==e.code)throw e;{const e=await(0,r.GG)((0,r.rJ)(a.db,"vendorTodos"));t=e.docs.map(e=>({id:e.id,...e.data()})).filter(e=>e.date===f.selectedDate&&!e.autoGenerated).sort((e,t)=>{var o,s;return new Date((null===(o=t.createdAt)||void 0===o?void 0:o.toDate())||0)-new Date((null===(s=e.createdAt)||void 0===s?void 0:s.toDate())||0)}).slice(0,200)}}S(e=>({...e,todoItems:t}))}catch(e){D(e,"Fetch todos")}},[f.selectedDate,D]),B=(0,s.useCallback)(()=>{const{viewMode:e,selectedDate:t}=f;let o=[];switch(e){case"manual":o=v.todoItems;break;case"auto":o=v.autoGeneratedTodos.filter(e=>!t||e.date===t);break;default:const e=[...v.todoItems,...v.autoGeneratedTodos.filter(e=>!t||e.date===t)];o=Array.from(new Map(e.map(e=>[e.id,e])).values())}if(C){const e=C.toLowerCase();o=o.filter(t=>{var o,s,r,a;return(null===(o=t.notes)||void 0===o?void 0:o.toLowerCase().includes(e))||(null===(s=t.vendorName)||void 0===s?void 0:s.toLowerCase().includes(e))||(null===(r=t.poNumber)||void 0===r?void 0:r.toLowerCase().includes(e))||(null===(a=t.itemDescription)||void 0===a?void 0:a.toLowerCase().includes(e))})}return o},[v.todoItems,v.autoGeneratedTodos,f,C]),_=e=>`${e.poId}_${e.itemIndex}_${e.operation}`,F=e=>{const t=(e=>{if(!e)return null;try{return"function"===typeof e.toDate?e.toDate():new Date(e)}catch{return null}})(e);if(!t||isNaN(t.getTime()))return null;const o=Date.now()-t.getTime();return Math.floor(o/864e5)},z=(0,s.useMemo)(()=>{let e=v.completedOperations||[];if("all"!==N.filterOp&&(e=e.filter(e=>(e.operation||"").toLowerCase()===N.filterOp)),N.vendorQuery){const t=N.vendorQuery.toLowerCase();e=e.filter(e=>(e.vendorName||"").toLowerCase().includes(t))}return e},[v.completedOperations,N.filterOp,N.vendorQuery]),E=()=>{w(e=>({...e,selectedKeys:[]}))},Q=(0,s.useMemo)(()=>B().filter(e=>{const t="all"===f.statusFilter||e.status===f.statusFilter,o="all"===f.operationFilter||e.operationType===f.operationFilter;return t&&o}),[B,f.statusFilter,f.operationFilter]),R=async t=>{try{await $(()=>(0,r.mZ)((0,r.H9)(a.db,"vendorTodos",t.id),{status:"in-progress",goAt:(0,r.O5)(),updatedAt:(0,r.O5)()})),e("Marked as going to vendor for pickup"),G()}catch(o){D(o,"Mark go")}},U=async t=>{try{const o=(0,r.wP)(a.db);if(o.update((0,r.H9)(a.db,"vendorTodos",t.id),{status:"completed",pickedUpAt:(0,r.O5)(),updatedAt:(0,r.O5)()}),t.autoGenerated&&t.poId&&t.operation&&void 0!==t.itemIndex){const e=(0,r.H9)(a.db,"purchaseOrders",t.poId),s=`${t.itemIndex}_${t.operation}`;o.update(e,{[`operationsMeta.${s}.materialCollected`]:!0,[`operationsMeta.${s}.collectedAt`]:(0,r.O5)(),[`operationsMeta.${s}.updatedAt`]:(0,r.O5)()})}await $(()=>o.commit()),e("Marked as picked up and job status updated"),G()}catch(o){D(o,"Mark picked up")}},H=async t=>{if(window.confirm("Are you sure you want to delete this todo item?"))try{await $(()=>(0,r.kd)((0,r.H9)(a.db,"vendorTodos",t))),e("Todo deleted successfully"),G()}catch(o){D(o,"Delete todo")}},K=e=>{const t=v.vendors.find(t=>t.id===e);return t?t.name:"Unknown Vendor"},J=e=>A.find(t=>t.value===e)||A[0],q=e=>I.find(t=>t.value===e)||I[1],Z=e=>k.find(t=>t.value===e)||k[0],W=e=>{var t;return(null===(t=u[e])||void 0===t?void 0:t.name)||e},X=(0,s.useMemo)(()=>{const e=B();return{totalBodies:e.reduce((e,t)=>e+(t.totalBodies||0),0),completedItems:e.filter(e=>"completed"===e.status).length,pendingItems:e.filter(e=>"pending"===e.status).length,inProgressItems:e.filter(e=>"in-progress"===e.status).length,cancelledItems:e.filter(e=>"cancelled"===e.status).length,totalItems:e.length}},[B]);return v.error?(0,d.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,d.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,d.jsx)(p,{error:v.error,onRetry:V})})}):(0,d.jsxs)("div",{className:"min-h-screen bg-gray-50 py-8",children:[v.loading?(0,d.jsx)(x,{message:"Loading vendor collection tasks..."}):(0,d.jsxs)("div",{className:"max-w-7xl mx-auto space-y-6 px-4",children:[(0,d.jsx)("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-200",children:(0,d.jsxs)("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4",children:[(0,d.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,d.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-xl flex items-center justify-center",children:(0,d.jsx)(n.BLY,{className:"text-white",size:24})}),(0,d.jsxs)("div",{children:[(0,d.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Vendor Material Collection"}),(0,d.jsx)("p",{className:"text-gray-600",children:"Manage vendor resource allocation and material collection from completed jobs"})]})]}),(0,d.jsx)(h,{onSync:async()=>{S({syncing:!0});try{const t=(await P()).filter(e=>!e.vendorTodoCreated);t.length>0?(await L(t),e(`Created ${t.length} new collection tasks`)):e("No new completed operations found")}catch(t){D(t,"Sync Completed Jobs")}finally{S({syncing:!1})}},onRefresh:V,onAddManual:()=>O({showAddModal:!0}),onExport:()=>{const t=Q.map(e=>{var t,o;return{"PO Number":e.poNumber,Vendor:e.vendorName,Operation:Z(e.operationType).label,"Item Description":e.itemDescription,Quantity:e.totalBodies,Status:J(e.status).label,Priority:q(e.priority).label,"Target Location":e.targetLocation,Notes:e.notes,"Created Date":(null===(t=e.createdAt)||void 0===t||null===(o=t.toDate())||void 0===o?void 0:o.toLocaleDateString())||"N/A"}}),o=[Object.keys(t[0]||{}).join(","),...t.map(e=>Object.values(e).map(e=>`"${e}"`).join(","))].join("\n"),s=new Blob([o],{type:"text/csv"}),r=window.URL.createObjectURL(s),a=document.createElement("a");a.href=r,a.download=`vendor-todos-${f.selectedDate}.csv`,a.click(),window.URL.revokeObjectURL(r),e("Data exported successfully")},isLoading:v.syncing})]})}),(0,d.jsx)("div",{className:"bg-white p-4 rounded-xl shadow-sm border border-gray-200",children:(0,d.jsx)("div",{className:"flex flex-wrap gap-2",children:[{value:"all",label:"All Tasks",color:"bg-indigo-100 text-indigo-700 border-indigo-300"},{value:"manual",label:"Manual Plans",color:"bg-blue-100 text-blue-700 border-blue-300"},{value:"auto",label:"Auto-Generated",color:"bg-green-100 text-green-700 border-green-300"}].map(e=>(0,d.jsx)("button",{onClick:()=>O({viewMode:e.value}),className:`px-4 py-2 rounded-lg font-medium transition-all duration-200 ${f.viewMode===e.value?e.color:"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:e.label},e.value))})}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,d.jsx)(b,{title:"Total Bodies",value:X.totalBodies,icon:n.cfS,color:"from-blue-500 to-indigo-600",subtitle:"Across all tasks"}),(0,d.jsx)(b,{title:"Completed",value:X.completedItems,icon:n.A3x,color:"from-green-500 to-emerald-600",subtitle:`${X.totalItems>0?Math.round(X.completedItems/X.totalItems*100):0}% completion rate`}),(0,d.jsx)(b,{title:"In Progress",value:X.inProgressItems,icon:n.aze,color:"from-orange-500 to-amber-600",subtitle:"Being processed"}),(0,d.jsx)(b,{title:"Pending",value:X.pendingItems,icon:n.Ohp,color:"from-red-500 to-rose-600",subtitle:"Awaiting action"})]}),(0,d.jsx)("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-200",children:(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Search"}),(0,d.jsxs)("div",{className:"relative",children:[(0,d.jsx)(n.CKj,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:16}),(0,d.jsx)("input",{type:"text",value:f.searchQuery,onChange:e=>O({searchQuery:e.target.value}),placeholder:"Search notes, vendor, PO...",className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date"}),(0,d.jsxs)("div",{className:"relative",children:[(0,d.jsx)(n.wIk,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:16}),(0,d.jsx)("input",{type:"date",value:f.selectedDate,onChange:e=>O({selectedDate:e.target.value}),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),(0,d.jsxs)("select",{value:f.statusFilter,onChange:e=>O({statusFilter:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:[(0,d.jsx)("option",{value:"all",children:"All Statuses"}),A.map(e=>(0,d.jsx)("option",{value:e.value,children:e.label},e.value))]})]}),(0,d.jsx)("div",{className:"flex items-end space-x-4",children:(0,d.jsxs)("label",{className:"flex items-center",children:[(0,d.jsx)("input",{type:"checkbox",checked:f.showCompleted,onChange:e=>O({showCompleted:e.target.checked}),className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),(0,d.jsx)("span",{className:"ml-2 text-sm text-gray-700",children:"Show completed"})]})})]})}),v.bulkActionIds.length>0&&(0,d.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-xl p-4",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,d.jsx)(n.eHT,{className:"text-yellow-600",size:20}),(0,d.jsxs)("span",{className:"text-yellow-800 font-medium",children:[v.bulkActionIds.length," items selected"]})]}),(0,d.jsxs)("div",{className:"flex space-x-2",children:[(0,d.jsxs)("select",{onChange:t=>(async t=>{if(0!==v.bulkActionIds.length)try{const o=(0,r.wP)(a.db);v.bulkActionIds.forEach(e=>{const s=(0,r.H9)(a.db,"vendorTodos",e);o.update(s,{status:t,updatedAt:(0,r.O5)()})}),await $(()=>o.commit()),e(`Updated ${v.bulkActionIds.length} items to ${t}`),S({bulkActionIds:[]}),O({showBulkActions:!1}),G()}catch(o){D(o,"Bulk status update")}})(t.target.value),className:"px-3 py-2 border border-yellow-300 rounded-lg bg-white",children:[(0,d.jsx)("option",{value:"",children:"Update Status"}),A.map(e=>(0,d.jsx)("option",{value:e.value,children:e.label},e.value))]}),(0,d.jsx)("button",{onClick:async()=>{if(0!==v.bulkActionIds.length&&window.confirm(`Are you sure you want to delete ${v.bulkActionIds.length} items?`))try{const t=(0,r.wP)(a.db);v.bulkActionIds.forEach(e=>{const o=(0,r.H9)(a.db,"vendorTodos",e);t.delete(o)}),await $(()=>t.commit()),e(`Deleted ${v.bulkActionIds.length} items`),S({bulkActionIds:[]}),O({showBulkActions:!1}),G()}catch(t){D(t,"Bulk delete")}},className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Delete Selected"}),(0,d.jsx)("button",{onClick:()=>S({bulkActionIds:[]}),className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"Cancel"})]})]})}),(0,d.jsxs)("div",{className:"space-y-6",children:[Q.filter(e=>"completed"!==e.status).length>0&&(0,d.jsxs)("div",{children:[(0,d.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[(0,d.jsx)(n.z1n,{className:"mr-2 text-blue-500"}),"Active Tasks (",Q.filter(e=>"completed"!==e.status).length,")"]}),(0,d.jsx)("div",{className:"grid gap-4",children:Q.filter(e=>"completed"!==e.status).map(e=>(0,d.jsx)(i,{item:e,onEdit:e=>O({editingItem:e}),onDelete:H,onMarkGo:R,onMarkPickedUp:U,getVendorName:K,getStatusInfo:J,getPriorityInfo:q,getOperationInfo:Z,onSelect:(e,t)=>{S(o=>({bulkActionIds:t?[...o.bulkActionIds,e]:o.bulkActionIds.filter(t=>t!==e)}))},isSelected:v.bulkActionIds.includes(e.id)},e.id))})]}),f.showCompleted&&Q.filter(e=>"completed"===e.status).length>0&&(0,d.jsxs)("div",{children:[(0,d.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[(0,d.jsx)(n.A3x,{className:"mr-2 text-green-500"}),"Completed (",Q.filter(e=>"completed"===e.status).length,")"]}),(0,d.jsx)("div",{className:"grid gap-4",children:Q.filter(e=>"completed"===e.status).map(e=>(0,d.jsx)(i,{item:e,onEdit:e=>O({editingItem:e}),onDelete:H,getVendorName:K,getStatusInfo:J,getPriorityInfo:q,getOperationInfo:Z,onSelect:(e,t)=>{S(o=>({bulkActionIds:t?[...o.bulkActionIds,e]:o.bulkActionIds.filter(t=>t!==e)}))},isSelected:v.bulkActionIds.includes(e.id)},e.id))})]}),0===Q.length&&(0,d.jsxs)("div",{className:"text-center py-16 bg-white rounded-xl border border-gray-200",children:[(0,d.jsx)(n.BLY,{className:"mx-auto text-gray-300 mb-4",size:64}),(0,d.jsx)("h3",{className:"text-xl font-medium text-gray-900 mb-2",children:"No collection tasks found"}),(0,d.jsx)("p",{className:"text-gray-500 mb-6",children:f.searchQuery?"No tasks match your search criteria.":`No ${"auto"===f.viewMode?"auto-generated":"manual"===f.viewMode?"manual":""} collection tasks found for the selected filters.`}),f.searchQuery&&(0,d.jsx)("button",{onClick:()=>O({searchQuery:""}),className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:"Clear Search"})]})]}),(0,d.jsxs)("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-200",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,d.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,d.jsx)("div",{className:"w-8 h-8 bg-gradient-to-br from-green-500 to-emerald-600 rounded-xl flex items-center justify-center",children:(0,d.jsx)(n.A3x,{className:"text-white",size:16})}),(0,d.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Completed Operations Ready for Collection"}),(0,d.jsxs)("span",{className:"px-3 py-1 bg-green-100 text-green-800 text-sm rounded-full font-medium",children:[z.length," operations"]})]}),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsxs)("button",{onClick:P,className:"flex items-center px-3 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:[(0,d.jsx)(n.jTZ,{size:14,className:"mr-2"}),"Refresh"]}),(0,d.jsx)("button",{onClick:()=>{const e=z.slice(0,N.visibleCount).map(_);w(t=>({...t,selectedKeys:e}))},className:"px-3 py-2 bg-indigo-100 text-indigo-700 rounded-lg hover:bg-indigo-200 transition-colors",children:"Select Visible"}),N.selectedKeys.length>0&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("button",{onClick:async()=>{if(0!==N.selectedKeys.length)try{w(e=>({...e,creating:!0}));const t=z.filter(e=>N.selectedKeys.includes(_(e))&&!e.vendorTodoCreated);if(0===t.length)return void e("No new operations to create tasks for");await L(t),e(`Created ${t.length} collection tasks`),E()}catch(t){D(t,"Bulk create collection tasks")}finally{w(e=>({...e,creating:!1}))}},disabled:N.creating,className:"px-3 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50",children:["Create Selected (",N.selectedKeys.length,")"]}),(0,d.jsx)("button",{onClick:E,className:"px-3 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700",children:"Clear"})]})]})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Operation"}),(0,d.jsxs)("select",{value:N.filterOp,onChange:e=>w(t=>({...t,filterOp:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[(0,d.jsx)("option",{value:"all",children:"All"}),k.map(e=>(0,d.jsx)("option",{value:e.value,children:e.label},e.value))]})]}),(0,d.jsxs)("div",{className:"md:col-span-2",children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Vendor"}),(0,d.jsx)("input",{type:"text",value:N.vendorQuery,onChange:e=>w(t=>({...t,vendorQuery:e.target.value})),placeholder:"Search vendor name...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]})]}),z.length>0?(0,d.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:z.slice(0,N.visibleCount).map((t,o)=>(0,d.jsxs)("div",{className:"border rounded-lg p-4 transition-all duration-200 "+(t.vendorTodoCreated?"bg-gray-50 border-gray-200":"bg-green-50 border-green-200 hover:bg-green-100"),children:[(0,d.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)("input",{type:"checkbox",checked:N.selectedKeys.includes(_(t)),onChange:()=>(e=>{const t=_(e);w(e=>({...e,selectedKeys:e.selectedKeys.includes(t)?e.selectedKeys.filter(e=>e!==t):[...e.selectedKeys,t]}))})(t),disabled:t.vendorTodoCreated}),(0,d.jsx)("span",{className:"font-medium text-gray-800",children:W(t.operation)})]}),(0,d.jsx)("span",{className:"text-xs px-2 py-1 rounded-full font-medium "+(t.vendorTodoCreated?"bg-gray-200 text-gray-800":"bg-green-200 text-green-800"),children:t.vendorTodoCreated?"Task Created":"Ready for pickup"})]}),(0,d.jsxs)("div",{className:"space-y-2 text-sm text-gray-700",children:[(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{children:"PO:"}),(0,d.jsx)("span",{className:"font-medium",children:t.poNumber})]}),(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{children:"Item:"}),(0,d.jsx)("span",{className:"font-medium truncate ml-2 max-w-[120px]",children:t.itemDescription})]}),(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{children:"Vendor:"}),(0,d.jsx)("span",{className:"font-medium",children:t.vendorName})]}),(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{children:"Qty:"}),(0,d.jsxs)("span",{className:"font-medium",children:[t.quantity," ",t.unit]})]}),(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{children:"Completed:"}),(0,d.jsx)("span",{className:"font-medium",children:(()=>{const e=F(t.completedAt||t.createdAt);return null===e?"N/A":`${e} day${1===e?"":"s"} ago`})()})]})]}),!t.vendorTodoCreated&&(0,d.jsx)("button",{onClick:()=>(async t=>{try{await L([t]),e("Collection task created for the completed operation")}catch(o){D(o,"Create task from operation")}})(t),className:"mt-3 w-full py-2 bg-green-500 text-white text-sm rounded-lg hover:bg-green-600 transition-colors font-medium",children:"Create Collection Task"})]},_(t)))}):(0,d.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,d.jsx)(n.A3x,{className:"mx-auto text-gray-300 mb-3",size:48}),(0,d.jsx)("p",{className:"text-lg font-medium text-gray-900 mb-2",children:"No completed operations"}),(0,d.jsx)("p",{className:"text-gray-600",children:"Completed operations from purchase orders will appear here automatically"})]}),z.length>N.visibleCount&&(0,d.jsx)("div",{className:"text-center mt-6",children:(0,d.jsxs)("button",{onClick:()=>w(e=>({...e,visibleCount:e.visibleCount+9})),className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700",children:["Load more (",z.length-N.visibleCount," more)"]})})]})]}),f.showAddModal&&(0,d.jsx)(c,{formData:T,setFormData:M,vendors:v.vendors,operationTypes:k,priorities:I,statuses:A,onAdd:async t=>{t.preventDefault();try{const t=T.vendors.reduce((e,t)=>e+parseInt(t.bodiesCount||1),0),o={...T,vendors:T.vendors.map(e=>({...e,vendorName:K(e.vendorId)})),totalBodies:t,createdAt:(0,r.O5)(),updatedAt:(0,r.O5)(),autoGenerated:!1,source:"manual"};await $(()=>(0,r.gS)((0,r.rJ)(a.db,"vendorTodos"),o)),M({date:(new Date).toISOString().split("T")[0],vendors:[{vendorId:"",bodiesCount:1}],operationType:"hbl",targetLocation:"VMT Store",notes:"",status:"pending",priority:"medium",source:"manual"}),O({showAddModal:!1}),G(),e("Resource plan added successfully")}catch(o){D(o,"Add todo")}},onClose:()=>O({showAddModal:!1}),addVendorField:()=>{M(e=>({...e,vendors:[...e.vendors,{vendorId:"",bodiesCount:1}]}))},removeVendorField:e=>{const t=[...T.vendors];t.splice(e,1),M(e=>({...e,vendors:t}))},updateVendorField:(e,t,o)=>{const s=[...T.vendors];s[e][t]=o,M(e=>({...e,vendors:s}))}}),f.editingItem&&(0,d.jsx)(m,{item:f.editingItem,vendors:v.vendors,operationTypes:k,priorities:I,statuses:A,onUpdate:async(t,o)=>{try{const s=(0,r.H9)(a.db,"vendorTodos",t);await $(()=>(0,r.mZ)(s,{...o,updatedAt:(0,r.O5)()})),e("Todo updated successfully"),G()}catch(s){D(s,"Update todo")}},onClose:()=>O({editingItem:null})})]})}}}]);
//# sourceMappingURL=442.473f00f0.chunk.js.map