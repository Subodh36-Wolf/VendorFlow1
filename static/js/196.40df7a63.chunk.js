"use strict";(self.webpackChunkvendor_management_system=self.webpackChunkvendor_management_system||[]).push([[196],{7196:(e,t,s)=>{s.r(t),s.d(t,{default:()=>u});var a=s(5043),r=s(5472),l=s(791),n=s(3505),i=s(8729),o=s(5772),d=s(579);const c={HBL:{name:"Horizontal Boring",icon:o.i5c,color:"blue"},VTL:{name:"Vertical Turning",icon:o.Ojn,color:"purple"},Drilling:{name:"Drilling",icon:o.FrA,color:"green"},VMC:{name:"Vertical Machining",icon:o.x_j,color:"indigo"}},x=async function(e,t,s,a){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";try{var i,o;const x=(0,r.H9)(l.db,"purchaseOrders",e),m=await(0,r.x7)(x);if(!m.exists())throw new Error("Purchase order not found");const p=m.data()||{},u=(null===(i=p.operationsStatus)||void 0===i?void 0:i[t])||"pending",g={...p.operationsStatus||{},[t]:s},h=Object.keys(c).length,y=Object.values(g).filter(e=>"completed"===e).length,j=Math.round(y/h*100);let b=p.status||"pending";y===h?b="completed":(y>0||Object.values(g).some(e=>"in_progress"===e))&&(b="in_progress");const f=(0,r.wP)(l.db),v={status:s,notes:n||"",updatedAt:(0,r.O5)(),updatedBy:{uid:(null===a||void 0===a?void 0:a.uid)||null,email:(null===a||void 0===a?void 0:a.email)||null,name:(null===a||void 0===a?void 0:a.displayName)||null}},N={};"in_progress"===s&&(N.startedAt=(0,r.O5)()),"completed"===s&&(N.completedAt=(0,r.O5)()),f.update(x,{operationsStatus:g,[`operationsMeta.${t}`]:{...(null===(o=p.operationsMeta)||void 0===o?void 0:o[t])||{},...v,...N},status:b,progress:j,updatedAt:(0,r.O5)()});try{(await(0,r.GG)((0,r.P)((0,r.rJ)(l.db,"deliveryChallans"),(0,r._M)("poId","==",e)))).forEach(e=>{f.update((0,r.H9)(l.db,"deliveryChallans",e.id),{poStatus:b,poProgress:j,updatedAt:(0,r.O5)()})})}catch(d){console.warn("DC propagation skipped/failed:",(null===d||void 0===d?void 0:d.message)||d)}const w=e=>{switch(e){case"completed":return"completed";case"in_progress":return"in-progress";default:return"assigned"}};try{const t=[];(await(0,r.GG)((0,r.P)((0,r.rJ)(l.db,"jobAssignments"),(0,r._M)("poId","==",e)))).forEach(e=>t.push(e.id));const s=p.poNumber;if(0===t.length&&s){(await(0,r.GG)((0,r.P)((0,r.rJ)(l.db,"jobAssignments"),(0,r._M)("reference","==",s)))).forEach(e=>t.push(e.id))}const a=w(b);t.forEach(e=>{f.update((0,r.H9)(l.db,"jobAssignments",e),{status:a,updatedAt:(0,r.O5)()})})}catch(d){console.warn("Job propagation skipped/failed:",(null===d||void 0===d?void 0:d.message)||d)}const S=(0,r.H9)((0,r.rJ)(l.db,"operationHistory"));return f.set(S,{itemId:e,itemType:"po_operation",operation:t,oldStatus:u,newStatus:s,notes:n||"",userId:(null===a||void 0===a?void 0:a.uid)||null,userName:(null===a||void 0===a?void 0:a.displayName)||(null===a||void 0===a?void 0:a.email)||"Unknown",timestamp:(0,r.O5)()}),await f.commit(),!0}catch(x){throw console.error("Error in operation status service:",x),x}},m=e=>{var t;let{item:s,history:a,onClose:r,getStatusColor:l,getStatusIcon:n,getVendorName:i}=e;return(0,d.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,d.jsxs)("div",{className:"bg-white rounded-xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[(0,d.jsxs)("div",{className:"p-6 border-b border-gray-200 flex justify-between items-center",children:[(0,d.jsxs)("h2",{className:"text-xl font-bold text-gray-900",children:["Operation History - ",s.poNumber]}),(0,d.jsx)("button",{onClick:r,className:"text-gray-400 hover:text-gray-600",children:(0,d.jsx)(o.yGN,{size:24})})]}),(0,d.jsxs)("div",{className:"p-6",children:[(0,d.jsxs)("div",{className:"mb-6 grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("h3",{className:"text-sm font-medium text-gray-500",children:"Vendor"}),(0,d.jsx)("p",{className:"text-lg font-medium",children:i(s.vendorId)})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("h3",{className:"text-sm font-medium text-gray-500",children:"Current Status"}),(0,d.jsxs)("p",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${l(s.status)}`,children:[n(s.status),(0,d.jsx)("span",{className:"ml-1 capitalize",children:null===(t=s.status)||void 0===t?void 0:t.replace("_"," ")})]})]})]}),(0,d.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Operation Timeline"}),a.length>0?(0,d.jsx)("div",{className:"space-y-4",children:a.map((e,t)=>{var s,r,l;return(0,d.jsxs)("div",{className:"flex",children:[(0,d.jsxs)("div",{className:"flex flex-col items-center mr-4",children:[(0,d.jsx)("div",{className:"w-3 h-3 rounded-full "+("completed"===e.newStatus?"bg-green-500":"in_progress"===e.newStatus?"bg-blue-500":"pending"===e.newStatus?"bg-yellow-500":"bg-gray-500")}),t<a.length-1&&(0,d.jsx)("div",{className:"w-0.5 h-16 bg-gray-300 my-1"})]}),(0,d.jsxs)("div",{className:"flex-1 pb-4",children:[(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"text-sm font-medium text-gray-900",children:(null===(s=c[e.operation])||void 0===s?void 0:s.name)||e.operation}),(0,d.jsx)("span",{className:"text-sm text-gray-500",children:(null===(r=e.timestamp)||void 0===r||null===(l=r.toDate)||void 0===l?void 0:l.call(r).toLocaleString())||"N/A"})]}),(0,d.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:["Changed from ",(0,d.jsx)("span",{className:"font-medium",children:e.oldStatus})," to ",(0,d.jsx)("span",{className:"font-medium",children:e.newStatus}),e.notes&&` - ${e.notes}`]}),(0,d.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["By: ",e.userName]})]})]},e.id||t)})}):(0,d.jsx)("div",{className:"text-center py-8 text-gray-500",children:"No history available for this operation"})]}),(0,d.jsx)("div",{className:"p-6 border-t border-gray-200 flex justify-end",children:(0,d.jsx)("button",{onClick:r,className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:"Close"})})]})})},p=e=>{var t;let{isOpen:s,onClose:r,operation:l,currentStatus:n,onStatusUpdate:i}=e;const[x,m]=(0,a.useState)(""),[p,u]=(0,a.useState)(n),[g,h]=(0,a.useState)(!1);(0,a.useEffect)(()=>{s&&(u(n),m(""))},[s,n]);return s?(0,d.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,d.jsxs)("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full",children:[(0,d.jsxs)("div",{className:"p-6 border-b border-gray-200",children:[(0,d.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Update Operation Status"}),(0,d.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:(null===(t=c[l])||void 0===t?void 0:t.name)||l})]}),(0,d.jsxs)("div",{className:"p-6 space-y-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),(0,d.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,d.jsxs)("button",{onClick:()=>u("pending"),className:"p-3 rounded-lg border text-center "+("pending"===p?"bg-yellow-100 border-yellow-500 text-yellow-700":"bg-gray-100 border-gray-300 text-gray-700 hover:bg-gray-200"),children:[(0,d.jsx)(o.Ohp,{className:"mx-auto mb-1"}),(0,d.jsx)("span",{className:"text-xs",children:"Pending"})]}),(0,d.jsxs)("button",{onClick:()=>u("in_progress"),className:"p-3 rounded-lg border text-center "+("in_progress"===p?"bg-blue-100 border-blue-500 text-blue-700":"bg-gray-100 border-gray-300 text-gray-700 hover:bg-gray-200"),children:[(0,d.jsx)(o.aze,{className:"mx-auto mb-1"}),(0,d.jsx)("span",{className:"text-xs",children:"In Progress"})]}),(0,d.jsxs)("button",{onClick:()=>u("completed"),className:"p-3 rounded-lg border text-center "+("completed"===p?"bg-green-100 border-green-500 text-green-700":"bg-gray-100 border-gray-300 text-gray-700 hover:bg-gray-200"),children:[(0,d.jsx)(o.A3x,{className:"mx-auto mb-1"}),(0,d.jsx)("span",{className:"text-xs",children:"Completed"})]})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes (Optional)"}),(0,d.jsx)("textarea",{value:x,onChange:e=>m(e.target.value),placeholder:"Add any notes about this status change...",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",rows:3})]})]}),(0,d.jsxs)("div",{className:"p-6 border-t border-gray-200 flex justify-end space-x-3",children:[(0,d.jsx)("button",{onClick:r,className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",disabled:g,children:"Cancel"}),(0,d.jsx)("button",{onClick:async()=>{if(p!==n){h(!0);try{await i(p,x),r()}catch(e){console.error("Error updating status:",e)}finally{h(!1)}}else r()},disabled:g||p===n,className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center",children:g?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Updating..."]}):"Update Status"})]})]})}):null};function u(){const{showSuccess:e,showError:t}=(0,n.hN)(),{currentUser:s}=(0,i.A)(),[u,j]=(0,a.useState)([]),[b,f]=(0,a.useState)([]),[v,N]=(0,a.useState)([]),[w,S]=(0,a.useState)(!0),[O,k]=(0,a.useState)({}),[C,A]=(0,a.useState)("operations"),[_,I]=(0,a.useState)(null),[M,P]=(0,a.useState)(!1),[E,$]=(0,a.useState)([]),[z,D]=(0,a.useState)({status:"all",operation:"all",search:"",dateRange:"all",vendor:"all"}),[V,T]=(0,a.useState)("table"),[G,U]=(0,a.useState)([]),[J,L]=(0,a.useState)(!1),[H,F]=(0,a.useState)({key:"createdAt",direction:"desc"}),[R,B]=(0,a.useState)(!1),W=(0,a.useRef)(null),[X,Z]=(0,a.useState)([]),[K,Q]=(0,a.useState)({}),[Y,q]=(0,a.useState)({isOpen:!1,poId:null,operation:null,currentStatus:null});(0,a.useEffect)(()=>{try{const e=localStorage.getItem("statusManagerFilters");if(e){const t=JSON.parse(e);D(e=>({...e,...t}))}}catch{}te();const e=()=>{L(window.innerWidth<768)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e),W.current&&clearInterval(W.current)}},[]),(0,a.useEffect)(()=>(R?(W.current&&clearInterval(W.current),W.current=setInterval(te,3e4)):W.current&&(clearInterval(W.current),W.current=null),()=>{W.current&&clearInterval(W.current)}),[R]),(0,a.useEffect)(()=>{try{localStorage.setItem("statusManagerFilters",JSON.stringify(z))}catch{}},[z]),(0,a.useEffect)(()=>{if(b.length>0&&v.length>0){const e={};v.forEach(t=>{const s=b.filter(e=>e.vendorId===t.id),a=[];s.forEach(e=>{Object.entries(e.operationsStatus||{}).forEach(s=>{let[r,l]=s;"completed"===l&&a.push({poNumber:e.poNumber,operation:r,completionDate:e.updatedAt||e.createdAt,vendor:t.name})})}),e[t.id]={name:t.name,totalPOs:s.length,totalOperations:a.length,completedOperations:a,efficiency:s.length>0?a.length/(s.length*Object.keys(c).length)*100:0,averageCompletionTime:ee(s)}}),Q(e),Z(Object.values(e).flatMap(e=>e.completedOperations).sort((e,t)=>new Date(t.completionDate)-new Date(e.completionDate)))}},[b,v]);const ee=e=>{let t=0,s=0;return e.forEach(e=>{Object.entries(e.operationsMeta||{}).forEach(e=>{let[a,r]=e;if(r.completedAt&&r.startedAt){const e=r.startedAt.toDate?r.startedAt.toDate():new Date(r.startedAt),a=r.completedAt.toDate?r.completedAt.toDate():new Date(r.completedAt);t+=a-e,s++}})}),s>0?t/s:0},te=async()=>{try{S(!0);const[e,t,s]=await Promise.all([(0,r.GG)((0,r.rJ)(l.db,"jobAssignments")),(0,r.GG)((0,r.P)((0,r.rJ)(l.db,"purchaseOrders"),(0,r.My)("createdAt","desc"))),(0,r.GG)((0,r.rJ)(l.db,"vendors"))]),a=[];e.forEach(e=>{a.push({id:e.id,...e.data()})});const n=[];t.forEach(e=>{const t=e.data();n.push({id:e.id,...t,operationsStatus:{...Object.keys(c).reduce((e,s)=>{var a;return{...e,[s]:(null===(a=t.operationsStatus)||void 0===a?void 0:a[s])||"pending"}},{}),...t.operationsStatus||{}}})});const i=[];s.forEach(e=>{i.push({id:e.id,...e.data()})}),j(a),f(n),N(i)}catch(e){console.error("Error fetching data:",e),t("Failed to load data")}finally{S(!1)}},se=async function(a,r,l){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";try{var i;k(e=>({...e,[`${a}_${r}`]:!0}));const t=b.find(e=>e.id===a),o=(null===t||void 0===t||null===(i=t.operationsStatus)||void 0===i?void 0:i[r])||"pending";await x(a,r,l,s||{},n),f(e=>e.map(e=>{if(e.id!==a)return e;const t={...e.operationsStatus||{},[r]:l},s=Object.keys(c).length,n=Object.values(t).filter(e=>"completed"===e).length,i=Math.round(n/s*100);let o=e.status||"pending";return n===s?o="completed":(n>0||Object.values(t).some(e=>"in_progress"===e))&&(o="in_progress"),{...e,operationsStatus:t,status:o,progress:i}})),e(`Updated ${c[r].name} from ${o} to ${l}`)}catch(o){console.error("Error updating operation status:",o),t("Failed to update operation status")}finally{k(e=>({...e,[`${a}_${r}`]:!1}))}},ae=e=>{const t=v.find(t=>t.id===e);return t?t.name:"Unknown Vendor"},re=e=>{switch(e){case"completed":return"bg-green-100 text-green-800";case"in_progress":return"bg-blue-100 text-blue-800";case"pending":return"bg-yellow-100 text-yellow-800";case"rejected":case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},le=e=>{switch(e){case"completed":return(0,d.jsx)(o.A3x,{className:"text-green-500"});case"in_progress":return(0,d.jsx)(o.aze,{className:"text-blue-500"});case"pending":return(0,d.jsx)(o.Ohp,{className:"text-yellow-500"});case"rejected":case"cancelled":return(0,d.jsx)(o.yGN,{className:"text-red-500"});default:return(0,d.jsx)(o.y3G,{className:"text-gray-500"})}},ne=(0,a.useMemo)(()=>b.filter(e=>{var t;const s="all"===z.status||e.status===z.status,a="all"===z.vendor||e.vendorId===z.vendor,r="all"===z.operation||e.operationsStatus&&z.operation in e.operationsStatus,l=(null===(t=e.poNumber)||void 0===t?void 0:t.toLowerCase().includes(z.search.toLowerCase()))||ae(e.vendorId).toLowerCase().includes(z.search.toLowerCase());let n=!0;if("all"!==z.dateRange&&e.createdAt){const t=e.createdAt.toDate?e.createdAt.toDate():new Date(e.createdAt),s=new Date,a=Math.floor((s-t)/864e5);switch(z.dateRange){case"today":n=0===a;break;case"week":n=a<=7;break;case"month":n=a<=30;break;default:n=!0}}return s&&a&&r&&l&&n}).sort((e,t)=>{const s=e[H.key],a=t[H.key];return"progress"===H.key?"asc"===H.direction?s-a:a-s:s<a?"asc"===H.direction?-1:1:s>a?"asc"===H.direction?1:-1:0}),[b,z,H]),ie=(0,a.useMemo)(()=>[...new Set(b.map(e=>e.vendorId))].map(e=>({id:e,name:ae(e)})).filter(e=>"Unknown Vendor"!==e.name),[b,v]);return w?(0,d.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,d.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-500"})}):(0,d.jsxs)("div",{className:"space-y-6",children:[(0,d.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,d.jsxs)("div",{className:"flex flex-col lg:flex-row lg:justify-between lg:items-start space-y-4 lg:space-y-0",children:[(0,d.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,d.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl flex items-center justify-center",children:(0,d.jsx)(o.z1n,{className:"text-white",size:24})}),(0,d.jsxs)("div",{children:[(0,d.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Machine Operations Manager"}),(0,d.jsx)("p",{className:"text-base text-gray-600 mt-1",children:"Track and manage all machine operations"})]})]}),(0,d.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,d.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[(0,d.jsx)(o.zd,{className:"text-indigo-500",size:16}),(0,d.jsx)("span",{children:"Live Updates"}),(0,d.jsx)("div",{className:"w-2 h-2 rounded-full animate-pulse "+(R?"bg-green-400":"bg-gray-400")})]}),(0,d.jsx)("button",{onClick:()=>B(!R),className:"p-2 rounded-lg transition-all duration-200 "+(R?"bg-green-100 text-green-600 hover:bg-green-200":"bg-gray-100 text-gray-600 hover:bg-gray-200"),title:R?"Disable auto-refresh":"Enable auto-refresh",children:(0,d.jsx)(o.jTZ,{className:R?"animate-spin":"",size:16})}),(0,d.jsxs)("button",{onClick:te,className:"inline-flex items-center px-4 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-lg hover:from-indigo-700 hover:to-purple-700 transition-all duration-200 shadow-lg hover:shadow-xl",children:[(0,d.jsx)(o.jTZ,{className:"mr-2",size:16}),"Refresh Data"]})]})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mt-6",children:[(0,d.jsx)("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 p-4 rounded-lg border border-blue-100",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"text-blue-600 text-sm font-medium",children:"Total POs"}),(0,d.jsx)("p",{className:"text-2xl font-bold text-blue-900",children:b.length})]}),(0,d.jsx)(o.jH2,{className:"text-blue-500",size:24})]})}),(0,d.jsx)("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 p-4 rounded-lg border border-green-100",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"text-green-600 text-sm font-medium",children:"Completed Ops"}),(0,d.jsx)("p",{className:"text-2xl font-bold text-green-900",children:X.length})]}),(0,d.jsx)(o.A3x,{className:"text-green-500",size:24})]})}),(0,d.jsx)("div",{className:"bg-gradient-to-br from-yellow-50 to-orange-50 p-4 rounded-lg border border-yellow-100",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"text-yellow-600 text-sm font-medium",children:"In Progress"}),(0,d.jsx)("p",{className:"text-2xl font-bold text-yellow-900",children:b.filter(e=>"in_progress"===e.status).length})]}),(0,d.jsx)(o.aze,{className:"text-yellow-500",size:24})]})}),(0,d.jsx)("div",{className:"bg-gradient-to-br from-purple-50 to-pink-50 p-4 rounded-lg border border-purple-100",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"text-purple-600 text-sm font-medium",children:"Active Vendors"}),(0,d.jsx)("p",{className:"text-2xl font-bold text-purple-900",children:ie.length})]}),(0,d.jsx)(o.JXP,{className:"text-purple-500",size:24})]})})]})]}),(0,d.jsx)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-2",children:(0,d.jsx)("nav",{className:"flex space-x-2",children:["operations","vendors","completed"].map(e=>(0,d.jsx)("button",{onClick:()=>A(e),className:"flex-1 py-3 px-4 rounded-lg font-medium text-sm transition-all duration-200 "+(C===e?"bg-gradient-to-r from-indigo-500 to-purple-600 text-white shadow-lg":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"),children:(0,d.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:["operations"===e&&(0,d.jsx)(o.z1n,{size:16}),"vendors"===e&&(0,d.jsx)(o.vQY,{size:16}),"completed"===e&&(0,d.jsx)(o.A3x,{size:16}),(0,d.jsx)("span",{className:"capitalize",children:e})]})},e))})}),(0,d.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[(0,d.jsxs)("aside",{className:"lg:col-span-1 space-y-4",children:[(0,d.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200 sticky top-4",children:[(0,d.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Filters"}),(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)("div",{className:"relative",children:[(0,d.jsx)(o.CKj,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:16}),(0,d.jsx)("input",{type:"text",placeholder:"Search POs or vendors...",value:z.search,onChange:e=>D(t=>({...t,search:e.target.value})),className:"w-full pl-10 pr-4 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),(0,d.jsxs)("select",{value:z.status,onChange:e=>D(t=>({...t,status:e.target.value})),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",children:[(0,d.jsx)("option",{value:"all",children:"All Status"}),(0,d.jsx)("option",{value:"pending",children:"Pending"}),(0,d.jsx)("option",{value:"in_progress",children:"In Progress"}),(0,d.jsx)("option",{value:"completed",children:"Completed"})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Operation"}),(0,d.jsxs)("select",{value:z.operation,onChange:e=>D(t=>({...t,operation:e.target.value})),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",children:[(0,d.jsx)("option",{value:"all",children:"All Operations"}),Object.keys(c).map(e=>(0,d.jsx)("option",{value:e,children:c[e].name},e))]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Vendor"}),(0,d.jsxs)("select",{value:z.vendor,onChange:e=>D(t=>({...t,vendor:e.target.value})),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",children:[(0,d.jsx)("option",{value:"all",children:"All Vendors"}),ie.map(e=>(0,d.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Time Range"}),(0,d.jsxs)("select",{value:z.dateRange,onChange:e=>D(t=>({...t,dateRange:e.target.value})),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",children:[(0,d.jsx)("option",{value:"all",children:"All Time"}),(0,d.jsx)("option",{value:"today",children:"Today"}),(0,d.jsx)("option",{value:"week",children:"This Week"}),(0,d.jsx)("option",{value:"month",children:"This Month"})]})]}),(0,d.jsxs)("div",{className:"flex items-center justify-between pt-2",children:[(0,d.jsxs)("span",{className:"text-xs text-gray-500",children:[ne.length," POs"]}),(0,d.jsx)("button",{className:"text-xs text-indigo-600 hover:text-indigo-800",onClick:()=>D({status:"all",operation:"all",search:"",dateRange:"all",vendor:"all"}),children:"Clear Filters"})]})]})]}),"vendors"!==C&&(0,d.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200",children:[(0,d.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Vendor Performance"}),(0,d.jsxs)("div",{className:"space-y-4",children:[Object.entries(K).sort((e,t)=>{let[,s]=e,[,a]=t;return a.efficiency-s.efficiency}).slice(0,3).map(e=>{let[t,s]=e;return(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,d.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:s.name}),(0,d.jsxs)("p",{className:"text-xs text-gray-500",children:[s.totalOperations," completed operations"]})]}),(0,d.jsxs)("div",{className:"flex items-center",children:[(0,d.jsx)("div",{className:"w-16 bg-gray-200 rounded-full h-2 mr-2",children:(0,d.jsx)("div",{className:"bg-green-600 h-2 rounded-full",style:{width:`${Math.min(s.efficiency,100)}%`}})}),(0,d.jsxs)("span",{className:"text-xs font-medium text-gray-700",children:[Math.round(s.efficiency),"%"]})]})]},t)}),(0,d.jsx)("button",{onClick:()=>A("vendors"),className:"w-full text-center text-sm text-indigo-600 hover:text-indigo-800 mt-2",children:"View all vendors \u2192"})]})]})]}),(0,d.jsxs)("section",{className:"lg:col-span-3",children:["operations"===C&&(0,d.jsx)(g,{pos:ne,vendors:v,updating:O,onUpdateOperationStatus:se,onOpenTracker:(e,t)=>{I({...e,type:t}),P(!0),(async(e,t)=>{try{const s=(0,r.P)((0,r.rJ)(l.db,"operationHistory"),(0,r._M)("itemId","==",e),(0,r._M)("itemType","==",t),(0,r.My)("timestamp","desc")),a=await(0,r.GG)(s),n=[];a.forEach(e=>{n.push({id:e.id,...e.data()})}),$(n)}catch(s){console.error("Error fetching operation history:",s),$([])}})(e.id,t)},onOpenStatusUpdateModal:(e,t,s)=>{q({isOpen:!0,poId:e,operation:t,currentStatus:s})},getVendorName:ae,getStatusColor:re,getStatusIcon:le,getOperationIcon:e=>{var t,s;const a=(null===(t=c[e])||void 0===t?void 0:t.icon)||o.i5c;return(0,d.jsx)(a,{className:`text-${null===(s=c[e])||void 0===s?void 0:s.color}-500`})}}),"vendors"===C&&(0,d.jsx)(h,{vendorPerformance:K,getVendorName:ae}),"completed"===C&&(0,d.jsx)(y,{completedOperations:X,vendors:v,getVendorName:ae})]})]}),M&&_&&(0,d.jsx)(m,{item:_,history:E,onClose:()=>{P(!1),I(null),te()},getStatusColor:re,getStatusIcon:le,getVendorName:ae}),(0,d.jsx)(p,{isOpen:Y.isOpen,onClose:()=>{q({isOpen:!1,poId:null,operation:null,currentStatus:null})},operation:Y.operation,currentStatus:Y.currentStatus,onStatusUpdate:async(e,t)=>{const{poId:s,operation:a}=Y;await se(s,a,e,t)}})]})}function g(e){let{pos:t,vendors:s,updating:r,onUpdateOperationStatus:l,onOpenTracker:n,onOpenStatusUpdateModal:i,getVendorName:x,getStatusColor:m,getStatusIcon:p,getOperationIcon:u}=e;const[g,h]=(0,a.useState)(null),y=(e,t,s)=>{l(e,t,s,`Status changed to ${s}`)};return(0,d.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:(0,d.jsxs)("div",{className:"overflow-x-auto",children:[(0,d.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,d.jsx)("thead",{className:"bg-gray-50",children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"PO Details"}),(0,d.jsx)("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Vendor"}),(0,d.jsx)("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Progress"}),(0,d.jsx)("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,d.jsx)("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,d.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(e=>{var t,s,a,l;return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("tr",{className:"hover:bg-gray-50 cursor-pointer",onClick:()=>{return t=e.id,void h(g===t?null:t);var t},children:[(0,d.jsx)("td",{className:"px-4 py-4 whitespace-nowrap",children:(0,d.jsx)("div",{className:"flex items-center",children:(0,d.jsxs)("div",{className:"ml-4",children:[(0,d.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.poNumber}),(0,d.jsx)("div",{className:"text-sm text-gray-500",children:(null===(t=e.createdAt)||void 0===t||null===(s=t.toDate)||void 0===s||null===(a=s.call(t))||void 0===a?void 0:a.toLocaleDateString())||"N/A"})]})})}),(0,d.jsx)("td",{className:"px-4 py-4 whitespace-nowrap",children:(0,d.jsx)("div",{className:"text-sm text-gray-900",children:x(e.vendorId)})}),(0,d.jsx)("td",{className:"px-4 py-4 whitespace-nowrap",children:(0,d.jsxs)("div",{className:"flex items-center",children:[(0,d.jsx)("div",{className:"w-32 bg-gray-200 rounded-full h-2.5 mr-4",children:(0,d.jsx)("div",{className:"bg-indigo-600 h-2.5 rounded-full",style:{width:`${e.progress||0}%`}})}),(0,d.jsxs)("span",{className:"text-sm font-medium text-gray-700",children:[e.progress||0,"%"]})]})}),(0,d.jsx)("td",{className:"px-4 py-4 whitespace-nowrap",children:(0,d.jsxs)("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${m(e.status)}`,children:[p(e.status),(0,d.jsx)("span",{className:"ml-1 capitalize",children:null===(l=e.status)||void 0===l?void 0:l.replace("_"," ")})]})}),(0,d.jsx)("td",{className:"px-4 py-4 whitespace-nowrap text-sm font-medium",children:(0,d.jsx)("div",{className:"flex space-x-2",children:(0,d.jsx)("button",{onClick:t=>{t.stopPropagation(),n(e,"po")},className:"text-indigo-600 hover:text-indigo-900",children:"View Details"})})})]},e.id),g===e.id&&(0,d.jsx)("tr",{className:"bg-gray-50",children:(0,d.jsx)("td",{colSpan:5,className:"px-4 py-4",children:(0,d.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:Object.entries(c).map(t=>{var s;let[a,l]=t;const n=(null===(s=e.operationsStatus)||void 0===s?void 0:s[a])||"pending",o=l.icon,c=r[`${e.id}_${a}`];return(0,d.jsxs)("div",{className:"bg-white rounded-lg p-4 shadow-sm border border-gray-200",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,d.jsxs)("div",{className:"flex items-center",children:[(0,d.jsx)(o,{className:`text-${l.color}-500 mr-2`}),(0,d.jsx)("div",{className:"text-sm font-medium text-gray-900",children:l.name})]}),(0,d.jsxs)("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${m(n)}`,children:[p(n),(0,d.jsx)("span",{className:"ml-1 capitalize",children:n.replace("_"," ")})]})]}),(0,d.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,d.jsx)("button",{onClick:()=>i(e.id,a,n),className:"w-full py-2 px-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors text-sm font-medium",children:"Update Status"}),(0,d.jsxs)("div",{className:"flex space-x-1",children:[(0,d.jsx)("button",{onClick:()=>y(e.id,a,"pending"),disabled:c||"pending"===n,className:`flex-1 py-1 px-2 text-xs rounded ${"pending"===n?"bg-yellow-100 text-yellow-800 border border-yellow-300":"bg-gray-100 text-gray-700 hover:bg-gray-200"} ${c?"opacity-50 cursor-not-allowed":""}`,children:c&&"pending"===n?"...":"Pending"}),(0,d.jsx)("button",{onClick:()=>y(e.id,a,"in_progress"),disabled:c||"in_progress"===n,className:`flex-1 py-1 px-2 text-xs rounded ${"in_progress"===n?"bg-blue-100 text-blue-800 border border-blue-300":"bg-gray-100 text-gray-700 hover:bg-gray-200"} ${c?"opacity-50 cursor-not-allowed":""}`,children:c&&"in_progress"===n?"...":"Start"}),(0,d.jsx)("button",{onClick:()=>y(e.id,a,"completed"),disabled:c||"completed"===n,className:`flex-1 py-1 px-2 text-xs rounded ${"completed"===n?"bg-green-100 text-green-800 border border-green-300":"bg-gray-100 text-gray-700 hover:bg-gray-200"} ${c?"opacity-50 cursor-not-allowed":""}`,children:c&&"completed"===n?"...":"Complete"})]})]})]},a)})})})})]})})})]}),0===t.length&&(0,d.jsxs)("div",{className:"text-center py-12",children:[(0,d.jsx)(o.jH2,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,d.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No purchase orders found"}),(0,d.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"No purchase orders match your current filters."})]})]})})}function h(e){let{vendorPerformance:t,getVendorName:s}=e;const a=e=>{if(!e)return"N/A";const t=Math.floor(e/36e5),s=Math.floor(e%36e5/6e4);return t>0?`${t}h ${s}m`:`${s}m`};return(0,d.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[(0,d.jsxs)("div",{className:"px-6 py-4 border-b border-gray-200",children:[(0,d.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Vendor Performance"}),(0,d.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Efficiency based on completed operations"})]}),(0,d.jsxs)("div",{className:"overflow-x-auto",children:[(0,d.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,d.jsx)("thead",{className:"bg-gray-50",children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Vendor"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total POs"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Completed Operations"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Efficiency"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Avg. Completion Time"})]})}),(0,d.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:Object.entries(t).sort((e,t)=>{let[,s]=e,[,a]=t;return a.efficiency-s.efficiency}).map(e=>{let[t,s]=e;return(0,d.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,d.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,d.jsx)("div",{className:"text-sm font-medium text-gray-900",children:s.name})}),(0,d.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,d.jsx)("div",{className:"text-sm text-gray-900",children:s.totalPOs})}),(0,d.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,d.jsx)("div",{className:"text-sm text-gray-900",children:s.totalOperations})}),(0,d.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,d.jsxs)("div",{className:"flex items-center",children:[(0,d.jsx)("div",{className:"w-32 bg-gray-200 rounded-full h-2.5 mr-4",children:(0,d.jsx)("div",{className:"bg-green-600 h-2.5 rounded-full",style:{width:`${Math.min(s.efficiency,100)}%`}})}),(0,d.jsxs)("span",{className:"text-sm font-medium text-gray-700",children:[Math.round(s.efficiency),"%"]})]})}),(0,d.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,d.jsx)("div",{className:"text-sm text-gray-500",children:a(s.averageCompletionTime)})})]},t)})})]}),0===Object.keys(t).length&&(0,d.jsxs)("div",{className:"text-center py-12",children:[(0,d.jsx)(o.JXP,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,d.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No vendor data available"}),(0,d.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Vendor performance data will appear here once operations are completed."})]})]})]})}function y(e){let{completedOperations:t,getVendorName:s}=e;return(0,d.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[(0,d.jsxs)("div",{className:"px-6 py-4 border-b border-gray-200",children:[(0,d.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Completed Operations"}),(0,d.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"All machine operations that have been completed"})]}),(0,d.jsxs)("div",{className:"overflow-x-auto",children:[(0,d.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,d.jsx)("thead",{className:"bg-gray-50",children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"PO Number"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Operation"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Vendor"}),(0,d.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Completed On"})]})}),(0,d.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map((e,t)=>{var s,a,r,l;return(0,d.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,d.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,d.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.poNumber})}),(0,d.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,d.jsx)("div",{className:"text-sm text-gray-900",children:(null===(s=c[e.operation])||void 0===s?void 0:s.name)||e.operation})}),(0,d.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,d.jsx)("div",{className:"text-sm text-gray-900",children:e.vendor})}),(0,d.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,d.jsx)("div",{className:"text-sm text-gray-500",children:(null===(a=e.completionDate)||void 0===a||null===(r=a.toDate)||void 0===r||null===(l=r.call(a))||void 0===l?void 0:l.toLocaleDateString())||"N/A"})})]},t)})})]}),0===t.length&&(0,d.jsxs)("div",{className:"text-center py-12",children:[(0,d.jsx)(o.A3x,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,d.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No completed operations"}),(0,d.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Completed operations will appear here once they're finished."})]})]})]})}}}]);
//# sourceMappingURL=196.40df7a63.chunk.js.map