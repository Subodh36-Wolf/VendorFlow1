"use strict";(self.webpackChunkvendor_management_system=self.webpackChunkvendor_management_system||[]).push([[318],{613:(e,t,a)=>{a.d(t,{I$:()=>p,KS:()=>c,PX:()=>m,PY:()=>x,aR:()=>u,zH:()=>l});var r=a(5472),s=a(791);const n="deliveryChallans",i="dcActivity";function l(e){const t=(Array.isArray(e.items)?e.items:[]).map(e=>{const t=Number(e.quantity)||0,a=Number(e.price)||0;return{description:String(e.description||"").trim(),hsnCode:String(e.hsnCode||""),quantity:t,unit:String(e.unit||"Nos"),price:a,amount:Number((t*a).toFixed(2)),itemId:e.itemId||null}}),a=t.reduce((e,t)=>e+(Number(t.amount)||0),0),r=t.reduce((e,t)=>e+(Number(t.quantity)||0),0);return{challanNumber:String(e.challanNumber||"").trim(),date:e.date||(new Date).toISOString().split("T")[0],poId:e.poId?String(e.poId):null,poNumber:e.poNumber?String(e.poNumber):e.reference?String(e.reference):"",vendorId:String(e.vendorId||"").trim(),vendorName:String(e.vendorName||""),vendorAddress:String(e.vendorAddress||""),reference:String(e.reference||""),vehicleNo:String(e.vehicleNo||""),driverName:String(e.driverName||""),remarks:String(e.remarks||""),items:t,totalAmount:Number(a.toFixed(2)),totalQuantity:r,amountInWords:String(e.amountInWords||"")}}function o(e){return{id:e.id,...e.data()}}async function d(e,t,a){try{await(0,r.gS)((0,r.rJ)(s.db,i),{dcId:e,action:t,details:a||{},timestamp:(0,r.O5)()})}catch(n){}}async function c(e){const t=await(0,r.x7)((0,r.H9)(s.db,n,e));return t.exists()?o(t):null}async function u(e){const t=l(e),a=(0,r.O5)(),i=await(0,r.gS)((0,r.rJ)(s.db,n),{...t,createdAt:a,updatedAt:a});return await d(i.id,"create",{vendorId:t.vendorId,totalAmount:t.totalAmount}),{id:i.id,...t}}async function m(e,t){const a=l(t);await(0,r.mZ)((0,r.H9)(s.db,n,e),{...a,updatedAt:(0,r.O5)()}),await d(e,"update")}async function x(e){await(0,r.kd)((0,r.H9)(s.db,n,e)),await d(e,"delete")}async function p(e){const t=(0,r.wP)(s.db);e.forEach(e=>t.delete((0,r.H9)(s.db,n,e))),await t.commit();for(const a of e)d(a,"bulk_delete")}},2318:(e,t,a)=>{a.r(t),a.d(t,{default:()=>m});var r=a(5043),s=a(3216),n=a(5472),i=a(791),l=a(613),o=a(9295),d=a(3505),c=a(5772),u=a(579);function m(){const e=(0,s.Zp)(),{id:t}=(0,s.g)(),a=Boolean(t),{showSuccess:m,showError:p}=(0,d.hN)(),[g,h]=(0,r.useState)(!1),[v,b]=(0,r.useState)([]),[f,y]=(0,r.useState)([]),[N,j]=(0,r.useState)({challanNumber:"",date:(new Date).toISOString().split("T")[0],invoiceDate:(new Date).toISOString().split("T")[0],dueDate:(new Date).toISOString().split("T")[0],stateOfSupply:"",vendorId:"",vendorName:"",vendorAddress:"",reference:"",vehicleNo:"",driverName:"",remarks:"",items:[{id:Date.now(),description:"",hsnCode:"",quantity:1,unit:"Nos",price:0,amount:0}],discountType:"amount",discountValue:0,taxRate:0,taxAmount:0,subtotal:0,finalAmount:0,roundOffEnabled:!0,roundOffValue:0,paymentType:"Cash",approvalRequired:!1});(0,r.useEffect)(()=>{w()},[N.items,N.discountType,N.discountValue,N.taxRate]);const w=(0,r.useCallback)(()=>{const e=N.items.reduce((e,t)=>e+(Number(t.amount)||0),0);let t=0;t="percentage"===N.discountType?e*(N.discountValue||0)/100:Number(N.discountValue)||0;const a=Math.max(0,e-t),r=a*(N.taxRate||0)/100;let s=a+r,n=0;N.roundOffEnabled&&(n=Math.round(s)-s,s=Math.round(s)),j(a=>({...a,subtotal:e,discountAmount:t,taxAmount:r,finalAmount:s,roundOffValue:n}))},[N.items,N.discountType,N.discountValue,N.taxRate,N.roundOffEnabled]);(0,r.useEffect)(()=>{k(),S(),a&&C()},[t]);const k=async()=>{try{const e=(await(0,n.GG)((0,n.rJ)(i.db,"vendors"))).docs.map(e=>({id:e.id,...e.data()}));b(e)}catch(e){console.error(e)}},S=async()=>{try{const e=await(0,o.E4)();y(e)}catch(e){console.error(e)}},C=async()=>{try{const e=await(0,l.KS)(t);e&&j(t=>({...t,...e}))}catch(e){console.error("Failed to load challan",e),p("Failed to load challan")}},A=(e,t)=>{if("vendorId"===e){const e=v.find(e=>e.id===t);return void j(a=>({...a,vendorId:t,vendorName:(null===e||void 0===e?void 0:e.name)||a.vendorName,vendorAddress:(null===e||void 0===e?void 0:e.address)||a.vendorAddress}))}j(a=>({...a,[e]:t}))},I=e=>{const{name:t,value:a,type:r,checked:s}=e.target,n=new Set(["discountValue","taxRate","roundOffValue"]),i="checkbox"===r?s:n.has(t)?Number(a):a;j(e=>({...e,[t]:i}))},P=e=>{const t={...e},a=Math.max(0,Number(t.quantity)||0),r=Math.max(0,Number(t.price)||0),s=a*r;let n=Number(t.discountAmount)||0;t.discountPercent>0&&(n=s*t.discountPercent/100);const i=Math.max(0,s-n),l=i*(Number(t.taxRate)||0)/100,o=i+l;return{...t,quantity:a,price:r,discountAmount:Number(n.toFixed(2)),taxAmount:Number(l.toFixed(2)),amount:Number(o.toFixed(2))}},T=(e,t,a)=>{j(r=>{const s=[...r.items],n={...s[e],[t]:a};return s[e]="quantity"===t||"price"===t?P(n):n,{...r,items:s}})},R=e=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:2,maximumFractionDigits:2}).format(e);return(0,u.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50",children:(0,u.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,u.jsx)("div",{className:"bg-white rounded-2xl shadow-xl border border-gray-100 mb-8 overflow-hidden",children:(0,u.jsx)("div",{className:"bg-gradient-to-r from-indigo-600 via-purple-600 to-blue-600 px-8 py-6",children:(0,u.jsxs)("div",{className:"flex items-center justify-between",children:[(0,u.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,u.jsx)("button",{onClick:()=>e(-1),className:"p-3 bg-white/20 hover:bg-white/30 rounded-xl transition-all duration-200 backdrop-blur-sm",children:(0,u.jsx)(c.kRp,{className:"text-white",size:20})}),(0,u.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,u.jsx)("div",{className:"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center backdrop-blur-sm",children:(0,u.jsx)(c.jH2,{className:"text-white",size:24})}),(0,u.jsxs)("div",{children:[(0,u.jsx)("h1",{className:"text-2xl font-bold text-white",children:a?"Edit Delivery Challan":"Create New Delivery Challan"}),(0,u.jsx)("p",{className:"text-blue-100 text-sm",children:a?"Update challan details and items":"Generate professional delivery challan for your shipments"})]})]})]}),(0,u.jsx)("div",{className:"flex items-center space-x-3",children:(0,u.jsx)("div",{className:"bg-white/20 backdrop-blur-sm rounded-xl px-4 py-2",children:(0,u.jsx)("span",{className:"text-white text-sm font-medium",children:(new Date).toLocaleDateString("en-IN",{day:"numeric",month:"short",year:"numeric"})})})})]})})}),(0,u.jsxs)("form",{onSubmit:async r=>{if(r.preventDefault(),N.challanNumber.trim())if(N.vendorId)if(N.items.some(e=>!e.description.trim()))p("All items must have a description");else try{var s,n;h(!0);const r=(0,l.zH)({...N,vendorName:(null===(s=v.find(e=>e.id===N.vendorId))||void 0===s?void 0:s.name)||N.vendorName||"",vendorAddress:(null===(n=v.find(e=>e.id===N.vendorId))||void 0===n?void 0:n.address)||N.vendorAddress||"",amountInWords:x(N.finalAmount)});if(!a){const t=await(0,l.aR)(r);return m("Challan created successfully"),void e(`/admin/challan-details/${t.id}`)}await(0,l.PX)(t,r),m("Challan updated successfully"),e("/admin/delivery-challans")}catch(i){console.error("Save failed",i),p("Failed to save challan: "+i.message)}finally{h(!1)}else p("Please select a vendor");else p("Challan number is required")},className:"space-y-8",children:[(0,u.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden",children:[(0,u.jsx)("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 px-6 py-4 border-b border-gray-100",children:(0,u.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,u.jsx)("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center",children:(0,u.jsx)(c.S8s,{className:"text-white",size:16})}),(0,u.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Primary Details"}),(0,u.jsx)("div",{className:"flex-1"}),(0,u.jsx)("span",{className:"bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded-full",children:"Required Information"})]})}),(0,u.jsx)("div",{className:"p-6",children:(0,u.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,u.jsxs)("div",{className:"space-y-2",children:[(0,u.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Challan Number *"}),(0,u.jsxs)("div",{className:"relative",children:[(0,u.jsx)("input",{value:N.challanNumber,onChange:e=>A("challanNumber",e.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200",placeholder:"Enter challan number",required:!0}),(0,u.jsx)(c.jH2,{className:"absolute left-3 top-3.5 text-gray-400",size:16})]})]}),(0,u.jsxs)("div",{className:"space-y-2",children:[(0,u.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Challan Date *"}),(0,u.jsxs)("div",{className:"relative",children:[(0,u.jsx)("input",{type:"date",value:N.date,onChange:e=>A("date",e.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200",required:!0}),(0,u.jsx)(c.wIk,{className:"absolute left-3 top-3.5 text-gray-400",size:16})]})]}),(0,u.jsxs)("div",{className:"space-y-2",children:[(0,u.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Select Vendor *"}),(0,u.jsxs)("div",{className:"relative",children:[(0,u.jsxs)("select",{value:N.vendorId,onChange:e=>A("vendorId",e.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200 appearance-none bg-white",required:!0,children:[(0,u.jsx)("option",{value:"",children:"Choose vendor..."}),v.map(e=>(0,u.jsx)("option",{value:e.id,children:e.name||e.companyName||e.displayName||e.id},e.id))]}),(0,u.jsx)(c.JXP,{className:"absolute left-3 top-3.5 text-gray-400",size:16})]})]}),(0,u.jsxs)("div",{className:"space-y-2",children:[(0,u.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Invoice Date"}),(0,u.jsxs)("div",{className:"relative",children:[(0,u.jsx)("input",{type:"date",value:N.invoiceDate,onChange:e=>A("invoiceDate",e.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200"}),(0,u.jsx)(c.wIk,{className:"absolute left-3 top-3.5 text-gray-400",size:16})]})]}),(0,u.jsxs)("div",{className:"space-y-2",children:[(0,u.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Due Date"}),(0,u.jsxs)("div",{className:"relative",children:[(0,u.jsx)("input",{type:"date",value:N.dueDate,onChange:e=>A("dueDate",e.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200"}),(0,u.jsx)(c.wIk,{className:"absolute left-3 top-3.5 text-gray-400",size:16})]})]}),(0,u.jsxs)("div",{className:"space-y-2",children:[(0,u.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"State of Supply"}),(0,u.jsxs)("div",{className:"relative",children:[(0,u.jsx)("input",{value:N.stateOfSupply,onChange:e=>A("stateOfSupply",e.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200",placeholder:"Enter state name"}),(0,u.jsx)(c.HzC,{className:"absolute left-3 top-3.5 text-gray-400",size:16})]})]}),(0,u.jsxs)("div",{className:"md:col-span-3 space-y-2",children:[(0,u.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Reference (PO/Job Number)"}),(0,u.jsxs)("div",{className:"relative",children:[(0,u.jsx)("input",{value:N.reference,onChange:e=>A("reference",e.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200",placeholder:"Enter PO or Job reference number"}),(0,u.jsx)(c.jH2,{className:"absolute left-3 top-3.5 text-gray-400",size:16})]})]})]})})]}),(0,u.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden",children:[(0,u.jsx)("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 px-6 py-4 border-b border-gray-100",children:(0,u.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,u.jsx)("div",{className:"w-8 h-8 bg-gradient-to-br from-green-500 to-emerald-600 rounded-lg flex items-center justify-center",children:(0,u.jsx)(c.JXP,{className:"text-white",size:16})}),(0,u.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Party Information"}),(0,u.jsx)("div",{className:"flex-1"}),(0,u.jsx)("span",{className:"bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded-full",children:"Billing Details"})]})}),(0,u.jsx)("div",{className:"p-6",children:(0,u.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,u.jsxs)("div",{className:"space-y-2",children:[(0,u.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Party Name"}),(0,u.jsxs)("div",{className:"relative",children:[(0,u.jsx)("input",{value:N.vendorName,onChange:e=>A("vendorName",e.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200",placeholder:"Auto-filled from vendor selection"}),(0,u.jsx)(c.JXP,{className:"absolute left-3 top-3.5 text-gray-400",size:16})]})]}),(0,u.jsxs)("div",{className:"md:col-span-2 space-y-2",children:[(0,u.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Billing Address"}),(0,u.jsxs)("div",{className:"relative",children:[(0,u.jsx)("textarea",{value:N.vendorAddress,onChange:e=>A("vendorAddress",e.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200 resize-none",rows:3,placeholder:"Enter complete billing address..."}),(0,u.jsx)(c.HzC,{className:"absolute left-3 top-3.5 text-gray-400",size:16})]})]})]})})]}),(0,u.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden",children:[(0,u.jsx)("div",{className:"bg-gradient-to-r from-orange-50 to-amber-50 px-6 py-4 border-b border-gray-100",children:(0,u.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,u.jsx)("div",{className:"w-8 h-8 bg-gradient-to-br from-orange-500 to-amber-600 rounded-lg flex items-center justify-center",children:(0,u.jsx)(c.BLY,{className:"text-white",size:16})}),(0,u.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Logistics Information"}),(0,u.jsx)("div",{className:"flex-1"}),(0,u.jsx)("span",{className:"bg-orange-100 text-orange-800 text-xs font-medium px-2.5 py-0.5 rounded-full",children:"Delivery Details"})]})}),(0,u.jsx)("div",{className:"p-6",children:(0,u.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,u.jsxs)("div",{className:"space-y-2",children:[(0,u.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Vehicle Number"}),(0,u.jsxs)("div",{className:"relative",children:[(0,u.jsx)("input",{value:N.vehicleNo,onChange:e=>A("vehicleNo",e.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200",placeholder:"Enter vehicle number"}),(0,u.jsx)(c.BLY,{className:"absolute left-3 top-3.5 text-gray-400",size:16})]})]}),(0,u.jsxs)("div",{className:"space-y-2",children:[(0,u.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Driver Name"}),(0,u.jsxs)("div",{className:"relative",children:[(0,u.jsx)("input",{value:N.driverName,onChange:e=>A("driverName",e.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200",placeholder:"Enter driver name"}),(0,u.jsx)(c.JXP,{className:"absolute left-3 top-3.5 text-gray-400",size:16})]})]}),(0,u.jsxs)("div",{className:"md:col-span-3 space-y-2",children:[(0,u.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Delivery Remarks"}),(0,u.jsxs)("div",{className:"relative",children:[(0,u.jsx)("textarea",{value:N.remarks,onChange:e=>A("remarks",e.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200 resize-none",rows:3,placeholder:"Add any special delivery instructions or remarks..."}),(0,u.jsx)(c.jH2,{className:"absolute left-3 top-3.5 text-gray-400",size:16})]})]})]})})]}),(0,u.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden",children:[(0,u.jsx)("div",{className:"bg-gradient-to-r from-purple-50 to-pink-50 px-6 py-4 border-b border-gray-100",children:(0,u.jsxs)("div",{className:"flex items-center justify-between",children:[(0,u.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,u.jsx)("div",{className:"w-8 h-8 bg-gradient-to-br from-purple-500 to-pink-600 rounded-lg flex items-center justify-center",children:(0,u.jsx)(c.est,{className:"text-white",size:16})}),(0,u.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Items & Services"}),(0,u.jsxs)("span",{className:"bg-purple-100 text-purple-800 text-xs font-medium px-2.5 py-0.5 rounded-full",children:[N.items.length," Item",1!==N.items.length?"s":""]})]}),(0,u.jsxs)("button",{type:"button",onClick:()=>{j(e=>({...e,items:[...e.items,{id:Date.now(),description:"",hsnCode:"",quantity:1,unit:"Nos",price:0,discountPercent:0,discountAmount:0,taxRate:0,taxAmount:0,amount:0}]}))},className:"inline-flex items-center px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-600 text-white font-medium rounded-xl hover:from-purple-600 hover:to-pink-700 transition-all duration-200 shadow-sm hover:shadow-md",children:[(0,u.jsx)(c.GGD,{className:"mr-2",size:16}),"Add Item"]})]})}),(0,u.jsxs)("div",{className:"p-6",children:[(0,u.jsx)("div",{className:"space-y-4",children:N.items.map((e,t)=>(0,u.jsx)("div",{className:"p-4 border border-gray-200 rounded-lg bg-gray-50/50",children:(0,u.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-4",children:[(0,u.jsxs)("div",{className:"md:col-span-3",children:[(0,u.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Item/Service"}),(0,u.jsxs)("div",{className:"flex gap-2",children:[(0,u.jsxs)("select",{value:e.itemId||"",onChange:e=>((e,t)=>{const a=f.find(e=>e.id===t);a?j(t=>{var r,s,n,i,l;const o=[...t.items],d=o[e]||{},c=(Number(d.quantity),null!==(r=null!==(s=null!=(null===a||void 0===a||null===(n=a.pricing)||void 0===n?void 0:n.salePrice)?Number(a.pricing.salePrice):null)&&void 0!==s?s:null!=(null===a||void 0===a||null===(i=a.pricing)||void 0===i?void 0:i.purchasePrice)?Number(a.pricing.purchasePrice):null)&&void 0!==r?r:Number(d.price)||0);return o[e]={...d,itemId:a.id,description:a.name||d.description||"",hsnCode:a.hsn||d.hsnCode||"",unit:a.unit||d.unit||"Nos",price:c,taxRate:null!=(null===a||void 0===a||null===(l=a.pricing)||void 0===l?void 0:l.taxRate)?Number(a.pricing.taxRate):Number(d.taxRate)||0},o[e]=P(o[e]),{...t,items:o}}):T(e,"itemId","")})(t,e.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",children:[(0,u.jsx)("option",{value:"",children:"-- Select Item --"}),f.map(e=>(0,u.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,u.jsx)("button",{type:"button",onClick:()=>(e=>{N.items.length<=1?p("At least one item is required"):j(t=>({...t,items:t.items.filter((t,a)=>a!==e)}))})(t),className:"p-2 text-red-600 hover:text-red-800 bg-red-50 rounded-lg",title:"Remove Item",disabled:N.items.length<=1,children:(0,u.jsx)(c.IXo,{size:16})})]})]}),(0,u.jsxs)("div",{className:"md:col-span-5",children:[(0,u.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description *"}),(0,u.jsx)("input",{type:"text",value:e.description,onChange:e=>T(t,"description",e.target.value),placeholder:"Item description",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",required:!0})]}),(0,u.jsxs)("div",{className:"md:col-span-2",children:[(0,u.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"HSN Code"}),(0,u.jsx)("input",{type:"text",value:e.hsnCode,onChange:e=>T(t,"hsnCode",e.target.value),placeholder:"HSN code",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"})]}),(0,u.jsxs)("div",{className:"md:col-span-2",children:[(0,u.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Unit"}),(0,u.jsxs)("select",{value:e.unit,onChange:e=>T(t,"unit",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",children:[(0,u.jsx)("option",{value:"Nos",children:"Nos"}),(0,u.jsx)("option",{value:"Kg",children:"Kg"}),(0,u.jsx)("option",{value:"Meter",children:"Meter"}),(0,u.jsx)("option",{value:"Set",children:"Set"}),(0,u.jsx)("option",{value:"Box",children:"Box"}),(0,u.jsx)("option",{value:"Packet",children:"Packet"})]})]}),(0,u.jsxs)("div",{className:"md:col-span-2",children:[(0,u.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Quantity *"}),(0,u.jsx)("input",{type:"number",min:"0",step:"0.01",value:e.quantity,onChange:e=>T(t,"quantity",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-right",required:!0})]}),(0,u.jsxs)("div",{className:"md:col-span-2",children:[(0,u.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Unit Price (\u20b9) *"}),(0,u.jsx)("input",{type:"number",step:"0.01",min:"0",value:e.price,onChange:e=>T(t,"price",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-right",required:!0})]}),(0,u.jsxs)("div",{className:"md:col-span-2",children:[(0,u.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tax Rate (%)"}),(0,u.jsxs)("div",{className:"relative",children:[(0,u.jsx)("input",{type:"number",step:"0.01",min:"0",max:"100",value:e.taxRate,onChange:e=>T(t,"taxRate",e.target.value),className:"w-full pl-8 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-right"}),(0,u.jsx)(c.fTJ,{className:"absolute left-2 top-2.5 text-gray-400",size:16})]})]}),(0,u.jsxs)("div",{className:"md:col-span-2",children:[(0,u.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Amount (\u20b9)"}),(0,u.jsx)("input",{type:"text",value:R(e.amount),readOnly:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-100 font-medium text-right"})]})]})},e.id))}),(0,u.jsxs)("div",{className:"mt-8 p-6 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-gray-200",children:[(0,u.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[(0,u.jsx)(c.z8N,{className:"mr-2"}),"Pricing Summary"]}),(0,u.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,u.jsxs)("div",{className:"space-y-4",children:[(0,u.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,u.jsxs)("div",{children:[(0,u.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Discount Type"}),(0,u.jsxs)("select",{value:N.discountType,onChange:e=>j(t=>({...t,discountType:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",children:[(0,u.jsx)("option",{value:"amount",children:"Amount (\u20b9)"}),(0,u.jsx)("option",{value:"percentage",children:"Percentage (%)"})]})]}),(0,u.jsxs)("div",{children:[(0,u.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Discount ","percentage"===N.discountType?"(%)":"(\u20b9)"]}),(0,u.jsxs)("div",{className:"relative",children:[(0,u.jsx)("input",{type:"number",name:"discountValue",value:N.discountValue,onChange:I,min:"0",step:"percentage"===N.discountType?.1:.01,className:"w-full pl-8 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-right",placeholder:"0.00"}),"percentage"===N.discountType?(0,u.jsx)(c.fTJ,{className:"absolute left-2 top-2.5 text-gray-400",size:16}):(0,u.jsx)(c.z8N,{className:"absolute left-2 top-2.5 text-gray-400",size:16})]})]})]}),(0,u.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,u.jsxs)("div",{children:[(0,u.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tax Rate (%)"}),(0,u.jsxs)("div",{className:"relative",children:[(0,u.jsxs)("select",{name:"taxRate",value:N.taxRate,onChange:I,className:"w-full pl-8 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",children:[(0,u.jsx)("option",{value:"0",children:"No Tax (0%)"}),(0,u.jsx)("option",{value:"5",children:"GST 5%"}),(0,u.jsx)("option",{value:"12",children:"GST 12%"}),(0,u.jsx)("option",{value:"18",children:"GST 18%"}),(0,u.jsx)("option",{value:"28",children:"GST 28%"})]}),(0,u.jsx)(c.fTJ,{className:"absolute left-2 top-2.5 text-gray-400",size:16})]})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Payment Type"}),(0,u.jsxs)("select",{value:N.paymentType,onChange:e=>j(t=>({...t,paymentType:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",children:[(0,u.jsx)("option",{value:"Cash",children:"Cash"}),(0,u.jsx)("option",{value:"Online",children:"Online"}),(0,u.jsx)("option",{value:"Credit",children:"Credit"}),(0,u.jsx)("option",{value:"Cheque",children:"Cheque"})]})]})]}),(0,u.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,u.jsxs)("div",{children:[(0,u.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Round Off"}),(0,u.jsxs)("div",{className:"flex items-center gap-3",children:[(0,u.jsx)("input",{type:"checkbox",checked:N.roundOffEnabled,onChange:e=>j(t=>({...t,roundOffEnabled:e.target.checked})),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),(0,u.jsx)("span",{className:"text-sm text-gray-700",children:"Enable rounding"})]})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Approval Required"}),(0,u.jsxs)("div",{className:"flex items-center",children:[(0,u.jsx)("input",{type:"checkbox",name:"approvalRequired",checked:N.approvalRequired,onChange:e=>j(t=>({...t,approvalRequired:e.target.checked})),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),(0,u.jsx)("label",{className:"ml-2 text-sm text-gray-700",children:"Requires management approval"})]})]})]})]}),(0,u.jsx)("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:(0,u.jsxs)("div",{className:"space-y-3",children:[(0,u.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,u.jsx)("span",{className:"text-gray-600",children:"Subtotal:"}),(0,u.jsx)("span",{className:"font-medium",children:R(N.subtotal)})]}),N.discountValue>0&&(0,u.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,u.jsxs)("span",{className:"text-gray-600",children:["Discount ","percentage"===N.discountType?`(${N.discountValue}%)`:"",":"]}),(0,u.jsxs)("span",{className:"font-medium text-red-600",children:["-",R(N.discountAmount)]})]}),N.taxRate>0&&(0,u.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,u.jsxs)("span",{className:"text-gray-600",children:["Tax (",N.taxRate,"%):"]}),(0,u.jsx)("span",{className:"font-medium",children:R(N.taxAmount)})]}),N.roundOffEnabled&&0!==N.roundOffValue&&(0,u.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,u.jsx)("span",{className:"text-gray-600",children:"Round Off:"}),(0,u.jsxs)("span",{className:"font-medium",children:[N.roundOffValue>0?"+":"",R(N.roundOffValue)]})]}),(0,u.jsxs)("div",{className:"flex justify-between text-lg font-bold border-t border-gray-300 pt-3",children:[(0,u.jsx)("span",{className:"text-gray-900",children:"Final Amount:"}),(0,u.jsx)("span",{className:"text-indigo-600",children:R(N.finalAmount)})]}),(0,u.jsx)("div",{className:"text-xs text-gray-500 italic mt-2",children:x(N.finalAmount)})]})})]})]})]})]}),(0,u.jsx)("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-100 p-6",children:(0,u.jsxs)("div",{className:"flex flex-col sm:flex-row items-center justify-between space-y-4 sm:space-y-0 sm:space-x-4",children:[(0,u.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,u.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,u.jsx)("div",{className:"w-3 h-3 bg-green-400 rounded-full animate-pulse"}),(0,u.jsx)("span",{className:"text-sm text-gray-600",children:"Auto-save enabled"})]}),a&&(0,u.jsxs)("button",{type:"button",onClick:()=>e(`/admin/challan-details/${t}`),className:"inline-flex items-center px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium rounded-xl transition-all duration-200",children:[(0,u.jsx)(c.Vap,{className:"mr-2",size:16}),"Preview"]})]}),(0,u.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,u.jsx)("button",{type:"button",onClick:()=>e("/admin/delivery-challans"),className:"inline-flex items-center px-6 py-3 border border-gray-300 text-gray-700 font-medium rounded-xl hover:bg-gray-50 transition-all duration-200",children:"Cancel"}),a&&(0,u.jsxs)("button",{type:"button",className:"inline-flex items-center px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white font-medium rounded-xl hover:from-blue-600 hover:to-indigo-700 transition-all duration-200 shadow-sm hover:shadow-md",children:[(0,u.jsx)(c.Mvz,{className:"mr-2",size:16}),"Print"]}),(0,u.jsx)("button",{type:"submit",disabled:g,className:"inline-flex items-center px-8 py-3 bg-gradient-to-r from-indigo-600 via-purple-600 to-blue-600 text-white font-semibold rounded-xl hover:from-indigo-700 hover:via-purple-700 hover:to-blue-700 transition-all duration-200 shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed transform hover:scale-105",children:g?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Saving..."]}):(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(c.Bc_,{className:"mr-2",size:16}),a?"Update Challan":"Create Challan"]})})]})]})})]})]})})}function x(e){if(isNaN(e)||0===e)return"Zero Rupees Only";const t=Math.abs(e),a=Math.floor(t),r=Math.round(100*(t-a)),s=["","One","Two","Three","Four","Five","Six","Seven","Eight","Nine"],n=["Ten","Eleven","Twelve","Thirteen","Fourteen","Fifteen","Sixteen","Seventeen","Eighteen","Nineteen"],i=["","Ten","Twenty","Thirty","Forty","Fifty","Sixty","Seventy","Eighty","Ninety"],l=["","Thousand","Lakh","Crore"],o=e=>{if(0===e)return"";if(e<10)return s[e]+" ";if(e<20)return n[e-10]+" ";if(e<100)return i[Math.floor(e/10)]+" "+(e%10!==0?s[e%10]+" ":"");if(e<1e3)return s[Math.floor(e/100)]+" Hundred "+o(e%100);for(let t=0;t<l.length;t++)if(e<100*Math.pow(100,t)){const a=0===t?1e3:100;return o(Math.floor(e/a))+l[t]+" "+o(e%a)}return""};let d=o(a).trim();if(d=d?d+" Rupee"+(1!==a?"s":""):"",r>0){d+=(d?" and ":"")+o(r).trim()+" Paise"}return d=d||"Zero",d+" Only"}},9295:(e,t,a)=>{a.d(t,{Ds:()=>g,E4:()=>p,U3:()=>c,_r:()=>h,fk:()=>m,uG:()=>d,u_:()=>x,wE:()=>u});var r=a(5472),s=a(8147),n=a(791);const i="items";function l(e){var t,a,r,s,n,i,l,o,d,c,u,m,x,p,g,h;const v=e=>""===e||null===e||void 0===e?null:Number(e);return{name:String(e.name||"").trim(),type:"service"===e.type?"service":"product",hsn:String(e.hsn||"").trim(),code:String(e.code||"").trim(),unit:String(e.unit||"").trim(),category:String(e.category||"").trim(),imageUrl:String(e.imageUrl||"").trim(),pricing:{salePrice:null!==(t=v(null===(a=e.pricing)||void 0===a?void 0:a.salePrice))&&void 0!==t?t:0,purchasePrice:null!==(r=v(null===(s=e.pricing)||void 0===s?void 0:s.purchasePrice))&&void 0!==r?r:0,discountType:["percentage","flat"].includes(null===(n=e.pricing)||void 0===n?void 0:n.discountType)?e.pricing.discountType:"percentage",discountValue:null!==(i=v(null===(l=e.pricing)||void 0===l?void 0:l.discountValue))&&void 0!==i?i:0,taxRate:null!==(o=v(null===(d=e.pricing)||void 0===d?void 0:d.taxRate))&&void 0!==o?o:0,taxMode:["with_tax","without_tax"].includes(null===(c=e.pricing)||void 0===c?void 0:c.taxMode)?e.pricing.taxMode:"without_tax"},stock:{track:Boolean(null===(u=e.stock)||void 0===u?void 0:u.track),openingQty:null!==(m=v(null===(x=e.stock)||void 0===x?void 0:x.openingQty))&&void 0!==m?m:0,minQty:null!==(p=v(null===(g=e.stock)||void 0===g?void 0:g.minQty))&&void 0!==p?p:0,location:String((null===(h=e.stock)||void 0===h?void 0:h.location)||"").trim()},status:"inactive"===e.status?"inactive":"active",notes:String(e.notes||"").trim()}}function o(e){var t,a,r,s,n,i,l,o,d,c,u,m,x,p,g,h;const v=e.data()||{};return{id:e.id,name:v.name||"",type:v.type||"product",hsn:v.hsn||"",code:v.code||"",unit:v.unit||"",category:v.category||"",imageUrl:v.imageUrl||"",pricing:{salePrice:"number"===typeof(null===(t=v.pricing)||void 0===t?void 0:t.salePrice)?v.pricing.salePrice:Number((null===(a=v.pricing)||void 0===a?void 0:a.salePrice)||0),purchasePrice:"number"===typeof(null===(r=v.pricing)||void 0===r?void 0:r.purchasePrice)?v.pricing.purchasePrice:Number((null===(s=v.pricing)||void 0===s?void 0:s.purchasePrice)||0),discountType:(null===(n=v.pricing)||void 0===n?void 0:n.discountType)||"percentage",discountValue:"number"===typeof(null===(i=v.pricing)||void 0===i?void 0:i.discountValue)?v.pricing.discountValue:Number((null===(l=v.pricing)||void 0===l?void 0:l.discountValue)||0),taxRate:"number"===typeof(null===(o=v.pricing)||void 0===o?void 0:o.taxRate)?v.pricing.taxRate:Number((null===(d=v.pricing)||void 0===d?void 0:d.taxRate)||0),taxMode:(null===(c=v.pricing)||void 0===c?void 0:c.taxMode)||"without_tax"},stock:{track:Boolean(null===(u=v.stock)||void 0===u?void 0:u.track),openingQty:"number"===typeof(null===(m=v.stock)||void 0===m?void 0:m.openingQty)?v.stock.openingQty:Number((null===(x=v.stock)||void 0===x?void 0:x.openingQty)||0),minQty:"number"===typeof(null===(p=v.stock)||void 0===p?void 0:p.minQty)?v.stock.minQty:Number((null===(g=v.stock)||void 0===g?void 0:g.minQty)||0),location:(null===(h=v.stock)||void 0===h?void 0:h.location)||""},status:v.status||"active",notes:v.notes||"",createdAt:v.createdAt,updatedAt:v.updatedAt}}function d(e){const t={};return(!e.name||String(e.name).trim().length<2)&&(t.name="Item name is required"),e.unit||(t.unit="Unit is required"),e.pricing&&e.pricing.salePrice<0&&(t.salePrice="Sale price must be >= 0"),e.pricing&&e.pricing.purchasePrice<0&&(t.purchasePrice="Purchase price must be >= 0"),e.pricing&&e.pricing.taxRate<0&&(t.taxRate="Tax rate must be >= 0"),t}async function c(e,t){const a=`items/${t||"tmp"}_${Date.now()}_${e.name}`,r=(0,s.KR)(n.I,a),i=await(0,s.D)(r,e);return(0,s.qk)(i.ref)}async function u(e){const t=d(e);if(Object.keys(t).length){const e=new Error("ITEM_VALIDATION_FAILED");throw e.details=t,e}const a=l(e),s=(0,r.O5)();return{id:(await(0,r.gS)((0,r.rJ)(n.db,i),{...a,createdAt:s,updatedAt:s})).id,...a}}async function m(e,t){const a=d(t);if(Object.keys(a).length){const e=new Error("ITEM_VALIDATION_FAILED");throw e.details=a,e}const s=l(t);await(0,r.mZ)((0,r.H9)(n.db,i,e),{...s,updatedAt:(0,r.O5)()})}async function x(e){const t=await(0,r.x7)((0,r.H9)(n.db,i,e));return t.exists()?o(t):null}async function p(){const e=(0,r.P)((0,r.rJ)(n.db,i),(0,r.My)("createdAt","desc"));return(await(0,r.GG)(e)).docs.map(o)}async function g(e){let{text:t,type:a,category:s,status:l}=e;let d=(await(0,r.GG)((0,r.rJ)(n.db,i))).docs.map(o);if(t){const e=t.toLowerCase();d=d.filter(t=>(t.name||"").toLowerCase().includes(e)||(t.code||"").toLowerCase().includes(e)||(t.hsn||"").toLowerCase().includes(e))}return a&&(d=d.filter(e=>e.type===a)),s&&(d=d.filter(e=>e.category===s)),l&&(d=d.filter(e=>e.status===l)),d}async function h(e){const t=(0,r.wP)(n.db);e.forEach(e=>t.delete((0,r.H9)(n.db,i,e))),await t.commit()}}}]);
//# sourceMappingURL=318.29795743.chunk.js.map