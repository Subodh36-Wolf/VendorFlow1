"use strict";(self.webpackChunkvendor_management_system=self.webpackChunkvendor_management_system||[]).push([[38],{8038:(e,t,i)=>{i.r(t),i.d(t,{default:()=>o});var n=i(5043),s=i(5475),c=i(5772),a=i(9295),r=i(3505),l=i(579);function o(){const{showError:e,showSuccess:t}=(0,r.hN)(),[i,o]=(0,n.useState)(!1),[d,u]=(0,n.useState)([]),[p,m]=(0,n.useState)(""),[h,x]=(0,n.useState)({type:"",category:"",status:""}),[g,v]=(0,n.useState)([]);(0,n.useEffect)(()=>{y()},[]);const y=async()=>{try{o(!0);const e=await(0,a.E4)();u(e)}catch(t){console.error(t),e("Failed to load items")}finally{o(!1)}},f=async()=>{try{o(!0);const e=await(0,a.Ds)({text:p,...h});u(e)}catch(t){e("Search failed")}finally{o(!1)}};return(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)(c.CKj,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),(0,l.jsx)("input",{className:"pl-9 pr-3 py-2 border rounded-lg w-64",placeholder:"Search by name/code/HSN",value:p,onChange:e=>m(e.target.value),onKeyDown:e=>"Enter"===e.key&&f()})]}),(0,l.jsxs)("select",{className:"border rounded-lg px-3 py-2",value:h.type,onChange:e=>x({...h,type:e.target.value}),children:[(0,l.jsx)("option",{value:"",children:"All Types"}),(0,l.jsx)("option",{value:"product",children:"Product"}),(0,l.jsx)("option",{value:"service",children:"Service"})]}),(0,l.jsxs)("select",{className:"border rounded-lg px-3 py-2",value:h.status,onChange:e=>x({...h,status:e.target.value}),children:[(0,l.jsx)("option",{value:"",children:"All Status"}),(0,l.jsx)("option",{value:"active",children:"Active"}),(0,l.jsx)("option",{value:"inactive",children:"Inactive"})]}),(0,l.jsxs)("button",{onClick:f,className:"px-3 py-2 border rounded-lg flex items-center space-x-2",children:[(0,l.jsx)(c.K7R,{}),(0,l.jsx)("span",{children:"Filter"})]}),(0,l.jsxs)("button",{onClick:y,className:"px-3 py-2 border rounded-lg flex items-center space-x-2",children:[(0,l.jsx)(c.jTZ,{}),(0,l.jsx)("span",{children:"Refresh"})]})]}),(0,l.jsxs)(s.N_,{to:"/admin/items/new",className:"px-4 py-2 bg-indigo-600 text-white rounded-lg flex items-center space-x-2",children:[(0,l.jsx)(c.GGD,{}),(0,l.jsx)("span",{children:"Add Item"})]})]}),(0,l.jsx)("div",{className:"bg-white border rounded-lg overflow-hidden",children:(0,l.jsxs)("table",{className:"min-w-full",children:[(0,l.jsx)("thead",{className:"bg-gray-50",children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{className:"p-3 text-left",children:(0,l.jsx)("input",{type:"checkbox",onChange:e=>v(e.target.checked?d.map(e=>e.id):[]),checked:g.length>0&&g.length===d.length})}),(0,l.jsx)("th",{className:"p-3 text-left",children:"Name"}),(0,l.jsx)("th",{className:"p-3 text-left",children:"Type"}),(0,l.jsx)("th",{className:"p-3 text-left",children:"Code"}),(0,l.jsx)("th",{className:"p-3 text-right",children:"Sale Price"}),(0,l.jsx)("th",{className:"p-3 text-right",children:"Tax %"}),(0,l.jsx)("th",{className:"p-3 text-left",children:"Status"}),(0,l.jsx)("th",{className:"p-3 text-right",children:"Actions"})]})}),(0,l.jsxs)("tbody",{children:[d.map(e=>{var t,i;return(0,l.jsxs)("tr",{className:"border-t",children:[(0,l.jsx)("td",{className:"p-3",children:(0,l.jsx)("input",{type:"checkbox",checked:g.includes(e.id),onChange:()=>{return t=e.id,void v(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t]);var t}})}),(0,l.jsx)("td",{className:"p-3",children:e.name}),(0,l.jsx)("td",{className:"p-3 capitalize",children:e.type}),(0,l.jsx)("td",{className:"p-3",children:e.code}),(0,l.jsxs)("td",{className:"p-3 text-right",children:["\u20b9",Number((null===(t=e.pricing)||void 0===t?void 0:t.salePrice)||0).toLocaleString()]}),(0,l.jsxs)("td",{className:"p-3 text-right",children:[Number((null===(i=e.pricing)||void 0===i?void 0:i.taxRate)||0),"%"]}),(0,l.jsx)("td",{className:"p-3",children:e.status}),(0,l.jsx)("td",{className:"p-3 text-right",children:(0,l.jsxs)(s.N_,{to:`/admin/items/${e.id}/edit`,className:"inline-flex items-center px-3 py-1 border rounded mr-2",children:[(0,l.jsx)(c.WXf,{className:"mr-1"}),"Edit"]})})]},e.id)}),0===d.length&&(0,l.jsx)("tr",{children:(0,l.jsx)("td",{className:"p-6 text-center text-gray-500",colSpan:8,children:"No items found"})})]})]})}),g.length>0&&(0,l.jsxs)("div",{className:"flex justify-between items-center bg-yellow-50 border border-yellow-200 p-3 rounded",children:[(0,l.jsxs)("span",{children:[g.length," selected"]}),(0,l.jsxs)("button",{onClick:async()=>{if(0!==g.length&&window.confirm(`Delete ${g.length} item(s)?`))try{o(!0),await(0,a._r)(g),t("Items deleted"),v([]),y()}catch(i){e("Delete failed")}finally{o(!1)}},className:"px-3 py-2 bg-red-600 text-white rounded flex items-center",children:[(0,l.jsx)(c.IXo,{className:"mr-2"})," Delete Selected"]})]})]})}},9295:(e,t,i)=>{i.d(t,{Ds:()=>x,E4:()=>h,U3:()=>d,_r:()=>g,fk:()=>p,uG:()=>o,u_:()=>m,wE:()=>u});var n=i(5472),s=i(8147),c=i(791);const a="items";function r(e){var t,i,n,s,c,a,r,l,o,d,u,p,m,h,x,g;const v=e=>""===e||null===e||void 0===e?null:Number(e);return{name:String(e.name||"").trim(),type:"service"===e.type?"service":"product",hsn:String(e.hsn||"").trim(),code:String(e.code||"").trim(),unit:String(e.unit||"").trim(),category:String(e.category||"").trim(),imageUrl:String(e.imageUrl||"").trim(),pricing:{salePrice:null!==(t=v(null===(i=e.pricing)||void 0===i?void 0:i.salePrice))&&void 0!==t?t:0,purchasePrice:null!==(n=v(null===(s=e.pricing)||void 0===s?void 0:s.purchasePrice))&&void 0!==n?n:0,discountType:["percentage","flat"].includes(null===(c=e.pricing)||void 0===c?void 0:c.discountType)?e.pricing.discountType:"percentage",discountValue:null!==(a=v(null===(r=e.pricing)||void 0===r?void 0:r.discountValue))&&void 0!==a?a:0,taxRate:null!==(l=v(null===(o=e.pricing)||void 0===o?void 0:o.taxRate))&&void 0!==l?l:0,taxMode:["with_tax","without_tax"].includes(null===(d=e.pricing)||void 0===d?void 0:d.taxMode)?e.pricing.taxMode:"without_tax"},stock:{track:Boolean(null===(u=e.stock)||void 0===u?void 0:u.track),openingQty:null!==(p=v(null===(m=e.stock)||void 0===m?void 0:m.openingQty))&&void 0!==p?p:0,minQty:null!==(h=v(null===(x=e.stock)||void 0===x?void 0:x.minQty))&&void 0!==h?h:0,location:String((null===(g=e.stock)||void 0===g?void 0:g.location)||"").trim()},status:"inactive"===e.status?"inactive":"active",notes:String(e.notes||"").trim()}}function l(e){var t,i,n,s,c,a,r,l,o,d,u,p,m,h,x,g;const v=e.data()||{};return{id:e.id,name:v.name||"",type:v.type||"product",hsn:v.hsn||"",code:v.code||"",unit:v.unit||"",category:v.category||"",imageUrl:v.imageUrl||"",pricing:{salePrice:"number"===typeof(null===(t=v.pricing)||void 0===t?void 0:t.salePrice)?v.pricing.salePrice:Number((null===(i=v.pricing)||void 0===i?void 0:i.salePrice)||0),purchasePrice:"number"===typeof(null===(n=v.pricing)||void 0===n?void 0:n.purchasePrice)?v.pricing.purchasePrice:Number((null===(s=v.pricing)||void 0===s?void 0:s.purchasePrice)||0),discountType:(null===(c=v.pricing)||void 0===c?void 0:c.discountType)||"percentage",discountValue:"number"===typeof(null===(a=v.pricing)||void 0===a?void 0:a.discountValue)?v.pricing.discountValue:Number((null===(r=v.pricing)||void 0===r?void 0:r.discountValue)||0),taxRate:"number"===typeof(null===(l=v.pricing)||void 0===l?void 0:l.taxRate)?v.pricing.taxRate:Number((null===(o=v.pricing)||void 0===o?void 0:o.taxRate)||0),taxMode:(null===(d=v.pricing)||void 0===d?void 0:d.taxMode)||"without_tax"},stock:{track:Boolean(null===(u=v.stock)||void 0===u?void 0:u.track),openingQty:"number"===typeof(null===(p=v.stock)||void 0===p?void 0:p.openingQty)?v.stock.openingQty:Number((null===(m=v.stock)||void 0===m?void 0:m.openingQty)||0),minQty:"number"===typeof(null===(h=v.stock)||void 0===h?void 0:h.minQty)?v.stock.minQty:Number((null===(x=v.stock)||void 0===x?void 0:x.minQty)||0),location:(null===(g=v.stock)||void 0===g?void 0:g.location)||""},status:v.status||"active",notes:v.notes||"",createdAt:v.createdAt,updatedAt:v.updatedAt}}function o(e){const t={};return(!e.name||String(e.name).trim().length<2)&&(t.name="Item name is required"),e.unit||(t.unit="Unit is required"),e.pricing&&e.pricing.salePrice<0&&(t.salePrice="Sale price must be >= 0"),e.pricing&&e.pricing.purchasePrice<0&&(t.purchasePrice="Purchase price must be >= 0"),e.pricing&&e.pricing.taxRate<0&&(t.taxRate="Tax rate must be >= 0"),t}async function d(e,t){const i=`items/${t||"tmp"}_${Date.now()}_${e.name}`,n=(0,s.KR)(c.I,i),a=await(0,s.D)(n,e);return(0,s.qk)(a.ref)}async function u(e){const t=o(e);if(Object.keys(t).length){const e=new Error("ITEM_VALIDATION_FAILED");throw e.details=t,e}const i=r(e),s=(0,n.O5)();return{id:(await(0,n.gS)((0,n.rJ)(c.db,a),{...i,createdAt:s,updatedAt:s})).id,...i}}async function p(e,t){const i=o(t);if(Object.keys(i).length){const e=new Error("ITEM_VALIDATION_FAILED");throw e.details=i,e}const s=r(t);await(0,n.mZ)((0,n.H9)(c.db,a,e),{...s,updatedAt:(0,n.O5)()})}async function m(e){const t=await(0,n.x7)((0,n.H9)(c.db,a,e));return t.exists()?l(t):null}async function h(){const e=(0,n.P)((0,n.rJ)(c.db,a),(0,n.My)("createdAt","desc"));return(await(0,n.GG)(e)).docs.map(l)}async function x(e){let{text:t,type:i,category:s,status:r}=e;let o=(await(0,n.GG)((0,n.rJ)(c.db,a))).docs.map(l);if(t){const e=t.toLowerCase();o=o.filter(t=>(t.name||"").toLowerCase().includes(e)||(t.code||"").toLowerCase().includes(e)||(t.hsn||"").toLowerCase().includes(e))}return i&&(o=o.filter(e=>e.type===i)),s&&(o=o.filter(e=>e.category===s)),r&&(o=o.filter(e=>e.status===r)),o}async function g(e){const t=(0,n.wP)(c.db);e.forEach(e=>t.delete((0,n.H9)(c.db,a,e))),await t.commit()}}}]);
//# sourceMappingURL=38.c67197c0.chunk.js.map