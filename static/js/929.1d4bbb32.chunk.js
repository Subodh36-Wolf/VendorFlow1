"use strict";(self.webpackChunkvendor_management_system=self.webpackChunkvendor_management_system||[]).push([[929],{9929:(e,t,r)=>{r.r(t),r.d(t,{default:()=>c});var o=r(5043),s=r(5472),a=r(791),n=r(3505),d=r(5772),i=r(579);d.i5c,d.Ojn,d.FrA,d.x_j;const l={HBL:"default_hbl_vendor_id",VTL:"default_vtl_vendor_id",Drilling:"default_drilling_vendor_id",VMC:"default_vmc_vendor_id"};function c(){const{showSuccess:e,showError:t}=(0,n.hN)(),[r,c]=(0,o.useState)([]),[m,u]=(0,o.useState)([]),[p,h]=(0,o.useState)([]),[x,g]=(0,o.useState)([]),[f,b]=(0,o.useState)([]),[v,j]=(0,o.useState)(!0),[y,w]=(0,o.useState)(!1),[N,S]=(0,o.useState)(null),[_,M]=(0,o.useState)((new Date).toISOString().split("T")[0]),[C,T]=(0,o.useState)("all"),[G,A]=(0,o.useState)("all"),[k,D]=(0,o.useState)("all"),[J,E]=(0,o.useState)(!0),[I,O]=(d.i5c,d.Ojn,d.FrA,d.x_j,d.i5c,d.i5c,d.i5c,d.est,d.i5c,d.Ohp,d.aze,d.A3x,d.yGN,(0,o.useState)({date:(new Date).toISOString().split("T")[0],vendors:[{vendorId:"",bodiesCount:1}],operationType:"hbl",targetLocation:"VMT Store",notes:"",status:"pending",priority:"medium",source:"manual"})),F=async()=>{try{const e=(0,s.P)((0,s.rJ)(a.db,"statusManager"),(0,s._M)("status","==","completed"),(0,s._M)("vendorTodoCreated","==",!1),(0,s.My)("completedAt","desc")),t=(await(0,s.GG)(e)).docs.map(e=>({id:e.id,...e.data()}));return b(t),t}catch(e){return console.error("Error fetching completed jobs:",e),t("Failed to load completed jobs"),[]}},L=async o=>{try{const t=[];for(const e of o){var n,d;const o=(0,s.P)((0,s.rJ)(a.db,"vendorTodos"),(0,s._M)("sourceJobId","==",e.id),(0,s._M)("autoGenerated","==",!0));if(!(await(0,s.GG)(o)).empty)continue;const i=e.vendorId||l[e.operation]||(null===(n=r[0])||void 0===n?void 0:n.id);if(!i){console.warn(`No vendor found for job ${e.id}`);continue}const c={date:(new Date).toISOString().split("T")[0],vendors:[{vendorId:i,bodiesCount:e.quantity||1,vendorName:B(i)}],operationType:(null===(d=e.operation)||void 0===d?void 0:d.toLowerCase())||"other",targetLocation:"VMT Store",notes:`Auto-generated: Collect completed ${e.operation} work for ${e.poNumber||"Job"} ${e.itemDescription?`- ${e.itemDescription}`:""}`,status:"pending",priority:"medium",totalBodies:e.quantity||1,sourceJobId:e.id,poNumber:e.poNumber,itemDescription:e.itemDescription,operation:e.operation,autoGenerated:!0,source:"auto",createdAt:(0,s.O5)(),updatedAt:(0,s.O5)()},m=await(0,s.gS)((0,s.rJ)(a.db,"vendorTodos"),c);t.push({id:m.id,...c}),await(0,s.mZ)((0,s.H9)(a.db,"statusManager",e.id),{vendorTodoCreated:!0,vendorTodoId:m.id})}return t.length>0&&(e(`Auto-created ${t.length} collection tasks for completed jobs`),z()),t}catch(i){console.error("Error auto-creating vendor todos:",i),t("Failed to create automatic collection tasks")}},P=async()=>{try{j(!0);const e=(await(0,s.GG)((0,s.rJ)(a.db,"vendors"))).docs.map(e=>({id:e.id,...e.data()}));c(e);const t=(await(0,s.GG)((0,s.rJ)(a.db,"purchaseOrders"))).docs.map(e=>({id:e.id,...e.data()}));u(t);const r=await F();r.length>0&&await L(r),await z()}catch(e){console.error("Error fetching data:",e),t("Failed to load data")}finally{j(!1)}},z=async()=>{try{const e=(0,s.P)((0,s.rJ)(a.db,"vendorTodos"),(0,s._M)("date","==",_),(0,s._M)("autoGenerated","==",!1),(0,s.My)("createdAt","desc")),t=(await(0,s.GG)(e)).docs.map(e=>({id:e.id,...e.data()}));h(t)}catch(e){console.error("Error fetching todos:",e),t("Failed to fetch todos")}};(0,o.useEffect)(()=>{P();const e=(()=>{try{const e=(0,s.P)((0,s.rJ)(a.db,"statusManager"),(0,s._M)("status","==","completed"),(0,s.My)("completedAt","desc"));return(0,s.aQ)(e,async e=>{const t=[];e.forEach(e=>{t.push({id:e.id,...e.data()})});const r=t.filter(e=>!e.vendorTodoCreated);r.length>0&&await L(r)})}catch(e){return console.error("Error setting up completed jobs listener:",e),null}})(),t=(()=>{try{const e=(0,s.P)((0,s.rJ)(a.db,"vendorTodos"),(0,s._M)("autoGenerated","==",!0),(0,s.My)("createdAt","desc"));return(0,s.aQ)(e,e=>{const t=[];e.forEach(e=>{t.push({id:e.id,...e.data()})}),g(t)})}catch(e){return console.error("Error setting up auto-todos listener:",e),null}})();return()=>{e&&e(),t&&t()}},[_]);const V=()=>{switch(k){case"manual":return p;case"auto":return x.filter(e=>!_||e.date===_);default:return[...p,...x.filter(e=>!_||e.date===_)].filter((e,t,r)=>t===r.findIndex(t=>t.id===e.id))}},$=V().filter(e=>{let t=!0,r=!0;return"all"!==C&&(t=e.status===C),"all"!==G&&(r=e.operationType===G),t&&r}),B=($.filter(e=>"completed"!==e.status),$.filter(e=>"completed"===e.status),e=>{const t=r.find(t=>t.id===e);return t?t.name:"Unknown Vendor"});(()=>{const e=V();e.reduce((e,t)=>e+(t.totalBodies||0),0),e.filter(e=>"completed"===e.status).length,e.filter(e=>"pending"===e.status).length,e.filter(e=>"in-progress"===e.status).length,x.filter(e=>!_||e.date===_).length,p.length})();return v?(0,i.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,i.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-500"})}):(0,i.jsxs)("div",{className:"max-w-7xl mx-auto space-y-6",children:[(0,i.jsx)("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-200",children:(0,i.jsxs)("div",{className:"flex justify-between items-center",children:[(0,i.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,i.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-xl flex items-center justify-center",children:(0,i.jsx)(d.BLY,{className:"text-white",size:20})}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Vendor Material Collection"}),(0,i.jsx)("p",{className:"text-gray-600",children:"Manage vendor resource allocation and material collection from completed jobs"})]})]}),(0,i.jsxs)("div",{className:"flex space-x-3",children:[(0,i.jsxs)("button",{onClick:async()=>{try{const t=await F();t.length>0?await L(t):e("No new completed jobs found")}catch(r){console.error("Error creating todos from completed jobs:",r),t("Failed to create collection tasks")}},className:"inline-flex items-center px-4 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white font-medium rounded-xl hover:from-green-600 hover:to-emerald-700 transition-all duration-200 shadow-sm hover:shadow-md",children:[(0,i.jsx)(d.A3x,{className:"mr-2",size:16}),"Sync Completed Jobs"]}),(0,i.jsxs)("button",{onClick:()=>{P()},className:"inline-flex items-center px-4 py-3 bg-gradient-to-r from-gray-500 to-slate-600 text-white font-medium rounded-xl hover:from-gray-600 hover:to-slate-700 transition-all duration-200 shadow-sm hover:shadow-md",children:[(0,i.jsx)(d.jTZ,{className:"mr-2",size:16}),"Refresh"]}),(0,i.jsxs)("button",{onClick:()=>w(!0),className:"inline-flex items-center px-4 py-3 bg-gradient-to-r from-purple-500 to-indigo-600 text-white font-medium rounded-xl hover:from-purple-600 hover:to-indigo-700 transition-all duration-200 shadow-sm hover:shadow-md",children:[(0,i.jsx)(d.GGD,{className:"mr-2",size:16}),"Add Manual Plan"]})]})]})}),(0,i.jsxs)("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-200",children:[(0,i.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[(0,i.jsx)("div",{className:"w-8 h-8 bg-gradient-to-br from-green-500 to-emerald-600 rounded-xl flex items-center justify-center",children:(0,i.jsx)(d.A3x,{className:"text-white",size:16})}),(0,i.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Completed Jobs Ready for Collection"}),(0,i.jsxs)("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-sm rounded-full",children:[f.length," jobs"]})]}),f.length>0?(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[f.slice(0,6).map(e=>{var t,r;return(0,i.jsxs)("div",{className:"border border-green-200 rounded-lg p-4 bg-green-50",children:[(0,i.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,i.jsx)("span",{className:"font-medium text-green-800",children:e.operation}),(0,i.jsx)("span",{className:"text-xs bg-green-200 text-green-800 px-2 py-1 rounded",children:"Ready for pickup"})]}),(0,i.jsxs)("div",{className:"text-sm text-green-700",children:[e.poNumber&&(0,i.jsxs)("div",{children:["PO: ",e.poNumber]}),e.itemDescription&&(0,i.jsxs)("div",{children:["Item: ",e.itemDescription]}),(0,i.jsxs)("div",{children:["Qty: ",e.quantity||1]}),e.completedAt&&(0,i.jsxs)("div",{className:"text-xs text-green-600 mt-1",children:["Completed: ",null===(t=(r=e.completedAt).toDate)||void 0===t?void 0:t.call(r).toLocaleDateString()]})]})]},e.id)}),f.length>6&&(0,i.jsx)("div",{className:"border border-green-200 rounded-lg p-4 bg-green-50 flex items-center justify-center",children:(0,i.jsxs)("span",{className:"text-green-700",children:["+",f.length-6," more jobs"]})})]}):(0,i.jsx)("p",{className:"text-gray-500 text-center py-4",children:"No completed jobs waiting for collection"})]})]})}}}]);
//# sourceMappingURL=929.1d4bbb32.chunk.js.map