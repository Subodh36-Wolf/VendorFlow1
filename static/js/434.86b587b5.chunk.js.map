{"version":3,"file":"static/js/434.86b587b5.chunk.js","mappings":"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","sources":["services/vendorService.js","services/pdfService.js","services/fileUploadService.js","services/messageTemplateService.js","services/whatsappService.js","components/Admin/POForm.jsx","services/itemService.js","services/purchaseOrderService.js"],"sourcesContent":["import { collection, addDoc, getDocs, getDoc, updateDoc, deleteDoc, doc, serverTimestamp, query, orderBy, where, writeBatch } from 'firebase/firestore';\r\nimport { db } from '../firebase';\r\n\r\nconst VENDORS_COLLECTION = 'vendors';\r\nconst VENDOR_ACTIVITY_COLLECTION = 'vendorActivity';\r\n\r\n// Normalize vendor data coming from UI before saving\r\nexport function normalizeVendorForSave(raw) {\r\n\tconst numeric = (v) => (v === '' || v === null || v === undefined ? null : Number(v));\r\n\treturn {\r\n\t\tname: String(raw.name || '').trim(),\r\n\t\temail: String(raw.email || '').trim().toLowerCase(),\r\n\t\tphone: String(raw.phone || '').trim(),\r\n\t\taddress: String(raw.address || '').trim(),\r\n\t\tcity: String(raw.city || '').trim(),\r\n\t\tstate: String(raw.state || '').trim(),\r\n\t\tzipCode: String(raw.zipCode || '').trim(),\r\n\t\tcountry: String(raw.country || 'India').trim(),\r\n\t\twebsite: String(raw.website || '').trim(),\r\n\t\tcontactPerson: String(raw.contactPerson || '').trim(),\r\n\t\tcontactPhone: String(raw.contactPhone || '').trim(),\r\n\t\tcontactEmail: String(raw.contactEmail || '').trim().toLowerCase(),\r\n\t\tcategory: String(raw.category || '').trim(),\r\n\t\trating: numeric(raw.rating) ?? 0,\r\n\t\tgstNumber: String(raw.gstNumber || '').trim(),\r\n\t\tpanNumber: String(raw.panNumber || '').trim(),\r\n\t\tbankDetails: {\r\n\t\t\taccountNumber: String(raw.bankDetails?.accountNumber || '').trim(),\r\n\t\t\tifscCode: String(raw.bankDetails?.ifscCode || '').trim(),\r\n\t\t\tbankName: String(raw.bankDetails?.bankName || '').trim(),\r\n\t\t\taccountHolderName: String(raw.bankDetails?.accountHolderName || '').trim(),\r\n\t\t},\r\n\t\tservices: Array.isArray(raw.services) ? raw.services.filter(Boolean) : [],\r\n\t\tstatus: raw.status || 'active',\r\n\t\tnotes: String(raw.notes || '').trim(),\r\n\t\testablishedYear: numeric(raw.establishedYear),\r\n\t\temployeeCount: numeric(raw.employeeCount),\r\n\t\tannualRevenue: numeric(raw.annualRevenue),\r\n\t\tcreditLimit: numeric(raw.creditLimit),\r\n\t\tpreferredPaymentTerms: numeric(raw.preferredPaymentTerms) ?? 30,\r\n\t\ttaxId: String(raw.taxId || '').trim(),\r\n\t};\r\n}\r\n\r\n// Safely map Firestore doc to UI shape with defaults\r\nexport function mapVendorFromDoc(docSnap) {\r\n\tconst data = docSnap.data() || {};\r\n\treturn {\r\n\t\tid: docSnap.id,\r\n\t\tname: data.name || '',\r\n\t\temail: data.email || '',\r\n\t\tphone: data.phone || '',\r\n\t\taddress: data.address || '',\r\n\t\tcity: data.city || '',\r\n\t\tstate: data.state || '',\r\n\t\tzipCode: data.zipCode || '',\r\n\t\tcountry: data.country || 'India',\r\n\t\twebsite: data.website || '',\r\n\t\tcontactPerson: data.contactPerson || '',\r\n\t\tcontactPhone: data.contactPhone || '',\r\n\t\tcontactEmail: data.contactEmail || '',\r\n\t\tcategory: data.category || '',\r\n\t\trating: typeof data.rating === 'number' ? data.rating : Number(data.rating || 0),\r\n\t\tgstNumber: data.gstNumber || '',\r\n\t\tpanNumber: data.panNumber || '',\r\n\t\tbankDetails: {\r\n\t\t\taccountNumber: data.bankDetails?.accountNumber || '',\r\n\t\t\tifscCode: data.bankDetails?.ifscCode || '',\r\n\t\t\tbankName: data.bankDetails?.bankName || '',\r\n\t\t\taccountHolderName: data.bankDetails?.accountHolderName || '',\r\n\t\t},\r\n\t\tservices: Array.isArray(data.services) ? data.services : [],\r\n\t\tstatus: data.status || 'active',\r\n\t\tnotes: data.notes || '',\r\n\t\testablishedYear: data.establishedYear ?? '',\r\n\t\temployeeCount: data.employeeCount ?? '',\r\n\t\tannualRevenue: data.annualRevenue ?? '',\r\n\t\tcreditLimit: data.creditLimit ?? '',\r\n\t\tpreferredPaymentTerms: data.preferredPaymentTerms ?? 30,\r\n\t\ttaxId: data.taxId || '',\r\n\t\tcreatedAt: data.createdAt,\r\n\t\tupdatedAt: data.updatedAt,\r\n\t};\r\n}\r\n\r\nexport async function getVendorsOrdered() {\r\n\tconst q = query(collection(db, VENDORS_COLLECTION), orderBy('createdAt', 'desc'));\r\n\tconst snapshot = await getDocs(q);\r\n\treturn snapshot.docs.map(mapVendorFromDoc);\r\n}\r\n\r\nexport async function getAllVendors() {\r\n\tconst snapshot = await getDocs(collection(db, VENDORS_COLLECTION));\r\n\treturn snapshot.docs.map(mapVendorFromDoc);\r\n}\r\n\r\nexport async function getVendorById(id) {\r\n\tconst snap = await getDoc(doc(db, VENDORS_COLLECTION, id));\r\n\tif (!snap.exists()) return null;\r\n\treturn mapVendorFromDoc(snap);\r\n}\r\n\r\nasync function findDuplicateVendor(email, phone, excludeId) {\r\n\tconst dupCandidates = [];\r\n\tif (email) {\r\n\t\tconst emailQ = query(collection(db, VENDORS_COLLECTION), where('email', '==', email));\r\n\t\tconst emailSnap = await getDocs(emailQ);\r\n\t\temailSnap.forEach((d) => dupCandidates.push(d));\r\n\t}\r\n\tif (phone) {\r\n\t\tconst phoneQ = query(collection(db, VENDORS_COLLECTION), where('phone', '==', phone));\r\n\t\tconst phoneSnap = await getDocs(phoneQ);\r\n\t\tphoneSnap.forEach((d) => dupCandidates.push(d));\r\n\t}\r\n\r\n\tfor (const d of dupCandidates) {\r\n\t\tif (!excludeId || d.id !== excludeId) {\r\n\t\t\tconst data = d.data();\r\n\t\t\tif (email && data.email === email && (!excludeId || d.id !== excludeId)) {\r\n\t\t\t\treturn { type: 'email', id: d.id };\r\n\t\t\t}\r\n\t\t\tif (phone && data.phone === phone && (!excludeId || d.id !== excludeId)) {\r\n\t\t\t\treturn { type: 'phone', id: d.id };\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n}\r\n\r\nasync function logVendorActivity(vendorId, action, details) {\r\n\ttry {\r\n\t\tawait addDoc(collection(db, VENDOR_ACTIVITY_COLLECTION), {\r\n\t\t\tvendorId,\r\n\t\t\taction,\r\n\t\t\tdetails: details || {},\r\n\t\t\ttimestamp: serverTimestamp(),\r\n\t\t});\r\n\t} catch (_) {\r\n\t\t// Best effort logging; ignore failures\r\n\t}\r\n}\r\n\r\nexport async function createVendor(raw) {\r\n\tconst data = normalizeVendorForSave(raw);\r\n\tconst duplicate = await findDuplicateVendor(data.email, data.phone);\r\n\tif (duplicate) {\r\n\t\tconst err = new Error(duplicate.type === 'email' ? 'DUPLICATE_VENDOR_EMAIL' : 'DUPLICATE_VENDOR_PHONE');\r\n\t\tthrow err;\r\n\t}\r\n\tconst now = serverTimestamp();\r\n\tconst ref = await addDoc(collection(db, VENDORS_COLLECTION), { ...data, createdAt: now, updatedAt: now });\r\n\tawait logVendorActivity(ref.id, 'create', { name: data.name, email: data.email });\r\n}\r\n\r\n// Get vendors with WhatsApp auto-send enabled (simplified query)\r\nexport async function getVendorsWithWhatsAppAutoSend() {\r\n\ttry {\r\n\t\t// Use a simpler query to avoid composite index issues\r\n\t\tconst q = query(\r\n\t\t\tcollection(db, VENDORS_COLLECTION),\r\n\t\t\twhere('status', '==', 'active')\r\n\t\t);\r\n\t\tconst snapshot = await getDocs(q);\r\n\t\t\r\n\t\t// Filter in memory to avoid complex Firestore queries\r\n\t\treturn snapshot.docs\r\n\t\t\t.map(mapVendorFromDoc)\r\n\t\t\t.filter(vendor => \r\n\t\t\t\tvendor.whatsappAutoSend === true && \r\n\t\t\t\tvendor.phone && \r\n\t\t\t\tvendor.phone.trim() !== ''\r\n\t\t\t);\r\n\t} catch (error) {\r\n\t\tconsole.error('Error fetching vendors with WhatsApp auto-send:', error);\r\n\t\t// Return empty array instead of throwing to prevent app crashes\r\n\t\treturn [];\r\n\t}\r\n}\r\n\r\n// Update vendor WhatsApp settings\r\nexport async function updateVendorWhatsAppSettings(vendorId, settings) {\r\n\ttry {\r\n\t\tconst vendorRef = doc(db, VENDORS_COLLECTION, vendorId);\r\n\t\tawait updateDoc(vendorRef, {\r\n\t\t\twhatsappAutoSend: settings.autoSend || false,\r\n\t\t\twhatsappTemplate: settings.template || 'default',\r\n\t\t\twhatsappEnabled: settings.enabled || false,\r\n\t\t\tupdatedAt: serverTimestamp()\r\n\t\t});\r\n\r\n\t\t// Log activity\r\n\t\tawait logVendorActivity(vendorId, 'updated', {\r\n\t\t\tchanges: `WhatsApp settings updated: ${JSON.stringify(settings)}`\r\n\t\t});\r\n\r\n\t\treturn { success: true };\r\n\t} catch (error) {\r\n\t\tconsole.error('Error updating vendor WhatsApp settings:', error);\r\n\t\tthrow error;\r\n\t}\r\n}\r\n\r\nexport async function updateVendor(id, raw) {\r\n\tconst data = normalizeVendorForSave(raw);\r\n\tconst duplicate = await findDuplicateVendor(data.email, data.phone, id);\r\n\tif (duplicate) {\r\n\t\tconst err = new Error(duplicate.type === 'email' ? 'DUPLICATE_VENDOR_EMAIL' : 'DUPLICATE_VENDOR_PHONE');\r\n\t\tthrow err;\r\n\t}\r\n\tawait updateDoc(doc(db, VENDORS_COLLECTION, id), { ...data, updatedAt: serverTimestamp() });\r\n\tawait logVendorActivity(id, 'update', { name: data.name, email: data.email });\r\n}\r\n\r\nexport async function deleteVendor(id) {\r\n\tawait deleteDoc(doc(db, VENDORS_COLLECTION, id));\r\n\tawait logVendorActivity(id, 'delete');\r\n}\r\n\r\nexport async function bulkUpdateVendors(ids, fields) {\r\n\tconst batch = writeBatch(db);\r\n\tids.forEach((id) => {\r\n\t\tbatch.update(doc(db, VENDORS_COLLECTION, id), { ...fields, updatedAt: serverTimestamp() });\r\n\t});\r\n\tawait batch.commit();\r\n\tfor (const id of ids) {\r\n\t\tlogVendorActivity(id, 'bulk_update', { fields });\r\n\t}\r\n}\r\n\r\nexport async function bulkDeleteVendors(ids) {\r\n\tconst batch = writeBatch(db);\r\n\tids.forEach((id) => batch.delete(doc(db, VENDORS_COLLECTION, id)));\r\n\tawait batch.commit();\r\n\tfor (const id of ids) {\r\n\t\tlogVendorActivity(id, 'bulk_delete');\r\n\t}\r\n}\r\n\r\nexport async function queryPOsByVendorId(vendorId) {\r\n\tconst q = query(collection(db, 'purchaseOrders'), where('vendorId', '==', vendorId));\r\n\tconst snapshot = await getDocs(q);\r\n\treturn snapshot.docs.map((d) => d.data());\r\n}\r\n\r\nexport async function queryJobsByVendorId(vendorId) {\r\n\tconst q = query(collection(db, 'jobAssignments'), where('vendorId', '==', vendorId));\r\n\tconst snapshot = await getDocs(q);\r\n\treturn snapshot.docs.map((d) => d.data());\r\n}\r\n\r\nexport async function computeVendorStats(vendors) {\r\n\tconst stats = {};\r\n\tfor (const vendor of vendors) {\r\n\t\ttry {\r\n\t\t\tconst [pos, jobs] = await Promise.all([\r\n\t\t\t\tqueryPOsByVendorId(vendor.id),\r\n\t\t\t\tqueryJobsByVendorId(vendor.id),\r\n\t\t\t]);\r\n\t\t\tstats[vendor.id] = {\r\n\t\t\t\ttotalPOs: pos.length,\r\n\t\t\t\ttotalJobs: jobs.length,\r\n\t\t\t\ttotalSpend: pos.reduce((sum, po) => sum + (parseFloat(po.totalAmount) || 0), 0),\r\n\t\t\t\tcompletedJobs: jobs.filter((job) => job.status === 'completed').length,\r\n\t\t\t\tpendingPOs: pos.filter((po) => po.status === 'pending').length,\r\n\t\t\t\tavgRating: vendor.rating || 0,\r\n\t\t\t\tlastActivity: Math.max(\r\n\t\t\t\t\t...pos.map((po) => po.createdAt?.toDate?.()?.getTime() || 0),\r\n\t\t\t\t\t...jobs.map((job) => job.createdAt?.toDate?.()?.getTime() || 0)\r\n\t\t\t\t),\r\n\t\t\t};\r\n\t\t} catch (e) {\r\n\t\t\tstats[vendor.id] = {\r\n\t\t\t\ttotalPOs: 0,\r\n\t\t\t\ttotalJobs: 0,\r\n\t\t\t\ttotalSpend: 0,\r\n\t\t\t\tcompletedJobs: 0,\r\n\t\t\t\tpendingPOs: 0,\r\n\t\t\t\tavgRating: 0,\r\n\t\t\t\tlastActivity: 0,\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\treturn stats;\r\n}\r\n","import jsPDF from 'jspdf';\r\nimport html2canvas from 'html2canvas';\r\n\r\nclass PDFService {\r\n  // Generate PDF from PO data\r\n  async generatePOPDF(poData, vendorData) {\r\n    try {\r\n      // Create a temporary element to render the PO\r\n      const tempElement = this.createPOElement(poData, vendorData);\r\n      document.body.appendChild(tempElement);\r\n\r\n      // Generate canvas from the element\r\n      const canvas = await html2canvas(tempElement, {\r\n        scale: 2,\r\n        useCORS: true,\r\n        allowTaint: true,\r\n        backgroundColor: '#ffffff'\r\n      });\r\n\r\n      // Remove temporary element\r\n      document.body.removeChild(tempElement);\r\n\r\n      // Create PDF\r\n      const imgData = canvas.toDataURL('image/png');\r\n      const pdf = new jsPDF('p', 'mm', 'a4');\r\n      \r\n      const imgWidth = 210; // A4 width in mm\r\n      const pageHeight = 295; // A4 height in mm\r\n      const imgHeight = (canvas.height * imgWidth) / canvas.width;\r\n      let heightLeft = imgHeight;\r\n\r\n      let position = 0;\r\n\r\n      // Add first page\r\n      pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);\r\n      heightLeft -= pageHeight;\r\n\r\n      // Add additional pages if needed\r\n      while (heightLeft >= 0) {\r\n        position = heightLeft - imgHeight;\r\n        pdf.addPage();\r\n        pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);\r\n        heightLeft -= pageHeight;\r\n      }\r\n\r\n      return pdf;\r\n    } catch (error) {\r\n      console.error('Error generating PDF:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  // Create temporary PO element for PDF generation\r\n  createPOElement(poData, vendorData) {\r\n    const element = document.createElement('div');\r\n    element.style.position = 'absolute';\r\n    element.style.left = '-9999px';\r\n    element.style.top = '0';\r\n    element.style.width = '210mm';\r\n    element.style.backgroundColor = 'white';\r\n    element.style.padding = '20px';\r\n    element.style.fontFamily = 'Arial, sans-serif';\r\n    element.style.fontSize = '12px';\r\n    element.style.lineHeight = '1.4';\r\n\r\n    element.innerHTML = `\r\n      <div style=\"text-align: center; margin-bottom: 30px; border-bottom: 2px solid #333; padding-bottom: 20px;\">\r\n        <h1 style=\"font-size: 24px; margin: 0; color: #333;\">PURCHASE ORDER</h1>\r\n        <p style=\"font-size: 16px; margin: 5px 0; color: #666;\">PO Number: ${poData.poNumber || 'PO' + Date.now()}</p>\r\n        <p style=\"font-size: 14px; margin: 0; color: #666;\">Date: ${new Date().toLocaleDateString()}</p>\r\n      </div>\r\n\r\n      <div style=\"display: flex; justify-content: space-between; margin-bottom: 30px;\">\r\n        <div style=\"width: 48%;\">\r\n          <h3 style=\"font-size: 14px; margin: 0 0 10px 0; color: #333;\">From:</h3>\r\n          <div style=\"font-size: 12px; line-height: 1.5;\">\r\n            <p style=\"margin: 2px 0; font-weight: bold;\">Your Company Name</p>\r\n            <p style=\"margin: 2px 0;\">123 Business Street</p>\r\n            <p style=\"margin: 2px 0;\">City, State 12345</p>\r\n            <p style=\"margin: 2px 0;\">Phone: (555) 123-4567</p>\r\n            <p style=\"margin: 2px 0;\">Email: info@company.com</p>\r\n          </div>\r\n        </div>\r\n        <div style=\"width: 48%;\">\r\n          <h3 style=\"font-size: 14px; margin: 0 0 10px 0; color: #333;\">To:</h3>\r\n          <div style=\"font-size: 12px; line-height: 1.5;\">\r\n            <p style=\"margin: 2px 0; font-weight: bold;\">${vendorData.name}</p>\r\n            <p style=\"margin: 2px 0;\">${vendorData.address || 'N/A'}</p>\r\n            <p style=\"margin: 2px 0;\">Phone: ${vendorData.phone}</p>\r\n            <p style=\"margin: 2px 0;\">Email: ${vendorData.email || 'N/A'}</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div style=\"margin-bottom: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 5px;\">\r\n        <div style=\"display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 15px; font-size: 12px;\">\r\n          <div>\r\n            <strong>Operation:</strong><br>\r\n            ${poData.operation || 'N/A'}\r\n          </div>\r\n          <div>\r\n            <strong>Delivery Date:</strong><br>\r\n            ${poData.deliveryDate ? new Date(poData.deliveryDate).toLocaleDateString() : 'TBD'}\r\n          </div>\r\n          <div>\r\n            <strong>Payment Terms:</strong><br>\r\n            ${poData.paymentTerms || 30} Days\r\n          </div>\r\n          <div>\r\n            <strong>Priority:</strong><br>\r\n            ${poData.priority || 'Medium'}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <h3 style=\"font-size: 16px; margin: 20px 0 10px 0; color: #333;\">Items / Services</h3>\r\n      <table style=\"width: 100%; border-collapse: collapse; margin-bottom: 20px; font-size: 11px;\">\r\n        <thead>\r\n          <tr style=\"background-color: #f8f9fa;\">\r\n            <th style=\"border: 1px solid #ddd; padding: 8px; text-align: left;\">Description</th>\r\n            <th style=\"border: 1px solid #ddd; padding: 8px; text-align: center;\">Qty</th>\r\n            <th style=\"border: 1px solid #ddd; padding: 8px; text-align: center;\">Unit</th>\r\n            <th style=\"border: 1px solid #ddd; padding: 8px; text-align: right;\">Unit Price</th>\r\n            <th style=\"border: 1px solid #ddd; padding: 8px; text-align: right;\">Amount</th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          ${(poData.items || []).map(item => `\r\n            <tr>\r\n              <td style=\"border: 1px solid #ddd; padding: 8px;\">\r\n                <div style=\"font-weight: bold;\">${item.description || 'N/A'}</div>\r\n                ${item.specifications ? `<div style=\"font-size: 10px; color: #666; margin-top: 2px;\">${item.specifications}</div>` : ''}\r\n              </td>\r\n              <td style=\"border: 1px solid #ddd; padding: 8px; text-align: center;\">${item.quantity || 0}</td>\r\n              <td style=\"border: 1px solid #ddd; padding: 8px; text-align: center;\">${item.unit || 'pcs'}</td>\r\n              <td style=\"border: 1px solid #ddd; padding: 8px; text-align: right;\">${parseFloat(item.unitPrice || 0).toLocaleString()}</td>\r\n              <td style=\"border: 1px solid #ddd; padding: 8px; text-align: right;\">${parseFloat(item.amount || 0).toLocaleString()}</td>\r\n            </tr>\r\n          `).join('')}\r\n        </tbody>\r\n        <tfoot>\r\n          <tr style=\"background-color: #f8f9fa; font-weight: bold;\">\r\n            <td colspan=\"4\" style=\"border: 1px solid #ddd; padding: 8px; text-align: right;\">Subtotal:</td>\r\n            <td style=\"border: 1px solid #ddd; padding: 8px; text-align: right;\">${parseFloat(poData.totalAmount || 0).toLocaleString()}</td>\r\n          </tr>\r\n          ${parseFloat(poData.discountAmount || 0) > 0 ? `\r\n            <tr style=\"background-color: #f8f9fa; font-weight: bold;\">\r\n              <td colspan=\"4\" style=\"border: 1px solid #ddd; padding: 8px; text-align: right;\">Discount:</td>\r\n              <td style=\"border: 1px solid #ddd; padding: 8px; text-align: right; color: red;\">-${parseFloat(poData.discountAmount || 0).toLocaleString()}</td>\r\n            </tr>\r\n          ` : ''}\r\n          ${parseFloat(poData.taxAmount || 0) > 0 ? `\r\n            <tr style=\"background-color: #f8f9fa; font-weight: bold;\">\r\n              <td colspan=\"4\" style=\"border: 1px solid #ddd; padding: 8px; text-align: right;\">Tax (${poData.taxRate || 0}%):</td>\r\n              <td style=\"border: 1px solid #ddd; padding: 8px; text-align: right;\">${parseFloat(poData.taxAmount || 0).toLocaleString()}</td>\r\n            </tr>\r\n          ` : ''}\r\n          <tr style=\"background-color: #e9ecef; font-weight: bold; font-size: 12px;\">\r\n            <td colspan=\"4\" style=\"border: 1px solid #ddd; padding: 10px; text-align: right;\">Total Amount:</td>\r\n            <td style=\"border: 1px solid #ddd; padding: 10px; text-align: right;\">${parseFloat(poData.finalAmount || 0).toLocaleString()}</td>\r\n          </tr>\r\n        </tfoot>\r\n      </table>\r\n\r\n      ${poData.description ? `\r\n        <div style=\"margin-bottom: 20px;\">\r\n          <h4 style=\"font-size: 14px; margin: 0 0 8px 0; color: #333;\">Description:</h4>\r\n          <p style=\"font-size: 11px; line-height: 1.4; margin: 0;\">${poData.description}</p>\r\n        </div>\r\n      ` : ''}\r\n\r\n      ${poData.specifications ? `\r\n        <div style=\"margin-bottom: 20px;\">\r\n          <h4 style=\"font-size: 14px; margin: 0 0 8px 0; color: #333;\">Technical Specifications:</h4>\r\n          <p style=\"font-size: 11px; line-height: 1.4; margin: 0; white-space: pre-line;\">${poData.specifications}</p>\r\n        </div>\r\n      ` : ''}\r\n\r\n      ${poData.terms ? `\r\n        <div style=\"margin-bottom: 20px;\">\r\n          <h4 style=\"font-size: 14px; margin: 0 0 8px 0; color: #333;\">Terms & Conditions:</h4>\r\n          <p style=\"font-size: 11px; line-height: 1.4; margin: 0; white-space: pre-line;\">${poData.terms}</p>\r\n        </div>\r\n      ` : ''}\r\n\r\n      <div style=\"margin-top: 40px; display: flex; justify-content: space-between;\">\r\n        <div style=\"width: 45%;\">\r\n          <div style=\"border-top: 1px solid #333; padding-top: 5px; text-align: center;\">\r\n            <p style=\"font-size: 11px; margin: 0; color: #666;\">Authorized Signature</p>\r\n            <p style=\"font-size: 10px; margin: 5px 0 0 0; color: #666;\">Name & Title</p>\r\n            <p style=\"font-size: 10px; margin: 0; color: #666;\">Date: ${new Date().toLocaleDateString()}</p>\r\n          </div>\r\n        </div>\r\n        <div style=\"width: 45%;\">\r\n          <div style=\"border-top: 1px solid #333; padding-top: 5px; text-align: center;\">\r\n            <p style=\"font-size: 11px; margin: 0; color: #666;\">Vendor Acknowledgment</p>\r\n            <p style=\"font-size: 10px; margin: 5px 0 0 0; color: #666;\">Authorized Signature</p>\r\n            <p style=\"font-size: 10px; margin: 0; color: #666;\">Date: ___________________</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    return element;\r\n  }\r\n\r\n  // Download PDF\r\n  downloadPDF(pdf, filename) {\r\n    pdf.save(filename || `PO_${Date.now()}.pdf`);\r\n  }\r\n\r\n  // Get PDF as blob for WhatsApp sending\r\n  getPDFBlob(pdf) {\r\n    return pdf.output('blob');\r\n  }\r\n\r\n  // Get PDF as data URL for WhatsApp sending\r\n  getPDFDataURL(pdf) {\r\n    return pdf.output('datauristring');\r\n  }\r\n}\r\n\r\n// Create and export singleton instance\r\nconst pdfService = new PDFService();\r\nexport default pdfService;\r\n","// File upload service for sharing PDFs via WhatsApp\r\nclass FileUploadService {\r\n  constructor() {\r\n    // Using a simple file sharing service (you can replace with your preferred service)\r\n    this.uploadEndpoint = 'https://file.io'; // Free file sharing service\r\n  }\r\n\r\n  // Upload PDF file and get shareable URL\r\n  async uploadPDF(pdfBlob, filename) {\r\n    try {\r\n      const formData = new FormData();\r\n      formData.append('file', pdfBlob, filename);\r\n\r\n      const response = await fetch(this.uploadEndpoint, {\r\n        method: 'POST',\r\n        body: formData\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`Upload failed: ${response.statusText}`);\r\n      }\r\n\r\n      const result = await response.json();\r\n      \r\n      if (result.success) {\r\n        return {\r\n          success: true,\r\n          url: result.link,\r\n          filename: filename,\r\n          expires: result.expires || '1 day'\r\n        };\r\n      } else {\r\n        throw new Error('Upload failed: Invalid response');\r\n      }\r\n    } catch (error) {\r\n      console.error('File upload error:', error);\r\n      return {\r\n        success: false,\r\n        error: error.message\r\n      };\r\n    }\r\n  }\r\n\r\n  // Alternative: Use data URL for smaller files (base64 encoded)\r\n  async createDataURL(pdfBlob) {\r\n    return new Promise((resolve) => {\r\n      const reader = new FileReader();\r\n      reader.onload = () => resolve(reader.result);\r\n      reader.readAsDataURL(pdfBlob);\r\n    });\r\n  }\r\n\r\n  // Generate shareable link using data URL (for smaller files)\r\n  async generateShareableLink(pdfBlob, filename) {\r\n    try {\r\n      // For small files, we can use data URLs directly\r\n      const dataURL = await this.createDataURL(pdfBlob);\r\n      \r\n      // Create a simple sharing page (you can host this on your server)\r\n      const shareData = {\r\n        filename: filename,\r\n        data: dataURL,\r\n        timestamp: Date.now()\r\n      };\r\n\r\n      // Store in localStorage for demo purposes (in production, use a proper backend)\r\n      const shareId = `po_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\r\n      localStorage.setItem(`share_${shareId}`, JSON.stringify(shareData));\r\n\r\n      // Return a local URL (in production, this would be your server URL)\r\n      const shareUrl = `${window.location.origin}/share/${shareId}`;\r\n      \r\n      return {\r\n        success: true,\r\n        url: shareUrl,\r\n        filename: filename,\r\n        expires: '7 days'\r\n      };\r\n    } catch (error) {\r\n      console.error('Data URL generation error:', error);\r\n      return {\r\n        success: false,\r\n        error: error.message\r\n      };\r\n    }\r\n  }\r\n}\r\n\r\n// Create and export singleton instance\r\nconst fileUploadService = new FileUploadService();\r\nexport default fileUploadService;\r\n","// Message template service for WhatsApp communications\r\nclass MessageTemplateService {\r\n  constructor() {\r\n    this.businessName = process.env.REACT_APP_BUSINESS_NAME || 'VMT Admin';\r\n    this.websiteUrl = 'https://vmttech.in';\r\n    this.companyName = 'VMT Technologies';\r\n  }\r\n\r\n  // Generate PO message template with link\r\n  generatePOMessage(poData, vendorData) {\r\n    const poNumber = poData.poNumber || 'N/A';\r\n    const totalAmount = parseFloat(poData.finalAmount || poData.totalAmount || 0).toLocaleString();\r\n    const deliveryDate = poData.deliveryDate ? new Date(poData.deliveryDate).toLocaleDateString() : 'TBD';\r\n    \r\n    return ` *${this.companyName}* - Purchase Order\r\n\r\nDear ${vendorData.name},\r\n\r\nWe are pleased to share with you our Purchase Order details:\r\n\r\n *PO Details:*\r\n PO Number: *${poNumber}*\r\n Date: ${new Date().toLocaleDateString()}\r\n Total Amount: *${totalAmount}*\r\n Delivery Date: ${deliveryDate}\r\n\r\n${poData.operation ? ` Operation: ${poData.operation}` : ''}\r\n\r\n *Document:*\r\nPlease find the complete Purchase Order document attached with all terms, conditions, and item details.\r\n\r\n *Our Website:*\r\nVisit us at: ${this.websiteUrl}\r\nFor more information about our services and company profile.\r\n\r\n *Contact Information:*\r\nFor any queries or clarifications, please contact us directly.\r\n\r\nThank you for your continued partnership!\r\n\r\nBest regards,\r\n${this.businessName}\r\n${this.websiteUrl}`;\r\n  }\r\n\r\n  // Generate PO message template for PDF sharing\r\n  generatePOMessageWithPDF(poData, vendorData, pdfUrl = null) {\r\n    const poNumber = poData.poNumber || 'N/A';\r\n    const totalAmount = parseFloat(poData.finalAmount || poData.totalAmount || 0).toLocaleString();\r\n    const deliveryDate = poData.deliveryDate ? new Date(poData.deliveryDate).toLocaleDateString() : 'TBD';\r\n    \r\n    let message = ` *${this.companyName}* - Purchase Order\r\n\r\nDear ${vendorData.name},\r\n\r\nWe are pleased to share with you our Purchase Order details:\r\n\r\n *PO Details:*\r\n PO Number: *${poNumber}*\r\n Date: ${new Date().toLocaleDateString()}\r\n Total Amount: *${totalAmount}*\r\n Delivery Date: ${deliveryDate}\r\n\r\n${poData.operation ? ` Operation: ${poData.operation}` : ''}`;\r\n\r\n    if (pdfUrl) {\r\n      message += `\\n\\n *Document Link:*\r\n${pdfUrl}\r\n\r\nPlease download the complete Purchase Order document with all terms, conditions, and item details.`;\r\n    } else {\r\n      message += `\\n\\n *Document:*\r\nPlease find the complete Purchase Order document attached with all terms, conditions, and item details.`;\r\n    }\r\n\r\n    message += `\\n\\n *Our Website:*\r\nVisit us at: ${this.websiteUrl}\r\nFor more information about our services and company profile.\r\n\r\n *Contact Information:*\r\nFor any queries or clarifications, please contact us directly.\r\n\r\nThank you for your continued partnership!\r\n\r\nBest regards,\r\n${this.businessName}\r\n${this.websiteUrl}`;\r\n\r\n    return message;\r\n  }\r\n\r\n  // Generate simple PO message for direct file sharing\r\n  generateSimplePOMessage(poData, vendorData) {\r\n    const poNumber = poData.poNumber || 'N/A';\r\n    \r\n    return `Hello ${vendorData.name},\r\n\r\nPlease find attached the Purchase Order #${poNumber}.\r\n\r\nVisit us: ${this.websiteUrl}\r\n\r\nThank you!\r\n${this.businessName}`;\r\n  }\r\n\r\n  // Generate status update message template\r\n  generateStatusUpdateMessage(poData, newStatus, oldStatus) {\r\n    const poNumber = poData.poNumber || 'N/A';\r\n    const statusEmojis = {\r\n      pending: '',\r\n      approved: '',\r\n      rejected: '',\r\n      completed: '',\r\n      in_progress: '',\r\n      cancelled: ''\r\n    };\r\n\r\n    const statusMessages = {\r\n      approved: 'Your Purchase Order has been approved! You can proceed with the work.',\r\n      rejected: 'Your Purchase Order has been rejected. Please contact us for more details.',\r\n      completed: 'Purchase Order has been marked as completed. Thank you for your service!',\r\n      in_progress: 'Purchase Order is now in progress. Work has begun.',\r\n      cancelled: 'Purchase Order has been cancelled. Please contact us for more details.'\r\n    };\r\n\r\n    return ` *${this.companyName}* - PO Status Update\r\n\r\nPO Number: *${poNumber}*\r\nStatus: ${oldStatus}  *${newStatus.toUpperCase()}*\r\n\r\n${statusEmojis[newStatus]} ${statusMessages[newStatus] || `PO status has been updated to ${newStatus}.`}\r\n\r\n Visit us: ${this.websiteUrl}\r\n\r\n${this.businessName}`;\r\n  }\r\n\r\n  // Generate general message template\r\n  generateGeneralMessage(subject, content, vendorData) {\r\n    return ` *${this.companyName}* - ${subject}\r\n\r\nDear ${vendorData.name},\r\n\r\n${content}\r\n\r\n Visit us: ${this.websiteUrl}\r\n\r\nBest regards,\r\n${this.businessName}`;\r\n  }\r\n\r\n  // Generate welcome message for new vendors\r\n  generateWelcomeMessage(vendorData) {\r\n    return ` *${this.companyName}* - Welcome!\r\n\r\nDear ${vendorData.name},\r\n\r\nWelcome to our vendor network! We're excited to work with you.\r\n\r\n *Our Website:*\r\nVisit us at: ${this.websiteUrl}\r\nLearn more about our services and company profile.\r\n\r\n *Contact Information:*\r\nFor any questions or support, please don't hesitate to contact us.\r\n\r\nWe look forward to a successful partnership!\r\n\r\nBest regards,\r\n${this.businessName}\r\n${this.websiteUrl}`;\r\n  }\r\n}\r\n\r\n// Create and export singleton instance\r\nconst messageTemplateService = new MessageTemplateService();\r\nexport default messageTemplateService;\r\n","// WhatsApp Business API integration service\n// This service handles sending PO details to vendors via WhatsApp\n\nimport pdfService from './pdfService';\nimport fileUploadService from './fileUploadService';\nimport messageTemplateService from './messageTemplateService';\n\nclass WhatsAppService {\n  constructor() {\n    // WhatsApp Business API configuration\n    this.baseURL = process.env.REACT_APP_WHATSAPP_API_URL || 'https://graph.facebook.com/v18.0';\n    this.accessToken = process.env.REACT_APP_WHATSAPP_ACCESS_TOKEN || '1306260161141866|7yXEM5nBjGO291Bz@NXLEvzJFto';\n    this.phoneNumberId = process.env.REACT_APP_WHATSAPP_PHONE_NUMBER_ID || '9503367989';\n    this.businessName = process.env.REACT_APP_BUSINESS_NAME || 'VMT Admin';\n  }\n\n  // Format phone number to international format\n  formatPhoneNumber(phone) {\n    // Remove all non-digit characters\n    let cleaned = phone.replace(/\\D/g, '');\n    \n    // Add country code if not present (assuming India +91)\n    if (cleaned.length === 10) {\n      cleaned = '91' + cleaned;\n    } else if (cleaned.startsWith('0')) {\n      cleaned = '91' + cleaned.substring(1);\n    }\n    \n    return cleaned;\n  }\n\n  // Send PO details to vendor via WhatsApp (PDF version)\n  async sendPOToVendor(poData, vendorData) {\n    try {\n      // Generate PDF\n      const pdf = await pdfService.generatePOPDF(poData, vendorData);\n      const vendorPhone = this.formatPhoneNumber(vendorData.phone);\n      \n      // Generate filename\n      const filename = `PO_${poData.poNumber || Date.now()}_${vendorData.name.replace(/\\s+/g, '_')}.pdf`;\n      \n      // Get PDF as blob\n      const pdfBlob = pdfService.getPDFBlob(pdf);\n      \n      // Try Web Share API first (for mobile devices)\n      if (navigator.share && navigator.canShare) {\n        try {\n          const file = new File([pdfBlob], filename, { type: 'application/pdf' });\n          \n          if (navigator.canShare({ files: [file] })) {\n            await navigator.share({\n              title: `Purchase Order #${poData.poNumber || 'N/A'}`,\n              text: `Hello ${vendorData.name},\\n\\nPlease find the Purchase Order #${poData.poNumber || 'N/A'} attached.\\n\\nThank you!`,\n              files: [file]\n            });\n            \n            return {\n              success: true,\n              messageId: 'pdf_shared_native',\n              phone: vendorPhone,\n              filename: filename,\n              message: `PDF shared directly via device sharing.`\n            };\n          }\n        } catch (shareError) {\n          console.log('Web Share API failed, falling back to other methods:', shareError);\n        }\n      }\n      \n      // Try to upload PDF and get shareable URL\n      const uploadResult = await fileUploadService.uploadPDF(pdfBlob, filename);\n      \n      if (uploadResult.success) {\n      // Use uploaded PDF URL\n      const message = messageTemplateService.generatePOMessageWithPDF(poData, vendorData, uploadResult.url);\n      const whatsappUrl = `https://wa.me/${vendorPhone}?text=${encodeURIComponent(message)}`;\n      window.open(whatsappUrl, '_blank');\n        \n        return {\n          success: true,\n          messageId: 'pdf_uploaded',\n          phone: vendorPhone,\n          whatsappUrl: whatsappUrl,\n          filename: filename,\n          shareUrl: uploadResult.url,\n          message: `PDF uploaded and shared via link. WhatsApp Web opened with the link.`\n        };\n      }\n      \n      // Fallback: Download PDF and open WhatsApp with instructions\n      pdfService.downloadPDF(pdf, filename);\n      const message = messageTemplateService.generateSimplePOMessage(poData, vendorData);\n      const whatsappUrl = `https://wa.me/${vendorPhone}?text=${encodeURIComponent(message)}`;\n      window.open(whatsappUrl, '_blank');\n      \n      return {\n        success: true,\n        messageId: 'pdf_downloaded',\n        phone: vendorPhone,\n        whatsappUrl: whatsappUrl,\n        filename: filename,\n        message: `PDF downloaded as \"${filename}\". WhatsApp Web opened. Please attach the downloaded PDF file.`\n      };\n      \n    } catch (error) {\n      console.error('WhatsApp PDF Service Error:', error);\n      return { \n        success: false, \n        error: error.message || 'Failed to generate and share PDF for WhatsApp' \n      };\n    }\n  }\n\n  // Generate formatted PO message for WhatsApp\n  generatePOMessage(poData, vendorData) {\n    return messageTemplateService.generatePOMessage(poData, vendorData);\n  }\n\n  // Send PO status update to vendor\n  async sendPOStatusUpdate(poData, vendorData, newStatus, oldStatus) {\n    try {\n      if (!this.accessToken || !this.phoneNumberId) {\n        return { success: false, error: 'WhatsApp API not configured' };\n      }\n\n      const vendorPhone = this.formatPhoneNumber(vendorData.phone);\n      const message = messageTemplateService.generateStatusUpdateMessage(poData, newStatus, oldStatus);\n\n      const response = await fetch(`${this.baseURL}/${this.phoneNumberId}/messages`, {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${this.accessToken}`,\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          messaging_product: 'whatsapp',\n          to: vendorPhone,\n          type: 'text',\n          text: {\n            body: message\n          }\n        })\n      });\n\n      const result = await response.json();\n      return response.ok ? { success: true, messageId: result.messages[0].id } : { success: false, error: result.error?.message };\n    } catch (error) {\n      console.error('WhatsApp Status Update Error:', error);\n      return { success: false, error: error.message };\n    }\n  }\n\n\n  // Send custom message to vendor\n  async sendCustomMessage(vendorPhone, message) {\n    try {\n      if (!this.accessToken || !this.phoneNumberId) {\n        return { success: false, error: 'WhatsApp API not configured' };\n      }\n\n      const formattedPhone = this.formatPhoneNumber(vendorPhone);\n\n      const response = await fetch(`${this.baseURL}/${this.phoneNumberId}/messages`, {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${this.accessToken}`,\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          messaging_product: 'whatsapp',\n          to: formattedPhone,\n          type: 'text',\n          text: {\n            body: message\n          }\n        })\n      });\n\n      const result = await response.json();\n      return response.ok ? { success: true, messageId: result.messages[0].id } : { success: false, error: result.error?.message };\n    } catch (error) {\n      console.error('WhatsApp Custom Message Error:', error);\n      return { success: false, error: error.message };\n    }\n  }\n\n  // Send document/file to vendor (for PO PDF)\n  async sendDocument(vendorPhone, documentUrl, filename, caption) {\n    try {\n      if (!this.accessToken || !this.phoneNumberId) {\n        return { success: false, error: 'WhatsApp API not configured' };\n      }\n\n      const formattedPhone = this.formatPhoneNumber(vendorPhone);\n\n      const response = await fetch(`${this.baseURL}/${this.phoneNumberId}/messages`, {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${this.accessToken}`,\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          messaging_product: 'whatsapp',\n          to: formattedPhone,\n          type: 'document',\n          document: {\n            link: documentUrl,\n            filename: filename,\n            caption: caption\n          }\n        })\n      });\n\n      const result = await response.json();\n      return response.ok ? { success: true, messageId: result.messages[0].id } : { success: false, error: result.error?.message };\n    } catch (error) {\n      console.error('WhatsApp Document Send Error:', error);\n      return { success: false, error: error.message };\n    }\n  }\n\n  // Validate WhatsApp configuration (simplified - always works)\n  isConfigured() {\n    return true; // Simplified version always works via WhatsApp Web\n  }\n\n  // Test WhatsApp connection\n  async testConnection() {\n    try {\n      if (!this.isConfigured()) {\n        return { success: false, error: 'WhatsApp API not configured' };\n      }\n\n      const response = await fetch(`${this.baseURL}/${this.phoneNumberId}`, {\n        headers: {\n          'Authorization': `Bearer ${this.accessToken}`,\n        }\n      });\n\n      return response.ok ? { success: true } : { success: false, error: 'Invalid credentials' };\n    } catch (error) {\n      return { success: false, error: error.message };\n    }\n  }\n}\n\n// Create and export singleton instance\nconst whatsappService = new WhatsAppService();\nexport default whatsappService;\n","import { useState, useEffect } from 'react';\nimport { useNavigate, useParams } from 'react-router-dom';\nimport { collection, getDocs } from 'firebase/firestore';\nimport { db } from '../../firebase';\nimport { createPO, getPOById, updatePO, normalizePOForSave } from '../../services/purchaseOrderService';\nimport { getItemsOrdered } from '../../services/itemService';\nimport { getVendorsWithWhatsAppAutoSend, updateVendorWhatsAppSettings } from '../../services/vendorService';\nimport { useNotification } from './NotificationSystem';\nimport { \n  FiArrowLeft, FiCalendar, FiDollarSign, FiUser, FiFileText, \n  FiPlus, FiTrash2, FiSave, FiEye, FiDownload,\n  FiPackage, FiMapPin, FiClock, FiCheck, FiInfo,\n  FiAlertCircle, FiTool\n} from 'react-icons/fi';\nimport whatsappService from '../../services/whatsappService';\n\n// Shared operations list used across POForm and POPreview\nconst operations = [\n  { value: 'HBL', label: 'HBL (Horizontal Boring & Lathe)', description: 'Horizontal boring and lathe operations' },\n  { value: 'VTL', label: 'VTL (Vertical Turning Lathe)', description: 'Vertical turning lathe operations' },\n  { value: 'Drilling', label: 'Drilling', description: 'Drilling operations on various materials' },\n  { value: 'VMC', label: 'VMC (Vertical Machining Center)', description: 'Vertical machining center operations' }\n];\n\nexport default function POForm() {\n  const navigate = useNavigate();\n  const { id } = useParams();\n  const isEditMode = Boolean(id);\n  const { showSuccess, showError } = useNotification();\n  \n  const [loading, setLoading] = useState(false);\n  const [vendors, setVendors] = useState([]);\n  const [selectedVendor, setSelectedVendor] = useState(null);\n  const [masterItems, setMasterItems] = useState([]);\n  const [showPreview, setShowPreview] = useState(false);\n  \n  \n  const [formData, setFormData] = useState({\n    vendorId: '',\n    operations: [],\n    description: '',\n    quantity: 1,\n    unitPrice: '',\n    totalAmount: '',\n    deliveryDate: '',\n    invoiceDate: new Date().toISOString().split('T')[0],\n    dueDate: new Date().toISOString().split('T')[0],\n    stateOfSupply: '',\n    paymentType: 'Cash',\n    terms: '',\n    specifications: '',\n    priority: 'medium',\n    status: 'pending',\n    paymentTerms: '30',\n    shippingAddress: '',\n    billingAddress: '',\n    currency: 'INR',\n    taxRate: 18,\n    taxAmount: 0,\n    discountAmount: 0,\n    finalAmount: 0,\n    roundOffEnabled: true,\n    roundOffValue: 0,\n    approvalRequired: true,\n    expectedDeliveryDays: 7,\n    warrantPeriod: '',\n    qualityRequirements: '',\n    items: [\n      {\n        id: 1,\n        description: '',\n        quantity: 1,\n        unitPrice: '',\n        amount: '',\n        unit: 'pcs',\n        specifications: '',\n        deliveryDate: '',\n        operation: ''\n      }\n    ]\n  });\n\n\n  useEffect(() => {\n    fetchVendors();\n    fetchItems();\n    if (isEditMode) {\n      fetchPO();\n    }\n  }, [id]);\n\n  useEffect(() => {\n    if (formData.vendorId) {\n      const vendor = vendors.find(v => v.id === formData.vendorId);\n      setSelectedVendor(vendor);\n    }\n  }, [formData.vendorId, vendors]);\n\n  useEffect(() => {\n    calculateTotalAmount();\n  }, [formData.items, formData.taxRate, formData.discountAmount, formData.roundOffEnabled]);\n\n  const fetchVendors = async () => {\n    try {\n      const vendorsSnapshot = await getDocs(collection(db, 'vendors'));\n      const vendorsData = [];\n      vendorsSnapshot.forEach((doc) => {\n        const vendor = { id: doc.id, ...doc.data() };\n        if (vendor.status === 'active') {\n          vendorsData.push(vendor);\n        }\n      });\n      setVendors(vendorsData);\n    } catch (error) {\n      console.error('Error fetching vendors:', error);\n      showError('Failed to load vendors');\n    }\n  };\n\n  const fetchItems = async () => {\n    try {\n      // Use service to ensure pricing fields are normalized to numbers\n      const items = await getItemsOrdered();\n      setMasterItems(items);\n    } catch (error) {\n      console.error('Error fetching items:', error);\n    }\n  };\n\n  // WhatsApp-related features removed\n\n  const fetchPO = async () => {\n    try {\n      setLoading(true);\n      const poData = await getPOById(id);\n      if (poData) {\n        setFormData({\n          ...poData,\n          // normalize operations: prefer array, fallback to single\n          operations: Array.isArray(poData.operations) ? poData.operations : (poData.operation ? [poData.operation] : []),\n          deliveryDate: poData.deliveryDate?.toDate?.()?.toISOString().split('T')[0] || poData.deliveryDate || '',\n          items: (poData.items || [{ id: 1, description: '', quantity: 1, unitPrice: '', amount: '' }]).map((it, idx) => ({\n            id: it.id || idx + 1,\n            description: it.description || '',\n            quantity: it.quantity || 1,\n            unitPrice: it.unitPrice || '',\n            amount: it.amount || '',\n            unit: it.unit || 'pcs',\n            specifications: it.specifications || '',\n            deliveryDate: it.deliveryDate || '',\n            operation: it.operation || ''\n          }))\n        });\n      }\n    } catch (error) {\n      console.error('Error fetching PO:', error);\n      showError('Failed to load purchase order');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const generatePONumber = () => {\n    const date = new Date();\n    const year = date.getFullYear();\n    const month = String(date.getMonth() + 1).padStart(2, '0');\n    const day = String(date.getDate()).padStart(2, '0');\n    const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');\n    return `PO${year}${month}${day}${random}`;\n  };\n\n  const calculateTotalAmount = () => {\n    const subtotal = formData.items.reduce((sum, item) => {\n      const amount = parseFloat(item.quantity) * parseFloat(item.unitPrice || 0);\n      return sum + (isNaN(amount) ? 0 : amount);\n    }, 0);\n    \n    const discountAmount = parseFloat(formData.discountAmount || 0);\n    const afterDiscount = subtotal - discountAmount;\n    const taxRate = parseFloat(formData.taxRate || 0);\n    const taxAmount = (afterDiscount * taxRate) / 100;\n    let finalAmount = afterDiscount + taxAmount;\n    let roundOffValue = parseFloat(formData.roundOffValue || 0);\n    if (formData.roundOffEnabled) {\n      const rounded = Math.round(finalAmount);\n      roundOffValue = Number((rounded - finalAmount).toFixed(2));\n      finalAmount = rounded;\n    }\n    \n    setFormData(prev => ({\n      ...prev,\n      totalAmount: subtotal.toFixed(2),\n      taxAmount: taxAmount.toFixed(2),\n      finalAmount: finalAmount.toFixed(2),\n      roundOffValue\n    }));\n  };\n\n  const handleInputChange = (e) => {\n    const { name, value } = e.target;\n    setFormData(prev => ({\n      ...prev,\n      [name]: value\n    }));\n  };\n\n  const handleItemChange = (index, field, value) => {\n    const updatedItems = formData.items.map((item, i) => {\n      if (i === index) {\n        const updatedItem = { ...item, [field]: value };\n        \n        // Calculate amount for this item\n        if (field === 'quantity' || field === 'unitPrice') {\n          const quantity = parseFloat(field === 'quantity' ? value : updatedItem.quantity) || 0;\n          const unitPrice = parseFloat(field === 'unitPrice' ? value : updatedItem.unitPrice) || 0;\n          updatedItem.amount = (quantity * unitPrice).toFixed(2);\n        }\n        \n        return updatedItem;\n      }\n      return item;\n    });\n    \n    setFormData(prev => ({\n      ...prev,\n      items: updatedItems\n    }));\n  };\n\n  const handleSelectMasterItem = (index, itemId) => {\n    const selected = masterItems.find(it => it.id === itemId);\n    if (!selected) {\n      handleItemChange(index, 'itemId', '');\n      return;\n    }\n    // Set description, unit, unitPrice from master\n    const updatedItems = formData.items.map((item, i) => {\n      if (i !== index) return item;\n      const quantity = parseFloat(item.quantity) || 1;\n      // Prefer SALE price, fallback to purchase price, then existing\n      const unitPrice =\n        (selected?.pricing?.salePrice != null ? Number(selected.pricing.salePrice) : null) ??\n        (selected?.pricing?.purchasePrice != null ? Number(selected.pricing.purchasePrice) : null) ??\n        (parseFloat(item.unitPrice) || 0);\n      const amount = (quantity * unitPrice).toFixed(2);\n      return {\n        ...item,\n        itemId: selected.id,\n        description: selected.name || item.description,\n        unit: selected.unit || item.unit || 'pcs',\n        unitPrice: unitPrice,\n        amount\n      };\n    });\n    setFormData(prev => ({ ...prev, items: updatedItems }));\n  };\n\n  const addItem = () => {\n    const newItem = {\n      id: Date.now(),\n      description: '',\n      quantity: 1,\n      unitPrice: '',\n      amount: '',\n      unit: 'pcs',\n      specifications: '',\n      deliveryDate: ''\n    };\n    \n    setFormData(prev => ({\n      ...prev,\n      items: [...prev.items, newItem]\n    }));\n  };\n\n  const removeItem = (index) => {\n    if (formData.items.length > 1) {\n      setFormData(prev => ({\n        ...prev,\n        items: prev.items.filter((_, i) => i !== index)\n      }));\n    }\n  };\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    \n    if (!formData.vendorId || !(formData.operations && formData.operations.length)) {\n      showError('Please select vendor and at least one operation');\n      return;\n    }\n\n    if (formData.items.some(item => !item.description || !item.quantity || !item.unitPrice)) {\n      showError('Please fill in all item details');\n      return;\n    }\n\n    try {\n      setLoading(true);\n      const normalized = normalizePOForSave({ ...formData, poNumber: isEditMode ? formData.poNumber : generatePONumber() });\n\n      if (isEditMode) {\n        await updatePO(id, normalized);\n        showSuccess('Purchase order updated successfully');\n      } else {\n        await createPO(normalized);\n        showSuccess('Purchase order created successfully');\n      }\n      \n      navigate('/admin/purchase-orders');\n    } catch (error) {\n      console.error('Error saving PO:', error);\n      showError('Failed to save purchase order');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handlePreview = () => {\n    if (!formData.vendorId || !(formData.operations && formData.operations.length)) {\n      showError('Please select vendor and at least one operation before preview');\n      return;\n    }\n    setShowPreview(true);\n  };\n\n  // Share PO via WhatsApp Web (no direct API)\n  const handleSendWhatsAppFromForm = async () => {\n    if (!formData.vendorId || !(formData.operations && formData.operations.length)) {\n      showError('Please select vendor and at least one operation before sending');\n      return;\n    }\n    if (!selectedVendor || !selectedVendor.phone) {\n      showError('Selected vendor does not have a valid phone number');\n      return;\n    }\n    try {\n      const poData = { ...formData, poNumber: formData.poNumber || generatePONumber() };\n      const result = await whatsappService.sendPOToVendor(poData, selectedVendor);\n      if (result.success) {\n        showSuccess(result.message || 'PO ready to send via WhatsApp');\n      } else {\n        showError(result.error || 'Failed to prepare PO for WhatsApp');\n      }\n    } catch (err) {\n      console.error('WhatsApp share error:', err);\n      showError('Failed to share via WhatsApp');\n    }\n  };\n\n  if (loading && isEditMode) {\n    return (\n      <div className=\"flex justify-center items-center h-64\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-500\"></div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-slate-50 via-indigo-50 to-purple-50\">\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        {/* Enhanced Header */}\n        <div className=\"bg-white rounded-2xl shadow-xl border border-gray-100 mb-8 overflow-hidden\">\n          <div className=\"bg-gradient-to-r from-indigo-600 via-blue-600 to-purple-600 px-8 py-6\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center space-x-4\">\n                <button \n                  onClick={() => navigate('/admin/purchase-orders')} \n                  className=\"p-3 bg-white/20 hover:bg-white/30 rounded-xl transition-all duration-200 backdrop-blur-sm\"\n                >\n                  <FiArrowLeft className=\"text-white\" size={20} />\n                </button>\n                <div className=\"flex items-center space-x-3\">\n                  <div className=\"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center backdrop-blur-sm\">\n                    <FiFileText className=\"text-white\" size={24} />\n                  </div>\n                  <div>\n                    <h1 className=\"text-2xl font-bold text-white\">\n                      {isEditMode ? 'Edit Purchase Order' : 'Create New Purchase Order'}\n                    </h1>\n                    <p className=\"text-blue-100 text-sm\">\n                      {isEditMode ? 'Update PO details and vendor information' : 'Generate professional purchase order for vendor operations'}\n                    </p>\n                  </div>\n                </div>\n              </div>\n              <div className=\"flex items-center space-x-3\">\n                <button\n                  type=\"button\"\n                  onClick={handlePreview}\n                  className=\"inline-flex items-center px-6 py-3 bg-white/20 hover:bg-white/30 text-white font-medium rounded-xl transition-all duration-200 backdrop-blur-sm\"\n                >\n                  <FiEye className=\"mr-2\" size={16} />\n                  Preview\n                </button>\n                {selectedVendor?.phone && (\n                  <button\n                    type=\"button\"\n                    onClick={handleSendWhatsAppFromForm}\n                    className=\"inline-flex items-center px-6 py-3 bg-green-500/90 hover:bg-green-600 text-white font-medium rounded-xl transition-all duration-200 backdrop-blur-sm\"\n                  >\n                    Send via WhatsApp\n                  </button>\n                )}\n                <div className=\"bg-white/20 backdrop-blur-sm rounded-xl px-4 py-2\">\n                  <span className=\"text-white text-sm font-medium\">\n                    {new Date().toLocaleDateString('en-IN', { \n                      day: 'numeric', \n                      month: 'short', \n                      year: 'numeric' \n                    })}\n                  </span>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <form onSubmit={handleSubmit} className=\"space-y-8\">\n          {/* Basic Information Section */}\n          <div className=\"bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden\">\n            <div className=\"bg-gradient-to-r from-blue-50 to-indigo-50 px-6 py-4 border-b border-gray-100\">\n              <div className=\"flex items-center space-x-3\">\n                <div className=\"w-8 h-8 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center\">\n                  <FiInfo className=\"text-white\" size={16} />\n                </div>\n                <h2 className=\"text-lg font-semibold text-gray-900\">Basic Information</h2>\n                <div className=\"flex-1\"></div>\n                <span className=\"bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded-full\">\n                  Vendor & Operation Details\n                </span>\n              </div>\n            </div>\n            <div className=\"p-6\">\n          \n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                <div className=\"space-y-2\">\n                  <label className=\"block text-sm font-medium text-gray-700\">\n                    Select Vendor *\n                  </label>\n                  <div className=\"relative\">\n                    <select\n                      name=\"vendorId\"\n                      value={formData.vendorId}\n                      onChange={handleInputChange}\n                      required\n                      className=\"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200 appearance-none bg-white\"\n                    >\n                      <option value=\"\">Choose vendor...</option>\n                      {vendors.map((vendor) => (\n                        <option key={vendor.id} value={vendor.id}>\n                          {vendor.name} - {vendor.category}\n                        </option>\n                      ))}\n                    </select>\n                    <FiUser className=\"absolute left-3 top-3.5 text-gray-400\" size={16} />\n                  </div>\n                  {selectedVendor && (\n                    <div className=\"mt-3 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-200\">\n                      <div className=\"flex items-start space-x-3\">\n                        <div className=\"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0\">\n                          <FiUser className=\"text-blue-600\" size={16} />\n                        </div>\n                        <div className=\"flex-1\">\n                          <p className=\"text-sm font-medium text-gray-900\">{selectedVendor.name}</p>\n                          <p className=\"text-xs text-gray-600 mt-1\">\n                            <strong>Contact:</strong> {selectedVendor.email} | {selectedVendor.phone}\n                          </p>\n                          <p className=\"text-xs text-gray-600\">\n                            <strong>Address:</strong> {selectedVendor.address}\n                          </p>\n                        </div>\n                      </div>\n                    </div>\n                  )}\n                </div>\n\n                <div className=\"space-y-2\">\n                  <label className=\"block text-sm font-medium text-gray-700\">\n                    Operation Type(s) *\n                  </label>\n                  <div className=\"relative p-3 border border-gray-300 rounded-xl\">\n                    <FiTool className=\"absolute left-3 top-3.5 text-gray-400\" size={16} />\n                    <div className=\"pl-6 grid grid-cols-1 sm:grid-cols-2 gap-2\">\n                      {operations.map((op) => {\n                        const checked = formData.operations.includes(op.value);\n                        return (\n                          <label key={op.value} className=\"inline-flex items-center space-x-2\">\n                            <input\n                              type=\"checkbox\"\n                              checked={checked}\n                              onChange={(e) => {\n                                const next = e.target.checked\n                                  ? [...formData.operations, op.value]\n                                  : formData.operations.filter(v => v !== op.value);\n                                setFormData(prev => ({ ...prev, operations: next }));\n                              }}\n                              className=\"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded\"\n                            />\n                            <span className=\"text-sm text-gray-800\">{op.label}</span>\n                          </label>\n                        );\n                      })}\n                    </div>\n                  </div>\n                  {formData.operations.length > 0 && (\n                    <div className=\"mt-2 p-3 bg-green-50 rounded-lg border border-green-200\">\n                      <p className=\"text-sm text-green-800\">\n                        <FiCheck className=\"inline mr-2\" size={14} />\n                        Selected: {formData.operations.map(v => operations.find(o => o.value === v)?.label || v).join(', ')}\n                      </p>\n                    </div>\n                  )}\n                </div>\n\n                <div className=\"space-y-2\">\n                  <label className=\"block text-sm font-medium text-gray-700\">\n                    Delivery Date\n                  </label>\n                  <div className=\"relative\">\n                    <input\n                      type=\"date\"\n                      name=\"deliveryDate\"\n                      value={formData.deliveryDate}\n                      onChange={handleInputChange}\n                      className=\"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200\"\n                    />\n                    <FiCalendar className=\"absolute left-3 top-3.5 text-gray-400\" size={16} />\n                  </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <label className=\"block text-sm font-medium text-gray-700\">Invoice Date</label>\n                  <div className=\"relative\">\n                    <input \n                      type=\"date\" \n                      name=\"invoiceDate\" \n                      value={formData.invoiceDate} \n                      onChange={handleInputChange} \n                      className=\"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200\" \n                    />\n                    <FiCalendar className=\"absolute left-3 top-3.5 text-gray-400\" size={16} />\n                  </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <label className=\"block text-sm font-medium text-gray-700\">Due Date</label>\n                  <div className=\"relative\">\n                    <input \n                      type=\"date\" \n                      name=\"dueDate\" \n                      value={formData.dueDate} \n                      onChange={handleInputChange} \n                      className=\"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200\" \n                    />\n                    <FiCalendar className=\"absolute left-3 top-3.5 text-gray-400\" size={16} />\n                  </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <label className=\"block text-sm font-medium text-gray-700\">State of Supply</label>\n                  <div className=\"relative\">\n                    <input \n                      name=\"stateOfSupply\" \n                      value={formData.stateOfSupply} \n                      onChange={handleInputChange} \n                      placeholder=\"Enter state name\" \n                      className=\"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200\" \n                    />\n                    <FiMapPin className=\"absolute left-3 top-3.5 text-gray-400\" size={16} />\n                  </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <label className=\"block text-sm font-medium text-gray-700\">\n                    Priority Level\n                  </label>\n                  <div className=\"relative\">\n                    <select\n                      name=\"priority\"\n                      value={formData.priority}\n                      onChange={handleInputChange}\n                      className=\"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200 appearance-none bg-white\"\n                    >\n                      <option value=\"low\">Low Priority</option>\n                      <option value=\"medium\">Medium Priority</option>\n                      <option value=\"high\">High Priority</option>\n                      <option value=\"urgent\">Urgent</option>\n                    </select>\n                    <FiAlertCircle className=\"absolute left-3 top-3.5 text-gray-400\" size={16} />\n                  </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <label className=\"block text-sm font-medium text-gray-700\">\n                    Payment Terms (Days)\n                  </label>\n                  <div className=\"relative\">\n                    <select\n                      name=\"paymentTerms\"\n                      value={formData.paymentTerms}\n                      onChange={handleInputChange}\n                      className=\"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200 appearance-none bg-white\"\n                    >\n                      <option value=\"0\">Advance Payment</option>\n                      <option value=\"15\">15 Days</option>\n                      <option value=\"30\">30 Days</option>\n                      <option value=\"45\">45 Days</option>\n                      <option value=\"60\">60 Days</option>\n                      <option value=\"90\">90 Days</option>\n                    </select>\n                    <FiDollarSign className=\"absolute left-3 top-3.5 text-gray-400\" size={16} />\n                  </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <label className=\"block text-sm font-medium text-gray-700\">\n                    Expected Delivery (Days)\n                  </label>\n                  <div className=\"relative\">\n                    <input\n                      type=\"number\"\n                      name=\"expectedDeliveryDays\"\n                      value={formData.expectedDeliveryDays}\n                      onChange={handleInputChange}\n                      min=\"1\"\n                      placeholder=\"Enter delivery days\"\n                      className=\"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200\"\n                    />\n                    <FiClock className=\"absolute left-3 top-3.5 text-gray-400\" size={16} />\n                  </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <label className=\"block text-sm font-medium text-gray-700\">\n                    Currency\n                  </label>\n                  <div className=\"relative\">\n                    <select\n                      name=\"currency\"\n                      value={formData.currency}\n                      onChange={handleInputChange}\n                      className=\"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200 appearance-none bg-white\"\n                    >\n                      <option value=\"INR\">INR ()</option>\n                      <option value=\"USD\">USD ($)</option>\n                      <option value=\"EUR\">EUR ()</option>\n                    </select>\n                    <FiDollarSign className=\"absolute left-3 top-3.5 text-gray-400\" size={16} />\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"mt-6 space-y-2\">\n                <label className=\"block text-sm font-medium text-gray-700\">\n                  Work Description\n                </label>\n                <div className=\"relative\">\n                  <textarea\n                    name=\"description\"\n                    value={formData.description}\n                    onChange={handleInputChange}\n                    rows={4}\n                    className=\"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200 resize-none\"\n                    placeholder=\"Describe the work to be performed, specifications, and requirements...\"\n                  />\n                  <FiFileText className=\"absolute left-3 top-3.5 text-gray-400\" size={16} />\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* Items Section */}\n          <div className=\"bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden\">\n            <div className=\"bg-gradient-to-r from-purple-50 to-pink-50 px-6 py-4 border-b border-gray-100\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center space-x-3\">\n                  <div className=\"w-8 h-8 bg-gradient-to-br from-purple-500 to-pink-600 rounded-lg flex items-center justify-center\">\n                    <FiPackage className=\"text-white\" size={16} />\n                  </div>\n                  <h2 className=\"text-lg font-semibold text-gray-900\">Items & Services</h2>\n                  <span className=\"bg-purple-100 text-purple-800 text-xs font-medium px-2.5 py-0.5 rounded-full\">\n                    {formData.items.length} Item{formData.items.length !== 1 ? 's' : ''}\n                  </span>\n                </div>\n                <button\n                  type=\"button\"\n                  onClick={addItem}\n                  className=\"inline-flex items-center px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-600 text-white font-medium rounded-xl hover:from-purple-600 hover:to-pink-700 transition-all duration-200 shadow-sm hover:shadow-md\"\n                >\n                  <FiPlus className=\"mr-2\" size={16} />\n                  Add Item\n                </button>\n              </div>\n            </div>\n            <div className=\"p-6\">\n\n          <div className=\"space-y-4\">\n            {formData.items.map((item, index) => (\n              <div key={item.id} className=\"p-4 border border-gray-200 rounded-lg\">\n                <div className=\"grid grid-cols-1 md:grid-cols-8 gap-4\">\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                      Select Item\n                    </label>\n                    <select\n                      value={item.itemId || ''}\n                      onChange={(e) => handleSelectMasterItem(index, e.target.value)}\n                      className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent\"\n                    >\n                      <option value=\"\">-- Choose --</option>\n                      {masterItems.map(mi => (\n                        <option key={mi.id} value={mi.id}>{mi.name}</option>\n                      ))}\n                    </select>\n                  </div>\n                  <div className=\"md:col-span-2\">\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                      Description *\n                    </label>\n                    <input\n                      type=\"text\"\n                      value={item.description}\n                      onChange={(e) => handleItemChange(index, 'description', e.target.value)}\n                      placeholder=\"Item description\"\n                      className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent\"\n                      required\n                    />\n                  </div>\n                  \n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                      Quantity *\n                    </label>\n                    <input\n                      type=\"number\"\n                      min=\"1\"\n                      value={item.quantity}\n                      onChange={(e) => handleItemChange(index, 'quantity', e.target.value)}\n                      className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent\"\n                      required\n                    />\n                  </div>\n\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                      Unit\n                    </label>\n                    <select\n                      value={item.unit}\n                      onChange={(e) => handleItemChange(index, 'unit', e.target.value)}\n                      className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent\"\n                    >\n                      <option value=\"pcs\">Pieces</option>\n                      <option value=\"kg\">Kilograms</option>\n                      <option value=\"m\">Meters</option>\n                      <option value=\"hrs\">Hours</option>\n                      <option value=\"sets\">Sets</option>\n                      <option value=\"lots\">Lots</option>\n                    </select>\n                  </div>\n                  \n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                      Unit Price *\n                    </label>\n                    <input\n                      type=\"number\"\n                      step=\"0.01\"\n                      min=\"0\"\n                      value={item.unitPrice}\n                      onChange={(e) => handleItemChange(index, 'unitPrice', e.target.value)}\n                      className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent\"\n                      required\n                    />\n                  </div>\n                  \n                  <div className=\"flex items-end\">\n                    <div className=\"flex-1\">\n                      <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                        Amount\n                      </label>\n                      <input\n                        type=\"text\"\n                        value={`${item.amount}`}\n                        readOnly\n                        className=\"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50\"\n                      />\n                    </div>\n                    {formData.items.length > 1 && (\n                      <button\n                        type=\"button\"\n                        onClick={() => removeItem(index)}\n                        className=\"ml-2 p-2 text-red-600 hover:text-red-800\"\n                        title=\"Remove Item\"\n                      >\n                        <FiTrash2 size={16} />\n                      </button>\n                    )}\n                  </div>\n                </div>\n\n                {/* Additional item fields */}\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4\">\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                      Item Specifications\n                    </label>\n                    <textarea\n                      value={item.specifications}\n                      onChange={(e) => handleItemChange(index, 'specifications', e.target.value)}\n                      placeholder=\"Technical specifications for this item...\"\n                      rows={2}\n                      className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent\"\n                    />\n                  </div>\n\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                      Item Delivery Date\n                    </label>\n                    <input\n                      type=\"date\"\n                      value={item.deliveryDate}\n                      onChange={(e) => handleItemChange(index, 'deliveryDate', e.target.value)}\n                      className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent\"\n                    />\n                  </div>\n                </div>\n              </div>\n            ))}\n          </div>\n\n          {/* Pricing Summary */}\n          <div className=\"mt-6 bg-gray-50 p-4 rounded-lg\">\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Discount Amount\n                </label>\n                <input\n                  type=\"number\"\n                  name=\"discountAmount\"\n                  value={formData.discountAmount}\n                  onChange={handleInputChange}\n                  min=\"0\"\n                  step=\"0.01\"\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent\"\n                  placeholder=\"0.00\"\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">Payment Type</label>\n                <select value={formData.paymentType} onChange={(e)=>setFormData(prev=>({...prev,paymentType:e.target.value}))} className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent\">\n                  <option>Cash</option>\n                  <option>Online</option>\n                  <option>Credit</option>\n                </select>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Tax Rate (%)\n                </label>\n                <select\n                  name=\"taxRate\"\n                  value={formData.taxRate}\n                  onChange={handleInputChange}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent\"\n                >\n                  <option value=\"0\">No Tax (0%)</option>\n                  <option value=\"5\">GST 5%</option>\n                  <option value=\"12\">GST 12%</option>\n                  <option value=\"18\">GST 18%</option>\n                  <option value=\"28\">GST 28%</option>\n                </select>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">Round Off</label>\n                <div className=\"flex items-center gap-3\">\n                  <input type=\"checkbox\" checked={formData.roundOffEnabled} onChange={(e) => setFormData(prev => ({ ...prev, roundOffEnabled: e.target.checked }))} className=\"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded\" />\n                  <input type=\"number\" step=\"0.01\" value={formData.roundOffValue} onChange={(e) => setFormData(prev => ({ ...prev, roundOffValue: e.target.value }))} className=\"w-28 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-right\" />\n                </div>\n              </div>\n\n              <div className=\"flex items-end\">\n                <div className=\"w-full\">\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Approval Required\n                  </label>\n                  <div className=\"flex items-center\">\n                    <input\n                      type=\"checkbox\"\n                      name=\"approvalRequired\"\n                      checked={formData.approvalRequired}\n                      onChange={(e) => setFormData(prev => ({ ...prev, approvalRequired: e.target.checked }))}\n                      className=\"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded\"\n                    />\n                    <label className=\"ml-2 text-sm text-gray-700\">\n                      Requires management approval\n                    </label>\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            {/* Calculation Summary */}\n            <div className=\"mt-4 pt-4 border-t border-gray-200\">\n              <div className=\"space-y-2\">\n                <div className=\"flex justify-between text-sm\">\n                  <span className=\"text-gray-600\">Subtotal:</span>\n                  <span className=\"font-medium\">{parseFloat(formData.totalAmount || 0).toLocaleString()}</span>\n                </div>\n                {parseFloat(formData.discountAmount) > 0 && (\n                  <div className=\"flex justify-between text-sm\">\n                    <span className=\"text-gray-600\">Discount:</span>\n                    <span className=\"font-medium text-red-600\">-{parseFloat(formData.discountAmount || 0).toLocaleString()}</span>\n                  </div>\n                )}\n                {parseFloat(formData.taxAmount) > 0 && (\n                  <div className=\"flex justify-between text-sm\">\n                    <span className=\"text-gray-600\">Tax ({formData.taxRate}%):</span>\n                    <span className=\"font-medium\">{parseFloat(formData.taxAmount || 0).toLocaleString()}</span>\n                  </div>\n                )}\n                {formData.roundOffEnabled && (\n                  <div className=\"flex justify-between text-sm\">\n                    <span className=\"text-gray-600\">Round Off:</span>\n                    <span className=\"font-medium\">{parseFloat(formData.roundOffValue || 0).toLocaleString()}</span>\n                  </div>\n                )}\n                <div className=\"flex justify-between text-lg font-bold border-t border-gray-300 pt-2\">\n                  <span className=\"text-gray-900\">Final Amount:</span>\n                  <span className=\"text-indigo-600\">{parseFloat(formData.finalAmount || 0).toLocaleString()}</span>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n        </div>\n\n        {/* Additional Details */}\n        <div className=\"bg-white p-6 rounded-lg shadow-sm border border-gray-200\">\n          <h2 className=\"text-lg font-semibold text-gray-900 mb-4\">Additional Details</h2>\n          \n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Technical Specifications\n              </label>\n              <textarea\n                name=\"specifications\"\n                value={formData.specifications}\n                onChange={handleInputChange}\n                rows={4}\n                className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent\"\n                placeholder=\"Enter technical specifications, tolerances, materials, etc...\"\n              />\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Quality Requirements\n              </label>\n              <textarea\n                name=\"qualityRequirements\"\n                value={formData.qualityRequirements}\n                onChange={handleInputChange}\n                rows={4}\n                className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent\"\n                placeholder=\"Quality standards, inspection requirements, certifications needed...\"\n              />\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Shipping Address\n              </label>\n              <textarea\n                name=\"shippingAddress\"\n                value={formData.shippingAddress}\n                onChange={handleInputChange}\n                rows={3}\n                className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent\"\n                placeholder=\"Complete shipping address with contact details...\"\n              />\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Warranty Period\n              </label>\n              <input\n                type=\"text\"\n                name=\"warrantPeriod\"\n                value={formData.warrantPeriod}\n                onChange={handleInputChange}\n                className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent\"\n                placeholder=\"e.g., 12 months, 2 years, etc.\"\n              />\n            </div>\n\n            <div className=\"md:col-span-2\">\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Terms & Conditions\n              </label>\n              <textarea\n                name=\"terms\"\n                value={formData.terms}\n                onChange={handleInputChange}\n                rows={3}\n                className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent\"\n                placeholder=\"Payment terms, delivery conditions, penalties, special conditions...\"\n              />\n            </div>\n          </div>\n        </div>\n\n        {/* WhatsApp features removed */}\n\n        {/* Actions */}\n        <div className=\"flex justify-end space-x-4\">\n          <button\n            type=\"button\"\n            onClick={() => navigate('/admin/purchase-orders')}\n            className=\"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors\"\n          >\n            Cancel\n          </button>\n          \n          <button\n            type=\"submit\"\n            disabled={loading}\n            className=\"inline-flex items-center px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors disabled:opacity-50\"\n          >\n            {loading ? (\n              <div className=\"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-2\"></div>\n            ) : (\n              <FiSave className=\"mr-2\" size={16} />\n            )}\n            {isEditMode ? 'Update PO' : 'Create PO'}\n          </button>\n        </div>\n      </form>\n\n      {/* Preview Modal */}\n      {showPreview && (\n        <POPreview\n          formData={formData}\n          selectedVendor={selectedVendor}\n          onClose={() => setShowPreview(false)}\n        />\n      )}\n\n      {/* WhatsApp modal removed */}\n    </div>\n    </div>\n  );\n}\n\n// PO Preview Component - Updated format\n// PO Preview Component - Professional Industrial Layout\nfunction POPreview({ formData, selectedVendor, onClose }) {\n  const generatePDF = () => {\n    window.print();\n  };\n\n  // Format currency with Indian numbering system\n  const formatCurrency = (amount) => {\n    return new Intl.NumberFormat('en-IN', {\n      maximumFractionDigits: 2,\n      minimumFractionDigits: 2\n    }).format(amount);\n  };\n\n  // Convert number to words for amount in words\n  const numberToWords = (num) => {\n    const ones = ['', 'One', 'Two', 'Three', 'Four', 'Five', 'Six', 'Seven', 'Eight', 'Nine'];\n    const teens = ['Ten', 'Eleven', 'Twelve', 'Thirteen', 'Fourteen', 'Fifteen', 'Sixteen', 'Seventeen', 'Eighteen', 'Nineteen'];\n    const tens = ['', 'Ten', 'Twenty', 'Thirty', 'Forty', 'Fifty', 'Sixty', 'Seventy', 'Eighty', 'Ninety'];\n    \n    if (num === 0) return 'Zero';\n    \n    let words = '';\n    \n    // Handle crores\n    if (Math.floor(num / 10000000) > 0) {\n      words += numberToWords(Math.floor(num / 10000000)) + ' Crore ';\n      num %= 10000000;\n    }\n    \n    // Handle lakhs\n    if (Math.floor(num / 100000) > 0) {\n      words += numberToWords(Math.floor(num / 100000)) + ' Lakh ';\n      num %= 100000;\n    }\n    \n    // Handle thousands\n    if (Math.floor(num / 1000) > 0) {\n      words += numberToWords(Math.floor(num / 1000)) + ' Thousand ';\n      num %= 1000;\n    }\n    \n    // Handle hundreds\n    if (Math.floor(num / 100) > 0) {\n      words += numberToWords(Math.floor(num / 100)) + ' Hundred ';\n      num %= 100;\n    }\n    \n    // Handle tens and ones\n    if (num > 0) {\n      if (words !== '') words += 'and ';\n      \n      if (num < 10) {\n        words += ones[num];\n      } else if (num < 20) {\n        words += teens[num - 10];\n      } else {\n        words += tens[Math.floor(num / 10)];\n        if (num % 10 > 0) {\n          words += ' ' + ones[num % 10];\n        }\n      }\n    }\n    \n    return words.trim();\n  };\n\n  const amountInWords = numberToWords(Math.floor(parseFloat(formData.finalAmount || 0))) + \n    ' Rupees' + \n    (parseFloat(formData.finalAmount || 0) % 1 !== 0 ? \n      ` and ${Math.round((parseFloat(formData.finalAmount || 0) % 1) * 100)} Paise` : \n      '');\n\n  return (\n    <div className=\"print-overlay fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4\">\n      <div className=\"bg-white rounded-lg max-w-5xl w-full max-h-[90vh] overflow-y-auto\">\n        <style>\n          {`\n            @media print {\n              @page { \n                size: A4 portrait; \n                margin: 10mm 15mm 15mm 15mm;\n              }\n              body { \n                -webkit-print-color-adjust: exact; \n                print-color-adjust: exact; \n                background: white !important;\n              }\n              * { \n                background: transparent !important; \n                box-shadow: none !important; \n                text-shadow: none !important;\n              }\n              /* Hide everything except the printable overlay */\n              body * { visibility: hidden !important; }\n              .print-overlay, .print-overlay * { visibility: visible !important; }\n              /* Normalize overlay into normal flow for print */\n              .print-overlay { \n                position: static !important; \n                inset: auto !important; \n                padding: 0 !important; \n                background: transparent !important; \n                overflow: visible !important;\n              }\n              html, body { \n                overflow: visible !important; \n                height: auto !important;\n                width: 210mm !important;\n                margin: 0 !important;\n                padding: 0 !important;\n              }\n              #po-preview { \n                width: 100% !important; \n                margin: 0 !important;\n                padding: 0 !important;\n              }\n              .no-print { display: none !important; }\n              .print-a4 { \n                box-shadow: none !important; \n                margin: 0 !important;\n                padding: 0 !important;\n              }\n              .page-break { page-break-after: always; }\n            }\n            \n            .print-a4 { \n              max-width: 210mm; \n              margin: 18px auto; \n              background: white; \n              font-family: 'Helvetica', 'Arial', sans-serif; \n              line-height: 1.35; \n              color: #000;\n              font-size: 12px;\n            }\n            \n            .company-header {\n              border-bottom: 2px solid #2c5282;\n              padding-bottom: 10px;\n              margin-bottom: 15px;\n            }\n            \n            .po-title { \n              background: #2c5282; \n              color: white; \n              padding: 8px 15px;\n              font-weight: bold;\n              font-size: 16px;\n              text-align: center;\n              border-radius: 4px;\n              margin: 10px 0;\n            }\n            \n            .section-title { \n              font-size: 13px; \n              font-weight: bold; \n              padding-bottom: 4px; \n              margin-bottom: 8px; \n              border-bottom: 1px solid #ccc;\n              text-transform: uppercase;\n              color: #2c5282;\n            }\n            \n            .table { \n              width: 100%; \n              border-collapse: collapse; \n              margin: 10px 0;\n            }\n            \n            .table th { \n              background: #f0f4f8; \n              border: 1px solid #ccc; \n              padding: 6px 8px; \n              font-size: 11px; \n              font-weight: bold;\n              text-align: left;\n            }\n            \n            .table td { \n              border: 1px solid #ccc; \n              padding: 6px 8px; \n              font-size: 11px;\n              vertical-align: top;\n            }\n            \n            .table-footer td {\n              font-weight: bold;\n              background: #f8f9fa;\n            }\n            \n            .signature-area {\n              margin-top: 40px;\n              border-top: 1px dashed #ccc;\n              padding-top: 15px;\n            }\n            \n            .terms-box {\n              border: 1px solid #ccc;\n              padding: 10px;\n              margin: 10px 0;\n              background: #f9f9f9;\n              font-size: 11px;\n            }\n            \n            .amount-in-words {\n              padding: 8px;\n              background: #f0f4f8;\n              border: 1px solid #ccc;\n              margin: 10px 0;\n              font-style: italic;\n            }\n            \n            .footer {\n              margin-top: 30px;\n              font-size: 10px;\n              text-align: center;\n              color: #666;\n            }\n          `}\n        </style>\n\n        <div className=\"p-4 border-b border-gray-200 flex justify-between items-center no-print\">\n          <h2 className=\"text-xl font-semibold text-gray-900\">Print Purchase Order</h2>\n          <div className=\"flex space-x-2\">\n            <button onClick={generatePDF} className=\"inline-flex items-center px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700\">\n              <FiDownload className=\"mr-2\" size={16} /> Print / Save PDF\n            </button>\n            <button onClick={onClose} className=\"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50\">\n              Close\n            </button>\n          </div>\n        </div>\n\n        <div className=\"print-a4 p-10\" id=\"po-preview\">\n          {/* Company Header */}\n          <div className=\"company-header\">\n            <div className=\"flex justify-between items-start\">\n              <div>\n                <div className=\"text-xl font-bold\">INDUSTRIAL MACHINING SOLUTIONS</div>\n                <div className=\"text-sm\">Registered Office: 123 Industrial Estate, Phase II</div>\n                <div className=\"text-sm\">Mumbai - 400 001, Maharashtra, India</div>\n                <div className=\"text-sm\">GSTIN: 27ABCDE1234F1Z5  PAN: ABCDE1234F</div>\n                <div className=\"text-sm\">Phone: +91-22-12345678  Email: operations@industrial-machining.com</div>\n              </div>\n              <div className=\"text-right\">\n                <div className=\"text-sm\">CIN: U74999MH2020PTC123456</div>\n                <div className=\"text-sm\">Website: www.industrial-machining.com</div>\n              </div>\n            </div>\n          </div>\n\n          {/* PO Title */}\n          <div className=\"po-title\">\n            PURCHASE ORDER\n          </div>\n\n          {/* PO Details */}\n          <div className=\"grid grid-cols-2 gap-8 mb-6\">\n            <div>\n              <table className=\"details-table\">\n                <tbody>\n                  <tr>\n                    <td className=\"font-bold pr-4\">PO Number:</td>\n                    <td>{formData.poNumber || 'PO' + new Date().getTime().toString().slice(-6)}</td>\n                  </tr>\n                  <tr>\n                    <td className=\"font-bold\">PO Date:</td>\n                    <td>{new Date().toLocaleDateString('en-IN', { day: '2-digit', month: 'short', year: 'numeric' })}</td>\n                  </tr>\n                  <tr>\n                    <td className=\"font-bold\">Reference:</td>\n                    <td>REF/{new Date().getFullYear()}/{Math.floor(1000 + Math.random() * 9000)}</td>\n                  </tr>\n                </tbody>\n              </table>\n            </div>\n            <div>\n              <table className=\"details-table\">\n                <tbody>\n                  <tr>\n                    <td className=\"font-bold pr-4\">Operation Type:</td>\n                    <td>\n                      {formData.operations && formData.operations.length > 0 \n                        ? formData.operations.map(v => (operations.find(o => o.value === v)?.label) || v).join(', ')\n                        : 'Not Specified'\n                      }\n                    </td>\n                  </tr>\n                  <tr>\n                    <td className=\"font-bold\">Delivery By:</td>\n                    <td>\n                      {formData.deliveryDate \n                        ? new Date(formData.deliveryDate).toLocaleDateString('en-IN', { day: '2-digit', month: 'short', year: 'numeric' })\n                        : 'TBD'\n                      }\n                    </td>\n                  </tr>\n                  <tr>\n                    <td className=\"font-bold\">Payment Terms:</td>\n                    <td>{formData.paymentTerms} Days</td>\n                  </tr>\n                </tbody>\n              </table>\n            </div>\n          </div>\n\n          {/* Vendor Details */}\n          <div className=\"mb-6\">\n            <div className=\"section-title\">VENDOR DETAILS</div>\n            {selectedVendor ? (\n              <div className=\"grid grid-cols-2 gap-8\">\n                <div>\n                  <div className=\"font-bold\">{selectedVendor.name}</div>\n                  <div className=\"whitespace-pre-line\">{selectedVendor.address || 'Address not specified'}</div>\n                  <div>GSTIN: {selectedVendor.gstin || 'Not provided'}</div>\n                </div>\n                <div>\n                  <div><span className=\"font-bold\">Contact:</span> {selectedVendor.contactPerson || 'Not specified'}</div>\n                  <div><span className=\"font-bold\">Phone:</span> {selectedVendor.phone || 'Not provided'}</div>\n                  <div><span className=\"font-bold\">Email:</span> {selectedVendor.email || 'Not provided'}</div>\n                </div>\n              </div>\n            ) : (\n              <div>Vendor details not available</div>\n            )}\n          </div>\n\n          {/* Items Table */}\n          <div className=\"mb-6\">\n            <div className=\"section-title\">ITEMS / SERVICES</div>\n            <table className=\"table\">\n              <thead>\n                <tr>\n                  <th style={{width: '5%'}}>Sr No.</th>\n                  <th style={{width: '35%'}}>Description</th>\n                  <th style={{width: '10%'}}>Operation</th>\n                  <th style={{width: '8%'}}>HSN/SAC</th>\n                  <th style={{width: '8%'}}>Qty</th>\n                  <th style={{width: '8%'}}>Unit</th>\n                  <th style={{width: '12%'}}>Rate ()</th>\n                  <th style={{width: '14%'}}>Amount ()</th>\n                </tr>\n              </thead>\n              <tbody>\n                {formData.items.map((item, index) => (\n                  <tr key={index}>\n                    <td className=\"text-center\">{index + 1}</td>\n                    <td>\n                      <div className=\"font-medium\">{item.description}</div>\n                      {item.specifications && (\n                        <div className=\"text-xs mt-1 text-gray-600\">{item.specifications}</div>\n                      )}\n                    </td>\n                    <td>{item.operation ? (operations.find(o => o.value === item.operation)?.label || item.operation) : '-'}</td>\n                    <td className=\"text-center\">9988</td>\n                    <td className=\"text-center\">{item.quantity}</td>\n                    <td className=\"text-center\">{item.unit}</td>\n                    <td className=\"text-right\">{formatCurrency(parseFloat(item.unitPrice || 0))}</td>\n                    <td className=\"text-right\">{formatCurrency(parseFloat(item.amount || 0))}</td>\n                  </tr>\n                ))}\n              </tbody>\n              <tfoot className=\"table-footer\">\n                <tr>\n                  <td colSpan=\"6\" className=\"text-right font-bold\">Subtotal:</td>\n                  <td colSpan=\"2\" className=\"text-right\">{formatCurrency(parseFloat(formData.totalAmount || 0))}</td>\n                </tr>\n                {parseFloat(formData.discountAmount) > 0 && (\n                  <tr>\n                    <td colSpan=\"6\" className=\"text-right font-bold\">Discount:</td>\n                    <td colSpan=\"2\" className=\"text-right\">-{formatCurrency(parseFloat(formData.discountAmount || 0))}</td>\n                  </tr>\n                )}\n                {parseFloat(formData.taxAmount) > 0 && (\n                  <tr>\n                    <td colSpan=\"6\" className=\"text-right font-bold\">GST ({formData.taxRate}%):</td>\n                    <td colSpan=\"2\" className=\"text-right\">{formatCurrency(parseFloat(formData.taxAmount || 0))}</td>\n                  </tr>\n                )}\n                {formData.roundOffEnabled && (\n                  <tr>\n                    <td colSpan=\"6\" className=\"text-right font-bold\">Round Off:</td>\n                    <td colSpan=\"2\" className=\"text-right\">{formatCurrency(parseFloat(formData.roundOffValue || 0))}</td>\n                  </tr>\n                )}\n                <tr>\n                  <td colSpan=\"6\" className=\"text-right font-bold\">TOTAL ():</td>\n                  <td colSpan=\"2\" className=\"text-right font-bold\">{formatCurrency(parseFloat(formData.finalAmount || 0))}</td>\n                </tr>\n              </tfoot>\n            </table>\n          </div>\n\n          {/* Amount in Words */}\n          <div className=\"amount-in-words\">\n            <span className=\"font-bold\">Amount in Words: </span>\n            {amountInWords} Only\n          </div>\n\n          {/* Terms and Conditions */}\n          <div className=\"mb-6\">\n            <div className=\"section-title\">TERMS AND CONDITIONS</div>\n            <div className=\"terms-box\">\n              <ol className=\"list-decimal pl-5 space-y-1\">\n                <li>All materials must conform to the specifications and drawings provided.</li>\n                <li>Goods must be delivered by the specified date. Delays may result in penalties.</li>\n                <li>All goods must be properly packed to prevent damage during transit.</li>\n                <li>Invoice must quote our Purchase Order number and date.</li>\n                <li>Payment will be made within {formData.paymentTerms} days of receipt of satisfactory goods/services and proper invoice.</li>\n                <li>Goods found defective during inspection will be rejected and returned at vendor's cost.</li>\n                <li>The vendor must ensure all statutory compliances including GST are properly followed.</li>\n                <li>This order is subject to the jurisdiction of courts in Mumbai.</li>\n                {formData.terms && (\n                  <li>{formData.terms}</li>\n                )}\n              </ol>\n            </div>\n          </div>\n\n          {/* Work Description */}\n          {formData.description && (\n            <div className=\"mb-6\">\n              <div className=\"section-title\">SPECIAL INSTRUCTIONS / WORK DESCRIPTION</div>\n              <div className=\"p-3 border border-gray-300\">\n                {formData.description}\n              </div>\n            </div>\n          )}\n\n          {/* Signatures */}\n          <div className=\"signature-area\">\n            <div className=\"grid grid-cols-2 gap-8\">\n              <div>\n                <div className=\"font-bold mb-2\">For INDUSTRIAL MACHINING SOLUTIONS</div>\n                <div className=\"h-16 border-b border-gray-400\"></div>\n                <div className=\"text-sm mt-1\">Authorized Signatory</div>\n                <div className=\"text-sm\">Name: _________________________</div>\n                <div className=\"text-sm\">Designation: ____________________</div>\n              </div>\n              <div>\n                <div className=\"font-bold mb-2\">VENDOR ACCEPTANCE</div>\n                <div className=\"h-16 border-b border-gray-400\"></div>\n                <div className=\"text-sm mt-1\">Authorized Signatory</div>\n                <div className=\"text-sm\">Name: _________________________</div>\n                <div className=\"text-sm\">Designation: ____________________</div>\n                <div className=\"text-sm\">Date: __________________________</div>\n                <div className=\"text-sm\">Company Seal</div>\n              </div>\n            </div>\n          </div>\n\n          {/* Footer */}\n          <div className=\"footer\">\n            <div>This is a computer generated document and does not require a physical signature</div>\n            <div>Page 1 of 1</div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}","import { collection, addDoc, getDoc, getDocs, updateDoc, deleteDoc, doc, serverTimestamp, query, orderBy, where, writeBatch } from 'firebase/firestore';\r\nimport { getDownloadURL, ref, uploadBytes } from 'firebase/storage';\r\nimport { db } from '../firebase';\r\nimport { storage } from '../firebase';\r\n\r\nconst ITEMS_COLLECTION = 'items';\r\n\r\nexport function normalizeItemForSave(raw) {\r\n  const numeric = (v) => (v === '' || v === null || v === undefined ? null : Number(v));\r\n  return {\r\n    name: String(raw.name || '').trim(),\r\n    type: raw.type === 'service' ? 'service' : 'product',\r\n    hsn: String(raw.hsn || '').trim(),\r\n    code: String(raw.code || '').trim(),\r\n    unit: String(raw.unit || '').trim(),\r\n    category: String(raw.category || '').trim(),\r\n    imageUrl: String(raw.imageUrl || '').trim(),\r\n    pricing: {\r\n      salePrice: numeric(raw.pricing?.salePrice) ?? 0,\r\n      purchasePrice: numeric(raw.pricing?.purchasePrice) ?? 0,\r\n      discountType: ['percentage', 'flat'].includes(raw.pricing?.discountType) ? raw.pricing.discountType : 'percentage',\r\n      discountValue: numeric(raw.pricing?.discountValue) ?? 0,\r\n      taxRate: numeric(raw.pricing?.taxRate) ?? 0,\r\n      taxMode: ['with_tax', 'without_tax'].includes(raw.pricing?.taxMode) ? raw.pricing.taxMode : 'without_tax',\r\n    },\r\n    stock: {\r\n      track: Boolean(raw.stock?.track),\r\n      openingQty: numeric(raw.stock?.openingQty) ?? 0,\r\n      minQty: numeric(raw.stock?.minQty) ?? 0,\r\n      location: String(raw.stock?.location || '').trim(),\r\n    },\r\n    status: raw.status === 'inactive' ? 'inactive' : 'active',\r\n    notes: String(raw.notes || '').trim(),\r\n  };\r\n}\r\n\r\nexport function mapItemFromDoc(docSnap) {\r\n  const d = docSnap.data() || {};\r\n  return {\r\n    id: docSnap.id,\r\n    name: d.name || '',\r\n    type: d.type || 'product',\r\n    hsn: d.hsn || '',\r\n    code: d.code || '',\r\n    unit: d.unit || '',\r\n    category: d.category || '',\r\n    imageUrl: d.imageUrl || '',\r\n    pricing: {\r\n      salePrice: typeof d.pricing?.salePrice === 'number' ? d.pricing.salePrice : Number(d.pricing?.salePrice || 0),\r\n      purchasePrice: typeof d.pricing?.purchasePrice === 'number' ? d.pricing.purchasePrice : Number(d.pricing?.purchasePrice || 0),\r\n      discountType: d.pricing?.discountType || 'percentage',\r\n      discountValue: typeof d.pricing?.discountValue === 'number' ? d.pricing.discountValue : Number(d.pricing?.discountValue || 0),\r\n      taxRate: typeof d.pricing?.taxRate === 'number' ? d.pricing.taxRate : Number(d.pricing?.taxRate || 0),\r\n      taxMode: d.pricing?.taxMode || 'without_tax',\r\n    },\r\n    stock: {\r\n      track: Boolean(d.stock?.track),\r\n      openingQty: typeof d.stock?.openingQty === 'number' ? d.stock.openingQty : Number(d.stock?.openingQty || 0),\r\n      minQty: typeof d.stock?.minQty === 'number' ? d.stock.minQty : Number(d.stock?.minQty || 0),\r\n      location: d.stock?.location || '',\r\n    },\r\n    status: d.status || 'active',\r\n    notes: d.notes || '',\r\n    createdAt: d.createdAt,\r\n    updatedAt: d.updatedAt,\r\n  };\r\n}\r\n\r\nexport function validateItem(raw) {\r\n  const errors = {};\r\n  if (!raw.name || String(raw.name).trim().length < 2) errors.name = 'Item name is required';\r\n  if (!raw.unit) errors.unit = 'Unit is required';\r\n  if (raw.pricing && raw.pricing.salePrice < 0) errors.salePrice = 'Sale price must be >= 0';\r\n  if (raw.pricing && raw.pricing.purchasePrice < 0) errors.purchasePrice = 'Purchase price must be >= 0';\r\n  if (raw.pricing && raw.pricing.taxRate < 0) errors.taxRate = 'Tax rate must be >= 0';\r\n  return errors;\r\n}\r\n\r\nexport async function uploadItemImage(file, itemIdHint) {\r\n  const path = `items/${itemIdHint || 'tmp'}_${Date.now()}_${file.name}`;\r\n  const storageRef = ref(storage, path);\r\n  const snap = await uploadBytes(storageRef, file);\r\n  return getDownloadURL(snap.ref);\r\n}\r\n\r\nexport async function createItem(raw) {\r\n  const errors = validateItem(raw);\r\n  if (Object.keys(errors).length) {\r\n    const err = new Error('ITEM_VALIDATION_FAILED');\r\n    err.details = errors;\r\n    throw err;\r\n  }\r\n  const data = normalizeItemForSave(raw);\r\n  const now = serverTimestamp();\r\n  const ref = await addDoc(collection(db, ITEMS_COLLECTION), { ...data, createdAt: now, updatedAt: now });\r\n  return { id: ref.id, ...data };\r\n}\r\n\r\nexport async function updateItem(id, raw) {\r\n  const errors = validateItem(raw);\r\n  if (Object.keys(errors).length) {\r\n    const err = new Error('ITEM_VALIDATION_FAILED');\r\n    err.details = errors;\r\n    throw err;\r\n  }\r\n  const data = normalizeItemForSave(raw);\r\n  await updateDoc(doc(db, ITEMS_COLLECTION, id), { ...data, updatedAt: serverTimestamp() });\r\n}\r\n\r\nexport async function deleteItem(id) {\r\n  await deleteDoc(doc(db, ITEMS_COLLECTION, id));\r\n}\r\n\r\nexport async function getItemById(id) {\r\n  const snap = await getDoc(doc(db, ITEMS_COLLECTION, id));\r\n  if (!snap.exists()) return null;\r\n  return mapItemFromDoc(snap);\r\n}\r\n\r\nexport async function getItemsOrdered() {\r\n  const q = query(collection(db, ITEMS_COLLECTION), orderBy('createdAt', 'desc'));\r\n  const snapshot = await getDocs(q);\r\n  return snapshot.docs.map(mapItemFromDoc);\r\n}\r\n\r\nexport async function searchItems({ text, type, category, status }) {\r\n  // Basic fetch and in-memory filter to avoid complex composite indexes\r\n  const snapshot = await getDocs(collection(db, ITEMS_COLLECTION));\r\n  let items = snapshot.docs.map(mapItemFromDoc);\r\n  if (text) {\r\n    const t = text.toLowerCase();\r\n    items = items.filter((i) => (i.name || '').toLowerCase().includes(t) || (i.code || '').toLowerCase().includes(t) || (i.hsn || '').toLowerCase().includes(t));\r\n  }\r\n  if (type) items = items.filter((i) => i.type === type);\r\n  if (category) items = items.filter((i) => i.category === category);\r\n  if (status) items = items.filter((i) => i.status === status);\r\n  return items;\r\n}\r\n\r\nexport async function bulkDeleteItems(ids) {\r\n  const batch = writeBatch(db);\r\n  ids.forEach((id) => batch.delete(doc(db, ITEMS_COLLECTION, id)));\r\n  await batch.commit();\r\n}\r\n\r\n\r\n","import { collection, addDoc, getDocs, getDoc, updateDoc, deleteDoc, doc, serverTimestamp, query, orderBy, where, writeBatch } from 'firebase/firestore';\nimport { db } from '../firebase';\n\nconst PO_COLLECTION = 'purchaseOrders';\nconst ACTIVITY_COLLECTION = 'poActivity';\n\nexport function normalizePOForSave(raw) {\n    const items = Array.isArray(raw.items) ? raw.items : [];\n    // Normalize operations: accept either `operations` array or single `operation` string\n    const normalizedOperations = Array.isArray(raw.operations)\n        ? raw.operations.filter(Boolean)\n        : (raw.operation ? [String(raw.operation)] : []);\n\n    const safeItems = items.map((it) => {\n        const quantity = Number(it.quantity) || 0;\n        const unitPrice = Number(it.unitPrice ?? it.rate) || 0;\n        return {\n            description: String(it.description || '').trim(),\n            quantity,\n            unitPrice,\n            amount: Number(it.amount ?? (quantity * unitPrice)).toFixed ? Number((quantity * unitPrice).toFixed(2)) : (quantity * unitPrice),\n            unit: String(it.unit || 'pcs'),\n            specifications: String(it.specifications || ''),\n            deliveryDate: it.deliveryDate || '',\n            itemId: it.itemId || null,\n            // Per-item operation (optional)\n            operation: it.operation || null,\n        };\n    });\n\n    const subtotal = safeItems.reduce((sum, it) => sum + (Number(it.amount) || 0), 0);\n    const discountAmount = Number(raw.discountAmount || 0);\n    const afterDiscount = subtotal - discountAmount;\n    const taxRate = Number(raw.taxRate || 0);\n    const taxAmount = (afterDiscount * taxRate) / 100;\n    let finalAmount = afterDiscount + taxAmount;\n\n    // Handle optional round-off like Delivery Challan form\n    const roundOffEnabled = Boolean(raw.roundOffEnabled);\n    let roundOffValue = Number(raw.roundOffValue || 0);\n    if (roundOffEnabled) {\n        const rounded = Math.round(finalAmount);\n        roundOffValue = Number((rounded - finalAmount).toFixed(2));\n        finalAmount = rounded;\n    }\n\n    // Initialize per-operation status maps\n    const operationsStatus = normalizedOperations.reduce((acc, op) => {\n        acc[String(op)] = (raw.operationsStatus && raw.operationsStatus[op]) || 'pending';\n        return acc;\n    }, {});\n    const operationsMeta = normalizedOperations.reduce((acc, op) => {\n        const meta = (raw.operationsMeta && raw.operationsMeta[op]) || {};\n        acc[String(op)] = {\n            status: operationsStatus[String(op)] || 'pending',\n            notes: meta.notes || '',\n            updatedAt: meta.updatedAt || null,\n            updatedBy: meta.updatedBy || null,\n            startedAt: meta.startedAt || null,\n            completedAt: meta.completedAt || null,\n        };\n        return acc;\n    }, {});\n\n    return {\n        vendorId: String(raw.vendorId || '').trim(),\n        // Keep legacy single operation for backward compatibility (first operation if any)\n        operation: normalizedOperations[0] ? String(normalizedOperations[0]).trim() : '',\n        // New multi-operations field\n        operations: normalizedOperations,\n        // New per-operation status fields\n        operationsStatus,\n        operationsMeta,\n        description: String(raw.description || ''),\n        deliveryDate: raw.deliveryDate ? (raw.deliveryDate instanceof Date ? raw.deliveryDate : new Date(raw.deliveryDate)) : null,\n        priority: raw.priority || 'medium',\n        status: raw.status || 'pending',\n        paymentTerms: String(raw.paymentTerms ?? '30'),\n        shippingAddress: String(raw.shippingAddress || ''),\n        billingAddress: String(raw.billingAddress || ''),\n        currency: raw.currency || 'INR',\n        invoiceDate: raw.invoiceDate || null,\n        dueDate: raw.dueDate || null,\n        stateOfSupply: String(raw.stateOfSupply || ''),\n        taxRate,\n        discountAmount,\n        items: safeItems,\n        totalAmount: Number(subtotal.toFixed(2)),\n        taxAmount: Number(taxAmount.toFixed(2)),\n        finalAmount: Number(finalAmount.toFixed(2)),\n        roundOffEnabled,\n        roundOffValue,\n        specifications: String(raw.specifications || ''),\n        qualityRequirements: String(raw.qualityRequirements || ''),\n        expectedDeliveryDays: Number(raw.expectedDeliveryDays || 0) || 0,\n        warrantPeriod: String(raw.warrantPeriod || ''),\n        terms: String(raw.terms || ''),\n        poNumber: raw.poNumber || null,\n    };\n}\n\nexport function mapPOFromDoc(docSnap) {\n    const d = docSnap.data() || {};\n    return { id: docSnap.id, ...d };\n}\n\nasync function logActivity(poId, action, details) {\n\ttry {\n\t\tawait addDoc(collection(db, ACTIVITY_COLLECTION), { poId, action, details: details || {}, timestamp: serverTimestamp() });\n\t} catch (_) {}\n}\n\nexport async function getPOsOrdered() {\n\tconst q = query(collection(db, PO_COLLECTION), orderBy('createdAt', 'desc'));\n\tconst snap = await getDocs(q);\n\treturn snap.docs.map(mapPOFromDoc);\n}\n\nexport async function getPOById(id) {\n\tconst snap = await getDoc(doc(db, PO_COLLECTION, id));\n\tif (!snap.exists()) return null;\n\treturn mapPOFromDoc(snap);\n}\n\nexport async function createPO(raw) {\n\tconst data = normalizePOForSave(raw);\n\tconst now = serverTimestamp();\n\tconst ref = await addDoc(collection(db, PO_COLLECTION), { ...data, createdAt: now, updatedAt: now });\n\tawait logActivity(ref.id, 'create', { vendorId: data.vendorId, amount: data.finalAmount });\n\treturn { id: ref.id, ...data };\n}\n\nexport async function updatePO(id, raw) {\n\tconst data = normalizePOForSave(raw);\n\tawait updateDoc(doc(db, PO_COLLECTION, id), { ...data, updatedAt: serverTimestamp() });\n\tawait logActivity(id, 'update', { status: data.status });\n}\n\nexport async function deletePO(id) {\n\tawait deleteDoc(doc(db, PO_COLLECTION, id));\n\tawait logActivity(id, 'delete');\n}\n\nexport async function bulkUpdatePOs(ids, fields) {\n\tconst batch = writeBatch(db);\n\tids.forEach((id) => batch.update(doc(db, PO_COLLECTION, id), { ...fields, updatedAt: serverTimestamp() }));\n\tawait batch.commit();\n\tfor (const id of ids) logActivity(id, 'bulk_update', { fields });\n}\n\nexport async function bulkDeletePOs(ids) {\n\tconst batch = writeBatch(db);\n\tids.forEach((id) => batch.delete(doc(db, PO_COLLECTION, id)));\n\tawait batch.commit();\n\tfor (const id of ids) logActivity(id, 'bulk_delete');\n}\n"],"names":["VENDORS_COLLECTION","VENDOR_ACTIVITY_COLLECTION","normalizeVendorForSave","raw","_numeric","_raw$bankDetails","_raw$bankDetails2","_raw$bankDetails3","_raw$bankDetails4","_numeric2","numeric","v","undefined","Number","name","String","trim","email","toLowerCase","phone","address","city","state","zipCode","country","website","contactPerson","contactPhone","contactEmail","category","rating","gstNumber","panNumber","bankDetails","accountNumber","ifscCode","bankName","accountHolderName","services","Array","isArray","filter","Boolean","status","notes","establishedYear","employeeCount","annualRevenue","creditLimit","preferredPaymentTerms","taxId","mapVendorFromDoc","docSnap","_data$bankDetails","_data$bankDetails2","_data$bankDetails3","_data$bankDetails4","_data$establishedYear","_data$employeeCount","_data$annualRevenue","_data$creditLimit","_data$preferredPaymen","data","id","createdAt","updatedAt","async","getVendorsOrdered","q","query","collection","db","orderBy","getDocs","docs","map","getAllVendors","getVendorById","snap","getDoc","doc","exists","findDuplicateVendor","excludeId","dupCandidates","emailQ","where","forEach","d","push","phoneQ","type","logVendorActivity","vendorId","action","details","addDoc","timestamp","serverTimestamp","_","createVendor","duplicate","Error","now","ref","updateVendor","updateDoc","deleteVendor","deleteDoc","bulkUpdateVendors","ids","fields","batch","writeBatch","update","commit","bulkDeleteVendors","delete","queryPOsByVendorId","queryJobsByVendorId","computeVendorStats","vendors","stats","vendor","pos","jobs","Promise","all","totalPOs","length","totalJobs","totalSpend","reduce","sum","po","parseFloat","totalAmount","completedJobs","job","pendingPOs","avgRating","lastActivity","Math","max","_po$createdAt","_po$createdAt$toDate","_po$createdAt$toDate$","toDate","call","getTime","_job$createdAt","_job$createdAt$toDate","_job$createdAt$toDate2","e","generatePOPDF","poData","vendorData","tempElement","this","createPOElement","document","body","appendChild","canvas","html2canvas","scale","useCORS","allowTaint","backgroundColor","removeChild","imgData","toDataURL","pdf","jsPDF","imgWidth","pageHeight","imgHeight","height","width","heightLeft","position","addImage","addPage","error","console","element","createElement","style","left","top","padding","fontFamily","fontSize","lineHeight","innerHTML","poNumber","Date","toLocaleDateString","operation","deliveryDate","paymentTerms","priority","items","item","description","specifications","quantity","unit","unitPrice","toLocaleString","amount","join","discountAmount","taxAmount","taxRate","finalAmount","terms","downloadPDF","filename","save","getPDFBlob","output","getPDFDataURL","constructor","uploadEndpoint","uploadPDF","pdfBlob","formData","FormData","append","response","fetch","method","ok","statusText","result","json","success","url","link","expires","message","createDataURL","resolve","reader","FileReader","onload","readAsDataURL","generateShareableLink","shareData","shareId","random","toString","substr","localStorage","setItem","JSON","stringify","window","location","origin","businessName","process","REACT_APP_BUSINESS_NAME","websiteUrl","companyName","generatePOMessage","generatePOMessageWithPDF","pdfUrl","arguments","generateSimplePOMessage","generateStatusUpdateMessage","newStatus","oldStatus","toUpperCase","pending","approved","rejected","completed","in_progress","cancelled","generateGeneralMessage","subject","content","generateWelcomeMessage","baseURL","REACT_APP_WHATSAPP_API_URL","accessToken","REACT_APP_WHATSAPP_ACCESS_TOKEN","phoneNumberId","REACT_APP_WHATSAPP_PHONE_NUMBER_ID","formatPhoneNumber","cleaned","replace","startsWith","substring","sendPOToVendor","pdfService","vendorPhone","navigator","share","canShare","file","File","files","title","text","messageId","shareError","log","uploadResult","fileUploadService","messageTemplateService","whatsappUrl","encodeURIComponent","open","shareUrl","sendPOStatusUpdate","_result$error","headers","messaging_product","to","messages","sendCustomMessage","_result$error2","formattedPhone","sendDocument","documentUrl","caption","_result$error3","isConfigured","testConnection","operations","value","label","POForm","navigate","useNavigate","useParams","isEditMode","showSuccess","showError","useNotification","loading","setLoading","useState","setVendors","selectedVendor","setSelectedVendor","masterItems","setMasterItems","showPreview","setShowPreview","setFormData","invoiceDate","toISOString","split","dueDate","stateOfSupply","paymentType","shippingAddress","billingAddress","currency","roundOffEnabled","roundOffValue","approvalRequired","expectedDeliveryDays","warrantPeriod","qualityRequirements","useEffect","fetchVendors","fetchItems","fetchPO","find","calculateTotalAmount","vendorsSnapshot","vendorsData","getItemsOrdered","getPOById","_poData$deliveryDate","_poData$deliveryDate$","_poData$deliveryDate$2","it","idx","generatePONumber","date","getFullYear","getMonth","padStart","getDate","floor","subtotal","isNaN","afterDiscount","rounded","round","toFixed","prev","handleInputChange","target","handleItemChange","index","field","updatedItems","i","updatedItem","_jsx","className","children","_jsxs","onClick","FiArrowLeft","size","FiFileText","handlePreview","FiEye","whatsappService","err","day","month","year","onSubmit","preventDefault","some","normalized","normalizePOForSave","updatePO","createPO","FiInfo","onChange","required","FiUser","FiTool","op","checked","includes","next","FiCheck","_operations$find","o","FiCalendar","placeholder","FiMapPin","FiAlertCircle","FiDollarSign","min","FiClock","rows","FiPackage","addItem","newItem","FiPlus","itemId","handleSelectMasterItem","selected","_ref","_ref2","_selected$pricing","_selected$pricing2","pricing","salePrice","purchasePrice","mi","step","readOnly","removeItem","FiTrash2","disabled","FiSave","POPreview","onClose","_ref3","formatCurrency","Intl","NumberFormat","maximumFractionDigits","minimumFractionDigits","format","numberToWords","num","ones","teens","tens","words","amountInWords","generatePDF","print","FiDownload","slice","_operations$find2","gstin","_operations$find3","colSpan","ITEMS_COLLECTION","normalizeItemForSave","_raw$pricing","_raw$pricing2","_raw$pricing3","_numeric3","_raw$pricing4","_numeric4","_raw$pricing5","_raw$pricing6","_raw$stock","_numeric5","_raw$stock2","_numeric6","_raw$stock3","_raw$stock4","hsn","code","imageUrl","discountType","discountValue","taxMode","stock","track","openingQty","minQty","mapItemFromDoc","_d$pricing","_d$pricing2","_d$pricing3","_d$pricing4","_d$pricing5","_d$pricing6","_d$pricing7","_d$pricing8","_d$pricing9","_d$pricing0","_d$stock","_d$stock2","_d$stock3","_d$stock4","_d$stock5","_d$stock6","validateItem","errors","uploadItemImage","itemIdHint","path","storageRef","storage","uploadBytes","getDownloadURL","createItem","Object","keys","updateItem","getItemById","searchItems","t","bulkDeleteItems","PO_COLLECTION","ACTIVITY_COLLECTION","_raw$paymentTerms","normalizedOperations","safeItems","_it$unitPrice","_it$amount","rate","operationsStatus","acc","operationsMeta","meta","updatedBy","startedAt","completedAt","mapPOFromDoc","logActivity","poId","deletePO","bulkUpdatePOs","bulkDeletePOs"],"sourceRoot":""}